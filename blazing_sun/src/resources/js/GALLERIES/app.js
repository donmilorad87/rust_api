(function(){"use strict";function Me(){const n=document.querySelector('meta[name="csrf-token"]');return n?n.getAttribute("content"):(console.warn('CSRF token not found. Ensure <meta name="csrf-token"> exists in page head.'),null)}function B(n={}){const e=Me(),t={"Content-Type":"application/json",...n};return e&&(t["X-CSRF-TOKEN"]=e),t}var Q=typeof self<"u"?self:global;const X=typeof navigator<"u",mt=X&&typeof HTMLImageElement>"u",ee=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),te=Q.Buffer,ie=Q.BigInt,se=!!te,yt=n=>n;function ne(n,e=yt){if(ee)try{return typeof require=="function"?Promise.resolve(e(require(n))):import(n).then(e)}catch{console.warn(`Couldn't load ${n}`)}}let pe=Q.fetch;const bt=n=>pe=n;if(!Q.fetch){const n=ne("http",(i=>i)),e=ne("https",(i=>i)),t=(i,{headers:s}={})=>new Promise((async(r,a)=>{let{port:o,hostname:l,pathname:c,protocol:d,search:u}=new URL(i);const g={method:"GET",hostname:l,path:encodeURI(c)+u,headers:s};o!==""&&(g.port=Number(o));const f=(d==="https:"?await e:await n).request(g,(p=>{if(p.statusCode===301||p.statusCode===302){let I=new URL(p.headers.location,i).toString();return t(I,{headers:s}).then(r).catch(a)}r({status:p.statusCode,arrayBuffer:()=>new Promise((I=>{let $=[];p.on("data",(fe=>$.push(fe))),p.on("end",(()=>I(Buffer.concat($))))}))})}));f.on("error",a),f.end()}));bt(t)}function h(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const re=n=>Oe(n)?void 0:n,St=n=>n!==void 0;function Oe(n){return n===void 0||(n instanceof Map?n.size===0:Object.values(n).filter(St).length===0)}function b(n){let e=new Error(n);throw delete e.stack,e}function U(n){return(n=(function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e})(n).trim())===""?void 0:n}function me(n){let e=(function(t){let i=0;return t.ifd0.enabled&&(i+=1024),t.exif.enabled&&(i+=2048),t.makerNote&&(i+=2048),t.userComment&&(i+=1024),t.gps.enabled&&(i+=512),t.interop.enabled&&(i+=100),t.ifd1.enabled&&(i+=1024),i+2048})(n);return n.jfif.enabled&&(e+=50),n.xmp.enabled&&(e+=2e4),n.iptc.enabled&&(e+=14e3),n.icc.enabled&&(e+=6e3),e}const ye=n=>String.fromCharCode.apply(null,n),_e=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function Ue(n){return _e?_e.decode(n):se?Buffer.from(n).toString("utf8"):decodeURIComponent(escape(ye(n)))}class w{static from(e,t){return e instanceof this&&e.le===t?e:new w(e,void 0,void 0,t)}constructor(e,t=0,i,s){if(typeof s=="boolean"&&(this.le=s),Array.isArray(e)&&(e=new Uint8Array(e)),e===0)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){i===void 0&&(i=e.byteLength-t);let r=new DataView(e,t,i);this._swapDataView(r)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof w){i===void 0&&(i=e.byteLength-t),(t+=e.byteOffset)+i>e.byteOffset+e.byteLength&&b("Creating view outside of available memory in ArrayBuffer");let r=new DataView(e.buffer,t,i);this._swapDataView(r)}else if(typeof e=="number"){let r=new DataView(new ArrayBuffer(e));this._swapDataView(r)}else b("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,i=w){return e instanceof DataView||e instanceof w?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||b("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new i(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new w(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return Ue(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let i=this.getUint8Array(e,t);return ye(i)}getUnicodeString(e=0,t=this.byteLength){const i=[];for(let s=0;s<t&&e+s<this.byteLength;s+=2)i.push(this.getUint16(e+s));return ye(i)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,i){switch(t){case 1:return this.getUint8(e,i);case 2:return this.getUint16(e,i);case 4:return this.getUint32(e,i);case 8:return this.getUint64&&this.getUint64(e,i)}}getUint(e,t,i){switch(t){case 8:return this.getUint8(e,i);case 16:return this.getUint16(e,i);case 32:return this.getUint32(e,i);case 64:return this.getUint64&&this.getUint64(e,i)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function be(n,e){b(`${n} '${e}' was not loaded, try using full build of exifr.`)}class Se extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||be(this.kind,e),t&&(e in t||(function(i,s){b(`Unknown ${i} '${s}'.`)})(this.kind,e),t[e].enabled||be(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var E=new Se("file parser"),S=new Se("segment parser"),L=new Se("file reader");function vt(n,e){return typeof n=="string"?Re(n,e):X&&!mt&&n instanceof HTMLImageElement?Re(n.src,e):n instanceof Uint8Array||n instanceof ArrayBuffer||n instanceof DataView?new w(n):X&&n instanceof Blob?ve(n,e,"blob",G):void b("Invalid input argument")}function Re(n,e){return(t=n).startsWith("data:")||t.length>1e4?xe(n,e,"base64"):ee&&n.includes("://")?ve(n,e,"url",R):ee?xe(n,e,"fs"):X?ve(n,e,"url",R):void b("Invalid input argument");var t}async function ve(n,e,t,i){return L.has(t)?xe(n,e,t):i?(async function(s,r){let a=await r(s);return new w(a)})(n,i):void b(`Parser ${t} is not loaded`)}async function xe(n,e,t){let i=new(L.get(t))(n,e);return await i.read(),i}const R=n=>pe(n).then((e=>e.arrayBuffer())),G=n=>new Promise(((e,t)=>{let i=new FileReader;i.onloadend=()=>e(i.result||new ArrayBuffer),i.onerror=t,i.readAsArrayBuffer(n)}));class xt extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function y(n,e,t){let i=new xt;for(let[s,r]of t)i.set(s,r);if(Array.isArray(e))for(let s of e)n.set(s,i);else n.set(e,i);return i}function N(n,e,t){let i,s=n.get(e);for(i of t)s.set(i[0],i[1])}const x=new Map,P=new Map,D=new Map,F=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],q=["jfif","xmp","icc","iptc","ihdr"],V=["tiff",...q],m=["ifd0","ifd1","exif","gps","interop"],A=[...V,...m],M=["makerNote","userComment"],W=["translateKeys","translateValues","reviveValues","multiSegment"],O=[...W,"sanitize","mergeOutput","silentErrors"];class Ge{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Y extends Ge{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,i,s){if(super(),h(this,"enabled",!1),h(this,"skip",new Set),h(this,"pick",new Set),h(this,"deps",new Set),h(this,"translateKeys",!1),h(this,"translateValues",!1),h(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(s),this.canBeFiltered=m.includes(e),this.canBeFiltered&&(this.dict=x.get(e)),i!==void 0)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if(typeof i=="object"){if(this.enabled=!0,this.parse=i.parse!==!1,this.canBeFiltered){let{pick:r,skip:a}=i;r&&r.length>0&&this.translateTagSet(r,this.pick),a&&a.length>0&&this.translateTagSet(a,this.skip)}this.applyInheritables(i)}else i===!0||i===!1?this.parse=this.enabled=i:b(`Invalid options argument: ${i}`)}applyInheritables(e){let t,i;for(t of W)i=e[t],i!==void 0&&(this[t]=i)}translateTagSet(e,t){if(this.dict){let i,s,{tagKeys:r,tagValues:a}=this.dict;for(i of e)typeof i=="string"?(s=a.indexOf(i),s===-1&&(s=r.indexOf(Number(i))),s!==-1&&t.add(Number(r[s]))):t.add(i)}else for(let i of e)t.add(i)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,ae(this.pick,this.deps)):this.enabled&&this.pick.size>0&&ae(this.pick,this.deps)}}var C={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Ne=new Map;class H extends Ge{static useCached(e){let t=Ne.get(e);return t!==void 0||(t=new this(e),Ne.set(e,t)),t}constructor(e){super(),e===!0?this.setupFromTrue():e===void 0?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):typeof e=="object"?this.setupFromObject(e):b(`Invalid options argument ${e}`),this.firstChunkSize===void 0&&(this.firstChunkSize=X?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of F)this[e]=C[e];for(e of O)this[e]=C[e];for(e of M)this[e]=C[e];for(e of A)this[e]=new Y(e,C[e],void 0,this)}setupFromTrue(){let e;for(e of F)this[e]=C[e];for(e of O)this[e]=C[e];for(e of M)this[e]=!0;for(e of A)this[e]=new Y(e,!0,void 0,this)}setupFromArray(e){let t;for(t of F)this[t]=C[t];for(t of O)this[t]=C[t];for(t of M)this[t]=C[t];for(t of A)this[t]=new Y(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,m)}setupFromObject(e){let t;for(t of(m.ifd0=m.ifd0||m.image,m.ifd1=m.ifd1||m.thumbnail,Object.assign(this,e),F))this[t]=Ce(e[t],C[t]);for(t of O)this[t]=Ce(e[t],C[t]);for(t of M)this[t]=Ce(e[t],C[t]);for(t of V)this[t]=new Y(t,C[t],e[t],this);for(t of m)this[t]=new Y(t,C[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,m,A),e.tiff===!0?this.batchEnableWithBool(m,!0):e.tiff===!1?this.batchEnableWithUserValue(m,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,m):typeof e.tiff=="object"&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,m)}batchEnableWithBool(e,t){for(let i of e)this[i].enabled=t}batchEnableWithUserValue(e,t){for(let i of e){let s=t[i];this[i].enabled=s!==!1&&s!==void 0}}setupGlobalFilters(e,t,i,s=i){if(e&&e.length){for(let a of s)this[a].enabled=!1;let r=Ve(e,i);for(let[a,o]of r)ae(this[a].pick,o),this[a].enabled=!0}else if(t&&t.length){let r=Ve(t,i);for(let[a,o]of r)ae(this[a].skip,o)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:i,iptc:s,icc:r}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),i.enabled||e.skip.add(700),s.enabled||e.skip.add(33723),r.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:i,interop:s}=this;s.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),i.needed&&e.deps.add(34853),this.tiff.enabled=m.some((r=>this[r].enabled===!0))||this.makerNote||this.userComment;for(let r of m)this[r].finalizeFilters()}get onlyTiff(){return!q.map((e=>this[e].enabled)).some((e=>e===!0))&&this.tiff.enabled}checkLoadedPlugins(){for(let e of V)this[e].enabled&&!S.has(e)&&be("segment parser",e)}}function Ve(n,e){let t,i,s,r,a=[];for(s of e){for(r of(t=x.get(s),i=[],t))(n.includes(r[0])||n.includes(r[1]))&&i.push(r[0]);i.length&&a.push([s,i])}return a}function Ce(n,e){return n!==void 0?n:e!==void 0?e:void 0}function ae(n,e){for(let t of e)n.add(t)}h(H,"default",C);class _{constructor(e){h(this,"parsers",{}),h(this,"output",{}),h(this,"errors",[]),h(this,"pushToErrors",(t=>this.errors.push(t))),this.options=H.useCached(e)}async read(e){this.file=await vt(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[i,s]of E)if(s.canHandle(e,t))return this.fileParser=new s(this.options,this.file,this.parsers),e[i]=!0;this.file.close&&this.file.close(),b("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),re(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map((async i=>{let s=await i.parse();i.assignToOutput(e,s)}));this.options.silentErrors&&(t=t.map((i=>i.catch(this.pushToErrors)))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,i=S.get("tiff",e);var s;if(t.tiff?s={start:0,type:"tiff"}:t.jpeg&&(s=await this.fileParser.getOrFindSegment("tiff")),s===void 0)return;let r=await this.fileParser.ensureSegmentChunk(s),a=this.parsers.tiff=new i(r,e,t),o=await a.extractThumbnail();return t.close&&t.close(),o}}async function oe(n,e){let t=new _(e);return await t.read(n),t.parse()}var Ct=Object.freeze({__proto__:null,parse:oe,Exifr:_,fileParsers:E,segmentParsers:S,fileReaders:L,tagKeys:x,tagValues:P,tagRevivers:D,createDictionary:y,extendDictionary:N,fetchUrlAsArrayBuffer:R,readBlobAsArrayBuffer:G,chunkedProps:F,otherSegments:q,segments:V,tiffBlocks:m,segmentsAndBlocks:A,tiffExtractables:M,inheritables:W,allFormatters:O,Options:H});class le{constructor(e,t,i){h(this,"errors",[]),h(this,"ensureSegmentChunk",(async s=>{let r=s.start,a=s.size||65536;if(this.file.chunked)if(this.file.available(r,a))s.chunk=this.file.subarray(r,a);else try{s.chunk=await this.file.readChunk(r,a)}catch(o){b(`Couldn't read segment: ${JSON.stringify(s)}. ${o.message}`)}else this.file.byteLength>r+a?s.chunk=this.file.subarray(r,a):s.size===void 0?s.chunk=this.file.subarray(r):b("Segment unreachable: "+JSON.stringify(s));return s.chunk})),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=i}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let i=new(S.get(e))(t,this.options,this.file);return this.parsers[e]=i}createParsers(e){for(let t of e){let{type:i,chunk:s}=t,r=this.options[i];if(r&&r.enabled){let a=this.parsers[i];a&&a.append||a||this.createParser(i,s)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class k{static findPosition(e,t){let i=e.getUint16(t+2)+2,s=typeof this.headerLength=="function"?this.headerLength(e,t,i):this.headerLength,r=t+s,a=i-s;return{offset:t,length:i,headerLength:s,start:r,size:a,end:r+a}}static parse(e,t={}){return new this(e,new H({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof w?e:new w(e)}constructor(e,t={},i){h(this,"errors",[]),h(this,"raw",new Map),h(this,"handleError",(s=>{if(!this.options.silentErrors)throw s;this.errors.push(s.message)})),this.chunk=this.normalizeInput(e),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let i=D.get(t),s=P.get(t),r=x.get(t),a=this.options[t],o=a.reviveValues&&!!i,l=a.translateValues&&!!s,c=a.translateKeys&&!!r,d={};for(let[u,g]of e)o&&i.has(u)?g=i.get(u)(g):l&&s.has(u)&&(g=this.translateValue(g,s.get(u))),c&&r.has(u)&&(u=r.get(u)||u),d[u]=g;return d}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,i){if(this.globalOptions.mergeOutput)return Object.assign(e,i);e[t]?Object.assign(e[t],i):e[t]=i}}h(k,"headerLength",4),h(k,"type",void 0),h(k,"multiSegment",!1),h(k,"canHandle",(()=>!1));function wt(n){return n===192||n===194||n===196||n===219||n===221||n===218||n===254}function It(n){return n>=224&&n<=239}function Pt(n,e,t){for(let[i,s]of S)if(s.canHandle(n,e,t))return i}class He extends le{constructor(...e){super(...e),h(this,"appSegments",[]),h(this,"jpegSegments",[]),h(this,"unknownSegments",[])}static canHandle(e,t){return t===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){e===!0?(this.findAll=!0,this.wanted=new Set(S.keyList())):(e=e===void 0?S.keyList().filter((t=>this.options[t].enabled)):e.filter((t=>this.options[t].enabled&&S.has(t))),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:i,findAll:s,wanted:r,remaining:a}=this;if(!s&&this.file.chunked&&(s=Array.from(r).some((o=>{let l=S.get(o),c=this.options[o];return l.multiSegment&&c.multiSegment})),s&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,i.byteLength),!this.options.onlyTiff&&i.chunked){let o=!1;for(;a.size>0&&!o&&(i.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:l}=i,c=this.appSegments.some((d=>!this.file.available(d.offset||d.start,d.length||d.size)));if(o=e>l&&!c?!await i.readNextChunk(e):!await i.readNextChunk(l),(e=this.findAppSegmentsInRange(e,i.byteLength))===void 0)return}}}findAppSegmentsInRange(e,t){t-=2;let i,s,r,a,o,l,{file:c,findAll:d,wanted:u,remaining:g,options:f}=this;for(;e<t;e++)if(c.getUint8(e)===255){if(i=c.getUint8(e+1),It(i)){if(s=c.getUint16(e+2),r=Pt(c,e,s),r&&u.has(r)&&(a=S.get(r),o=a.findPosition(c,e),l=f[r],o.type=r,this.appSegments.push(o),!d&&(a.multiSegment&&l.multiSegment?(this.unfinishedMultiSegment=o.chunkNumber<o.chunkCount,this.unfinishedMultiSegment||g.delete(r)):g.delete(r),g.size===0)))break;f.recordUnknownSegments&&(o=k.findPosition(c,e),o.marker=i,this.unknownSegments.push(o)),e+=s+1}else if(wt(i)){if(s=c.getUint16(e+2),i===218&&f.stopAfterSos!==!1)return;f.recordJpegSegments&&this.jpegSegments.push({offset:e,length:s,marker:i}),e+=s+1}}return e}mergeMultiSegments(){if(!this.appSegments.some((t=>t.multiSegment)))return;let e=(function(t,i){let s,r,a,o=new Map;for(let l=0;l<t.length;l++)s=t[l],r=s[i],o.has(r)?a=o.get(r):o.set(r,a=[]),a.push(s);return Array.from(o)})(this.appSegments,"type");this.mergedAppSegments=e.map((([t,i])=>{let s=S.get(t,this.options);return s.handleMultiSegments?{type:t,chunk:s.handleMultiSegments(i)}:i[0]}))}getSegment(e){return this.appSegments.find((t=>t.type===e))}async getOrFindSegment(e){let t=this.getSegment(e);return t===void 0&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}h(He,"type","jpeg"),E.set("jpeg",He);const kt=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class Et extends k{parseHeader(){var e=this.chunk.getUint16();e===18761?this.le=!0:e===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,i=new Map){let{pick:s,skip:r}=this.options[t];s=new Set(s);let a=s.size>0,o=r.size===0,l=this.chunk.getUint16(e);e+=2;for(let c=0;c<l;c++){let d=this.chunk.getUint16(e);if(a){if(s.has(d)&&(i.set(d,this.parseTag(e,d,t)),s.delete(d),s.size===0))break}else!o&&r.has(d)||i.set(d,this.parseTag(e,d,t));e+=12}return i}parseTag(e,t,i){let{chunk:s}=this,r=s.getUint16(e+2),a=s.getUint32(e+4),o=kt[r];if(o*a<=4?e+=8:e=s.getUint32(e+8),(r<1||r>13)&&b(`Invalid TIFF value type. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${r}, offset ${e}`),e>s.byteLength&&b(`Invalid TIFF value offset. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${r}, offset ${e} is outside of chunk size ${s.byteLength}`),r===1)return s.getUint8Array(e,a);if(r===2)return U(s.getString(e,a));if(r===7)return s.getUint8Array(e,a);if(a===1)return this.parseTagValue(r,e);{let l=new((function(d){switch(d){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}})(r))(a),c=o;for(let d=0;d<a;d++)l[d]=this.parseTagValue(r,e),e+=c;return l}}parseTagValue(e,t){let{chunk:i}=this;switch(e){case 1:return i.getUint8(t);case 3:return i.getUint16(t);case 4:return i.getUint32(t);case 5:return i.getUint32(t)/i.getUint32(t+4);case 6:return i.getInt8(t);case 8:return i.getInt16(t);case 9:return i.getInt32(t);case 10:return i.getInt32(t)/i.getInt32(t+4);case 11:return i.getFloat(t);case 12:return i.getDouble(t);case 13:return i.getUint32(t);default:b(`Invalid tiff type ${e}`)}}}class we extends Et{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1165519206&&e.getUint16(t+8)===0}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return t.catch!==void 0&&(t=t.catch(this.handleError)),t}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let i=new Map;return this[t]=i,this.parseTags(e,t,i),i}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&b("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&b(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,me(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return t.size!==0?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,me(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let i=e.get(t);i&&i.length===1&&e.set(t,i[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",ze(...e.get(2),e.get(1))),e.set("longitude",ze(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,i,s={};for(t of m)if(e=this[t],!Oe(e))if(i=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if(t==="ifd1")continue;Object.assign(s,i)}else s[t]=i;return this.makerNote&&(s.makerNote=this.makerNote),this.userComment&&(s.userComment=this.userComment),s}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[i,s]of Object.entries(t))this.assignObjectToOutput(e,i,s)}}function ze(n,e,t,i){var s=n+e/60+t/3600;return i!=="S"&&i!=="W"||(s*=-1),s}h(we,"type","tiff"),h(we,"headerLength",10),S.set("tiff",we);var Lt=Object.freeze({__proto__:null,default:Ct,Exifr:_,fileParsers:E,segmentParsers:S,fileReaders:L,tagKeys:x,tagValues:P,tagRevivers:D,createDictionary:y,extendDictionary:N,fetchUrlAsArrayBuffer:R,readBlobAsArrayBuffer:G,chunkedProps:F,otherSegments:q,segments:V,tiffBlocks:m,segmentsAndBlocks:A,tiffExtractables:M,inheritables:W,allFormatters:O,Options:H,parse:oe});const Ie={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},Pe=Object.assign({},Ie,{firstChunkSize:4e4,gps:[1,2,3,4]});async function je(n){let e=new _(Pe);await e.read(n);let t=await e.parse();if(t&&t.gps){let{latitude:i,longitude:s}=t.gps;return{latitude:i,longitude:s}}}const ke=Object.assign({},Ie,{tiff:!1,ifd1:!0,mergeOutput:!1});async function $e(n){let e=new _(ke);await e.read(n);let t=await e.extractThumbnail();return t&&se?te.from(t):t}async function qe(n){let e=await this.thumbnail(n);if(e!==void 0){let t=new Blob([e]);return URL.createObjectURL(t)}}const Ee=Object.assign({},Ie,{firstChunkSize:4e4,ifd0:[274]});async function Le(n){let e=new _(Ee);await e.read(n);let t=await e.parse();if(t&&t.ifd0)return t.ifd0[274]}const Te=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let z=!0,j=!0;if(typeof navigator=="object"){let n=navigator.userAgent;if(n.includes("iPad")||n.includes("iPhone")){let e=n.match(/OS (\d+)_(\d+)/);if(e){let[,t,i]=e;z=Number(t)+.1*Number(i)<13.4,j=!1}}else if(n.includes("OS X 10")){let[,e]=n.match(/OS X 10[_.](\d+)/);z=j=Number(e)<15}if(n.includes("Chrome/")){let[,e]=n.match(/Chrome\/(\d+)/);z=j=Number(e)<81}else if(n.includes("Firefox/")){let[,e]=n.match(/Firefox\/(\d+)/);z=j=Number(e)<77}}async function We(n){let e=await Le(n);return Object.assign({canvas:z,css:j},Te[e])}class Tt extends w{constructor(...e){super(...e),h(this,"ranges",new Bt),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,i){if(e===0&&this.byteLength===0&&i){let s=new DataView(i.buffer||i,i.byteOffset,i.byteLength);this._swapDataView(s)}else{let s=e+t;if(s>this.byteLength){let{dataView:r}=this._extend(s);this._swapDataView(r)}}}_extend(e){let t;t=se?te.allocUnsafe(e):new Uint8Array(e);let i=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:i}}subarray(e,t,i=!1){return t=t||this._lengthToEnd(e),i&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,i=!1){i&&this._tryExtend(t,e.byteLength,e);let s=super.set(e,t);return this.ranges.add(t,s.byteLength),s}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class Bt{constructor(){h(this,"list",[])}get length(){return this.list.length}add(e,t,i=0){let s=e+t,r=this.list.filter((a=>Ke(e,a.offset,s)||Ke(e,a.end,s)));if(r.length>0){e=Math.min(e,...r.map((o=>o.offset))),s=Math.max(s,...r.map((o=>o.end))),t=s-e;let a=r.shift();a.offset=e,a.length=t,a.end=s,this.list=this.list.filter((o=>!r.includes(o)))}else this.list.push({offset:e,length:t,end:s})}available(e,t){let i=e+t;return this.list.some((s=>s.offset<=e&&i<=s.end))}}function Ke(n,e,t){return n<=e&&e<=t}class ce extends Tt{constructor(e,t){super(0),h(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,i=await this.readChunk(e,t);return!!i&&i.byteLength===t}async readChunk(e,t){if(this.chunksRead++,(t=this.safeWrapAddress(e,t))!==0)return this._readChunk(e,t)}safeWrapAddress(e,t){return this.size!==void 0&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}L.set("blob",class extends ce{async readWhole(){this.chunked=!1;let n=await G(this.input);this._swapArrayBuffer(n)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(n,e){let t=e?n+e:void 0,i=this.input.slice(n,t),s=await G(i);return this.set(s,n,!0)}});var Dt=Object.freeze({__proto__:null,default:Lt,Exifr:_,fileParsers:E,segmentParsers:S,fileReaders:L,tagKeys:x,tagValues:P,tagRevivers:D,createDictionary:y,extendDictionary:N,fetchUrlAsArrayBuffer:R,readBlobAsArrayBuffer:G,chunkedProps:F,otherSegments:q,segments:V,tiffBlocks:m,segmentsAndBlocks:A,tiffExtractables:M,inheritables:W,allFormatters:O,Options:H,parse:oe,gpsOnlyOptions:Pe,gps:je,thumbnailOnlyOptions:ke,thumbnail:$e,thumbnailUrl:qe,orientationOnlyOptions:Ee,orientation:Le,rotations:Te,get rotateCanvas(){return z},get rotateCss(){return j},rotation:We});L.set("url",class extends ce{async readWhole(){this.chunked=!1;let n=await R(this.input);n instanceof ArrayBuffer?this._swapArrayBuffer(n):n instanceof Uint8Array&&this._swapBuffer(n)}async _readChunk(n,e){let t=e?n+e-1:void 0,i=this.options.httpHeaders||{};(n||t)&&(i.range=`bytes=${[n,t].join("-")}`);let s=await pe(this.input,{headers:i}),r=await s.arrayBuffer(),a=r.byteLength;if(s.status!==416)return a!==e&&(this.size=n+a),this.set(r,n,!0)}}),w.prototype.getUint64=function(n){let e=this.getUint32(n),t=this.getUint32(n+4);return e<1048575?e<<32|t:typeof ie!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),ie(e)<<ie(32)|ie(t)):void b("Trying to read 64b value but JS can only handle 53b numbers.")};class Ft extends le{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let i=this.parseBoxHead(e);if(t.push(i),i.length===0)break;e+=i.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return e.boxes===void 0&&this.parseSubBoxes(e),e.boxes.find((i=>i.kind===t))}parseBoxHead(e){let t=this.file.getUint32(e),i=this.file.getString(e+4,4),s=e+8;return t===1&&(t=this.file.getUint64(e+8),s+=8),{offset:e,length:t,kind:i,start:s}}parseBoxFullHead(e){if(e.version!==void 0)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class Xe extends Ft{static canHandle(e,t){if(t!==0)return!1;let i=e.getUint16(2);if(i>50)return!1;let s=16,r=[];for(;s<i;)r.push(e.getString(s,4)),s+=4;return r.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;t.kind!=="meta";)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,i){await this.file.ensureChunk(t,i);let s=this.file.subarray(t,i);this.createParser(e,s)}async findIcc(e){let t=this.findBox(e,"iprp");if(t===void 0)return;let i=this.findBox(t,"ipco");if(i===void 0)return;let s=this.findBox(i,"colr");s!==void 0&&await this.registerSegment("icc",s.offset+12,s.length)}async findExif(e){let t=this.findBox(e,"iinf");if(t===void 0)return;let i=this.findBox(e,"iloc");if(i===void 0)return;let s=this.findExifLocIdInIinf(t),r=this.findExtentInIloc(i,s);if(r===void 0)return;let[a,o]=r;await this.file.ensureChunk(a,o);let l=4+this.file.getUint32(a);a+=l,o-=l,await this.registerSegment("tiff",a,o)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,i,s,r,a=e.start,o=this.file.getUint16(a);for(a+=2;o--;){if(t=this.parseBoxHead(a),this.parseBoxFullHead(t),i=t.start,t.version>=2&&(s=t.version===3?4:2,r=this.file.getString(i+s+2,4),r==="Exif"))return this.file.getUintBytes(i,s);a+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let i=e.start,[s,r]=this.get8bits(i++),[a,o]=this.get8bits(i++),l=e.version===2?4:2,c=e.version===1||e.version===2?2:0,d=o+s+r,u=e.version===2?4:2,g=this.file.getUintBytes(i,u);for(i+=u;g--;){let f=this.file.getUintBytes(i,l);i+=l+c+2+a;let p=this.file.getUint16(i);if(i+=2,f===t)return p>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(i+o,s),this.file.getUintBytes(i+o+s,r)];i+=p*d}}}class Ye extends Xe{}h(Ye,"type","heic");class Je extends Xe{}h(Je,"type","avif"),E.set("heic",Ye),E.set("avif",Je),y(x,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),y(x,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),y(x,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),y(P,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let J=y(P,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Ze={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};J.set(37392,Ze),J.set(41488,Ze);const Be={0:"Normal",1:"Low",2:"High"};function Qe(n){return typeof n=="object"&&n.length!==void 0?n[0]:n}function et(n){let e=Array.from(n).slice(1);return e[1]>15&&(e=e.map((t=>String.fromCharCode(t)))),e[2]!=="0"&&e[2]!==0||e.pop(),e.join(".")}function De(n){if(typeof n=="string"){var[e,t,i,s,r,a]=n.trim().split(/[-: ]/g).map(Number),o=new Date(e,t-1,i);return Number.isNaN(s)||Number.isNaN(r)||Number.isNaN(a)||(o.setHours(s),o.setMinutes(r),o.setSeconds(a)),Number.isNaN(+o)?n:o}}function Z(n){if(typeof n=="string")return n;let e=[];if(n[1]===0&&n[n.length-1]===0)for(let t=0;t<n.length;t+=2)e.push(tt(n[t+1],n[t]));else for(let t=0;t<n.length;t+=2)e.push(tt(n[t],n[t+1]));return U(String.fromCodePoint(...e))}function tt(n,e){return n<<8|e}J.set(41992,Be),J.set(41993,Be),J.set(41994,Be),y(D,["ifd0","ifd1"],[[50827,function(n){return typeof n!="string"?Ue(n):n}],[306,De],[40091,Z],[40092,Z],[40093,Z],[40094,Z],[40095,Z]]),y(D,"exif",[[40960,et],[36864,et],[36867,De],[36868,De],[40962,Qe],[40963,Qe]]),y(D,"gps",[[0,n=>Array.from(n).join(".")],[7,n=>Array.from(n).join(":")]]);class Fe extends k{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1752462448&&e.getString(t+4,20)==="http://ns.adobe.com/"}static headerLength(e,t){return e.getString(t+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(e,t){let i=super.findPosition(e,t);return i.multiSegment=i.extended=i.headerLength===79,i.multiSegment?(i.chunkCount=e.getUint8(t+72),i.chunkNumber=e.getUint8(t+76),e.getUint8(t+77)!==0&&i.chunkNumber++):(i.chunkCount=1/0,i.chunkNumber=-1),i}static handleMultiSegments(e){return e.map((t=>t.chunk.getString())).join("")}normalizeInput(e){return typeof e=="string"?e:w.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=(function(r){let a={},o={};for(let l of rt)a[l]=[],o[l]=0;return r.replace(_t,((l,c,d)=>{if(c==="<"){let u=++o[d];return a[d].push(u),`${l}#${u}`}return`${l}#${a[d].pop()}`}))})(e);let t=K.findAll(e,"rdf","Description");t.length===0&&t.push(new K("rdf","Description",void 0,e));let i,s={};for(let r of t)for(let a of r.properties)i=Ot(a.ns,s),it(a,i);return(function(r){let a;for(let o in r)a=r[o]=re(r[o]),a===void 0&&delete r[o];return re(r)})(s)}assignToOutput(e,t){if(this.localOptions.parse)for(let[i,s]of Object.entries(t))switch(i){case"tiff":this.assignObjectToOutput(e,"ifd0",s);break;case"exif":this.assignObjectToOutput(e,"exif",s);break;case"xmlns":break;default:this.assignObjectToOutput(e,i,s)}else e.xmp=t}}h(Fe,"type","xmp"),h(Fe,"multiSegment",!0),S.set("xmp",Fe);class de{static findAll(e){return st(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(de.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],s=e[3].slice(1,-1);return s=nt(s),new de(t,i,s)}constructor(e,t,i){this.ns=e,this.name=t,this.value=i}serialize(){return this.value}}class K{static findAll(e,t,i){if(t!==void 0||i!==void 0){t=t||"[\\w\\d-]+",i=i||"[\\w\\d-]+";var s=new RegExp(`<(${t}):(${i})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else s=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return st(e,s).map(K.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],s=e[4],r=e[8];return new K(t,i,s,r)}constructor(e,t,i,s){this.ns=e,this.name=t,this.attrString=i,this.innerXml=s,this.attrs=de.findAll(i),this.children=K.findAll(s),this.value=this.children.length===0?nt(s):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return e==="rdf"&&(t==="Seq"||t==="Bag"||t==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return Mt(this.children.map(At));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let e={};for(let t of this.properties)it(t,e);return this.value!==void 0&&(e.value=this.value),re(e)}}function it(n,e){let t=n.serialize();t!==void 0&&(e[n.name]=t)}var At=n=>n.serialize(),Mt=n=>n.length===1?n[0]:n,Ot=(n,e)=>e[n]?e[n]:e[n]={};function st(n,e){let t,i=[];if(!n)return i;for(;(t=e.exec(n))!==null;)i.push(t);return i}function nt(n){if((function(i){return i==null||i==="null"||i==="undefined"||i===""||i.trim()===""})(n))return;let e=Number(n);if(!Number.isNaN(e))return e;let t=n.toLowerCase();return t==="true"||t!=="false"&&n.trim()}const rt=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],_t=new RegExp(`(<|\\/)(${rt.join("|")})`,"g");var Ut=Object.freeze({__proto__:null,default:Dt,Exifr:_,fileParsers:E,segmentParsers:S,fileReaders:L,tagKeys:x,tagValues:P,tagRevivers:D,createDictionary:y,extendDictionary:N,fetchUrlAsArrayBuffer:R,readBlobAsArrayBuffer:G,chunkedProps:F,otherSegments:q,segments:V,tiffBlocks:m,segmentsAndBlocks:A,tiffExtractables:M,inheritables:W,allFormatters:O,Options:H,parse:oe,gpsOnlyOptions:Pe,gps:je,thumbnailOnlyOptions:ke,thumbnail:$e,thumbnailUrl:qe,orientationOnlyOptions:Ee,orientation:Le,rotations:Te,get rotateCanvas(){return z},get rotateCss(){return j},rotation:We});let at=ne("fs",(n=>n.promises));L.set("fs",class extends ce{async readWhole(){this.chunked=!1,this.fs=await at;let n=await this.fs.readFile(this.input);this._swapBuffer(n)}async readChunked(){this.chunked=!0,this.fs=await at,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(n,e){this.fh===void 0&&await this.open(),n+e>this.size&&(e=this.size-n);var t=this.subarray(n,e,!0);return await this.fh.read(t.dataView,0,e,n),t}async close(){if(this.fh){let n=this.fh;this.fh=void 0,await n.close()}}}),L.set("base64",class extends ce{constructor(...n){super(...n),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(n,e){let t,i,s=this.input;n===void 0?(n=0,t=0,i=0):(t=4*Math.floor(n/3),i=n-t/4*3),e===void 0&&(e=this.size);let r=n+e,a=t+4*Math.ceil(r/3);s=s.slice(t,a);let o=Math.min(e,this.size-n);if(se){let l=te.from(s,"base64").slice(i,i+o);return this.set(l,n,!0)}{let l=this.subarray(n,o,!0),c=atob(s),d=l.toUint8();for(let u=0;u<o;u++)d[u]=c.charCodeAt(i+u);return l}}});class ot extends le{static canHandle(e,t){return t===18761||t===19789}extendOptions(e){let{ifd0:t,xmp:i,iptc:s,icc:r}=e;i.enabled&&t.deps.add(700),s.enabled&&t.deps.add(33723),r.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:i,icc:s}=this.options;if(e.enabled||t.enabled||i.enabled||s.enabled){let r=Math.max(me(this.options),this.options.chunkSize);await this.file.ensureChunk(0,r),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}h(ot,"type","tiff"),E.set("tiff",ot);let Rt=ne("zlib");const Gt=["ihdr","iccp","text","itxt","exif"];class lt extends le{constructor(...e){super(...e),h(this,"catchError",(t=>this.errors.push(t))),h(this,"metaChunks",[]),h(this,"unknownChunks",[])}static canHandle(e,t){return t===35152&&e.getUint32(0)===2303741511&&e.getUint32(4)===218765834}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:i}=this;for(;e<t;){let s=i.getUint32(e),r=i.getUint32(e+4),a=i.getString(e+4,4).toLowerCase(),o=s+4+4+4,l={type:a,offset:e,length:o,start:e+4+4,size:s,marker:r};Gt.includes(a)?this.metaChunks.push(l):this.unknownChunks.push(l),e+=o}}parseTextChunks(){let e=this.metaChunks.filter((t=>t.type==="text"));for(let t of e){let[i,s]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(i,s)}}injectKeyValToIhdr(e,t){let i=this.parsers.ihdr;i&&i.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find((t=>t.type==="ihdr"));e&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find((t=>t.type==="exif"));e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter((t=>t.type==="itxt"));for(let t of e)t.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find((o=>o.type==="iccp"));if(!e)return;let{chunk:t}=e,i=t.getUint8Array(0,81),s=0;for(;s<80&&i[s]!==0;)s++;let r=s+2,a=t.getString(0,s);if(this.injectKeyValToIhdr("ProfileName",a),ee){let o=await Rt,l=t.getUint8Array(r);l=o.inflateSync(l),this.injectSegment("icc",l)}}}h(lt,"type","png"),E.set("png",lt),y(x,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),N(x,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let ct=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];N(x,"ifd0",ct),N(x,"exif",ct),y(P,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class Ae extends k{static canHandle(e,t){return e.getUint8(t+1)===224&&e.getUint32(t+4)===1246120262&&e.getUint8(t+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}h(Ae,"type","jfif"),h(Ae,"headerLength",9),S.set("jfif",Ae),y(x,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class dt extends k{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}h(dt,"type","ihdr"),S.set("ihdr",dt),y(x,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),y(P,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class ue extends k{static canHandle(e,t){return e.getUint8(t+1)===226&&e.getUint32(t+4)===1229144927}static findPosition(e,t){let i=super.findPosition(e,t);return i.chunkNumber=e.getUint8(t+16),i.chunkCount=e.getUint8(t+17),i.multiSegment=i.chunkCount>1,i}static handleMultiSegments(e){return(function(t){let i=(function(s){let r=s[0].constructor,a=0;for(let c of s)a+=c.length;let o=new r(a),l=0;for(let c of s)o.set(c,l),l+=c.length;return o})(t.map((s=>s.chunk.toUint8())));return new w(i)})(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&b("ICC header is too short");for(let[t,i]of Object.entries(Nt)){t=parseInt(t,10);let s=i(this.chunk,t);s!=="\0\0\0\0"&&e.set(t,s)}}parseTags(){let e,t,i,s,r,{raw:a}=this,o=this.chunk.getUint32(128),l=132,c=this.chunk.byteLength;for(;o--;){if(e=this.chunk.getString(l,4),t=this.chunk.getUint32(l+4),i=this.chunk.getUint32(l+8),s=this.chunk.getString(t,4),t+i>c)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");r=this.parseTag(s,t,i),r!==void 0&&r!=="\0\0\0\0"&&a.set(e,r),l+=12}}parseTag(e,t,i){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,i);case"sig ":return this.parseSig(t)}if(!(t+i>this.chunk.byteLength))return this.chunk.getUint8Array(t,i)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return U(this.chunk.getString(e+12,t))}parseText(e,t){return U(this.chunk.getString(e+8,t-8))}parseSig(e){return U(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,i=t.getUint32(e+8),s=t.getUint32(e+12),r=e+16,a=[];for(let o=0;o<i;o++){let l=t.getString(r+0,2),c=t.getString(r+2,2),d=t.getUint32(r+4),u=t.getUint32(r+8)+e,g=U(t.getUnicodeString(u,d));a.push({lang:l,country:c,text:g}),r+=s}return i===1?a[0].text:a}translateValue(e,t){return typeof e=="string"?t[e]||t[e.toLowerCase()]||e:t[e]||e}}h(ue,"type","icc"),h(ue,"multiSegment",!0),h(ue,"headerLength",18);const Nt={4:T,8:function(n,e){return[n.getUint8(e),n.getUint8(e+1)>>4,n.getUint8(e+1)%16].map((t=>t.toString(10))).join(".")},12:T,16:T,20:T,24:function(n,e){const t=n.getUint16(e),i=n.getUint16(e+2)-1,s=n.getUint16(e+4),r=n.getUint16(e+6),a=n.getUint16(e+8),o=n.getUint16(e+10);return new Date(Date.UTC(t,i,s,r,a,o))},36:T,40:T,48:T,52:T,64:(n,e)=>n.getUint32(e),80:T};function T(n,e){return U(n.getString(e,4))}S.set("icc",ue),y(x,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const he={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},ut={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};y(P,"icc",[[4,he],[12,ut],[40,Object.assign({},he,ut)],[48,he],[80,he],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class ge extends k{static canHandle(e,t,i){return e.getUint8(t+1)===237&&e.getString(t+4,9)==="Photoshop"&&this.containsIptc8bim(e,t,i)!==void 0}static headerLength(e,t,i){let s,r=this.containsIptc8bim(e,t,i);if(r!==void 0)return s=e.getUint8(t+r+7),s%2!=0&&(s+=1),s===0&&(s=4),r+8+s}static containsIptc8bim(e,t,i){for(let s=0;s<i;s++)if(this.isIptcSegmentHead(e,t+s))return s}static isIptcSegmentHead(e,t){return e.getUint8(t)===56&&e.getUint32(t)===943868237&&e.getUint16(t+4)===1028}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,i=!1;for(let s=0;s<t;s++)if(this.chunk.getUint8(s)===28&&this.chunk.getUint8(s+1)===2){i=!0;let r=this.chunk.getUint16(s+3),a=this.chunk.getUint8(s+2),o=this.chunk.getLatin1String(s+5,r);e.set(a,this.pluralizeValue(e.get(a),o)),s+=4+r}else if(i)break;return this.translate(),this.output}pluralizeValue(e,t){return e!==void 0?e instanceof Array?(e.push(t),e):[e,t]:t}}h(ge,"type","iptc"),h(ge,"translateValues",!1),h(ge,"reviveValues",!1),S.set("iptc",ge),y(x,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),y(P,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);class Vt{constructor(e){this.baseUrl=e.baseUrl,this.galleriesGrid=e.galleriesGrid,this.loadingState=e.loadingState,this.errorState=e.errorState,this.emptyState=e.emptyState,this.showToast=e.showToast,this.galleries=[],this.currentGallery=null,this.currentGalleryForPictures=null,this.selectedFiles=[],this.fileMetadata=[],this.currentLightboxIndex=0,this.selectedPictureIds=new Set,this.pendingPictureDeleteIds=[],this.currentPicturesList=[],this.coverImageFile=null,this.pendingOpenGalleryId=null,this.exifEnabled=!0,this.init()}init(){const t=new URLSearchParams(window.location.search).get("gallery_id");if(t){const i=parseInt(t,10);Number.isNaN(i)||(this.pendingOpenGalleryId=i)}this.setupEventListeners(),this.loadGalleries()}setupEventListeners(){const e=document.getElementById("createGalleryBtn");e&&e.addEventListener("click",()=>this.showGalleryModal()),document.querySelectorAll(".create-gallery-trigger").forEach(v=>{v.addEventListener("click",()=>this.showGalleryModal())});const i=document.getElementById("retryBtn");i&&i.addEventListener("click",()=>this.loadGalleries());const s=document.getElementById("galleryForm");s&&s.addEventListener("submit",v=>{v.preventDefault(),this.handleGallerySubmit()});const r=document.getElementById("galleryCoverImage");r&&r.addEventListener("change",v=>this.handleCoverImageSelect(v));const a=document.getElementById("galleryUseLocationBtn");a&&a.addEventListener("click",()=>this.useCurrentGalleryLocation());const o=document.getElementById("galleryIsGeo");o&&o.addEventListener("change",()=>{this.toggleGeoFields(o.checked)}),this.setupModalCloseListeners();const l=document.getElementById("confirmDeleteBtn");l&&l.addEventListener("click",()=>this.handleDelete());const c=document.getElementById("addPictureBtn");c&&c.addEventListener("click",()=>this.handleAddPictures()),this.selectAllPicturesCheckbox=document.getElementById("selectAllPictures"),this.selectAllPicturesCheckbox&&this.selectAllPicturesCheckbox.addEventListener("change",()=>this.handleSelectAllPictures()),this.bulkDeletePicturesBtn=document.getElementById("bulkDeletePicturesBtn"),this.bulkDeletePicturesBtn&&this.bulkDeletePicturesBtn.addEventListener("click",()=>{const v=Array.from(this.selectedPictureIds);v.length>0&&this.openPictureDeleteModal(v)}),this.selectedPicturesCount=document.getElementById("selectedPicturesCount");const d=document.getElementById("confirmPictureDeleteBtn");d&&d.addEventListener("click",()=>this.handleConfirmPictureDelete());const u=document.getElementById("browseFilesBtn");u&&u.addEventListener("click",()=>this.triggerFileInput());const g=document.getElementById("pictureFileInput");g&&g.addEventListener("change",v=>this.handleFileSelect(v));const f=document.getElementById("uploadDropZone");f&&(f.addEventListener("dragover",v=>this.handleDragOver(v)),f.addEventListener("dragleave",v=>this.handleDragLeave(v)),f.addEventListener("drop",v=>this.handleDrop(v)));const p=document.getElementById("exifLocationToggle");p&&(this.exifEnabled=p.checked,p.addEventListener("change",v=>{this.exifEnabled=v.target.checked}));const I=document.getElementById("uploadFilesBtn");I&&I.addEventListener("click",()=>this.uploadAndAddPictures());const $=document.getElementById("cancelUploadBtn");$&&$.addEventListener("click",()=>this.cancelUpload());const fe=document.querySelector(".image-lightbox__close");fe&&fe.addEventListener("click",()=>this.closeLightbox());const gt=document.getElementById("lightboxPrevBtn");gt&&gt.addEventListener("click",()=>this.navigateLightbox(-1));const ft=document.getElementById("lightboxNextBtn");ft&&ft.addEventListener("click",()=>this.navigateLightbox(1));const pt=document.getElementById("lightboxForm");pt&&pt.addEventListener("submit",v=>{v.preventDefault(),this.saveLightboxMetadata()})}setupModalCloseListeners(){document.querySelectorAll(".modal__close, .modal__overlay").forEach(t=>{t.addEventListener("click",i=>{const s=i.target.closest(".modal");s&&this.closeModal(s)})})}async loadGalleries(){this.showLoadingState();try{const e=await fetch(`${this.baseUrl}/api/v1/galleries`,{method:"GET",credentials:"include",headers:B({Accept:"application/json"})});if(!e.ok)throw new Error(`Failed to load galleries: ${e.statusText}`);const t=await e.json();if(this.galleries=t.galleries||[],this.galleries.length===0)this.showEmptyState();else if(this.renderGalleries(),this.showContentState(),this.pendingOpenGalleryId){const i=this.galleries.find(s=>s.id===this.pendingOpenGalleryId);i&&this.showPicturesModal(i),this.pendingOpenGalleryId=null}}catch(e){console.error("Failed to load galleries:",e),this.showErrorState(e.message)}}renderGalleries(){this.galleriesGrid.innerHTML="",this.galleries.forEach(e=>{const t=this.createGalleryCard(e);this.galleriesGrid.appendChild(t)})}createGalleryCard(e){const t=document.createElement("div");t.className="gallery-card",t.dataset.galleryId=e.id;const i=e.cover_image_url||"/assets/img/gallery-placeholder.svg",s=e.picture_count||0,r=e.is_public?"Public":"Private";t.innerHTML=`
      <div class="gallery-card__cover">
        <img src="${i}" alt="${this.escapeHtml(e.name)}" class="gallery-card__image">
        <div class="gallery-card__overlay">
          <button class="gallery-card__action" data-action="view-pictures" aria-label="View pictures">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
          </button>
        </div>
      </div>
      <div class="gallery-card__content">
        <h3 class="gallery-card__title">${this.escapeHtml(e.name)}</h3>
        ${e.description?`<p class="gallery-card__description">${this.escapeHtml(e.description)}</p>`:""}
        <div class="gallery-card__meta">
          <span class="gallery-card__count">${s} ${s===1?"picture":"pictures"}</span>
          <span class="gallery-card__visibility">${r}</span>
        </div>
      </div>
      <div class="gallery-card__actions">
        <button class="btn btn--icon" data-action="edit" aria-label="Edit gallery">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
        <button class="btn btn--icon btn--danger" data-action="delete" aria-label="Delete gallery">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        </button>
      </div>
    `;const a=t.querySelector('[data-action="view-pictures"]');a&&a.addEventListener("click",()=>this.showPicturesModal(e));const o=t.querySelector('[data-action="edit"]');o&&o.addEventListener("click",()=>this.showGalleryModal(e));const l=t.querySelector('[data-action="delete"]');return l&&l.addEventListener("click",()=>this.showDeleteModal(e)),t}showGalleryModal(e=null){const t=document.getElementById("galleryModal"),i=document.getElementById("galleryModalTitle"),s=document.getElementById("galleryForm"),r=document.getElementById("saveGalleryBtn"),a=document.getElementById("galleryLatitude"),o=document.getElementById("galleryLongitude"),l=document.getElementById("galleryTags"),c=document.getElementById("galleryCoverImage"),d=document.getElementById("galleryCoverPreview"),u=document.getElementById("galleryIsGeo");if(!(!t||!s)){if(this.currentGallery=e,this.coverImageFile=null,e){i.textContent="Edit Gallery",r.querySelector(".btn__text").textContent="Update Gallery",document.getElementById("galleryName").value=e.name||"",document.getElementById("galleryDescription").value=e.description||"",document.getElementById("galleryIsPublic").checked=e.is_public||!1,document.getElementById("galleryId").value=e.id,a&&(a.value=e.latitude??""),o&&(o.value=e.longitude??""),l&&(l.value=Array.isArray(e.tags)?e.tags.join(", "):""),c&&(c.value=""),d&&(d.innerHTML="",e.cover_image_url&&(d.innerHTML=`
            <img src="${e.cover_image_url}" alt="Cover image preview">
            <span>Current cover image</span>
          `));const g=this.isGeoGalleryEnabled(e);u&&(u.checked=g),this.toggleGeoFields(g)}else i.textContent="Create Gallery",r.querySelector(".btn__text").textContent="Create Gallery",s.reset(),document.getElementById("galleryId").value="",a&&(a.value=""),o&&(o.value=""),l&&(l.value=""),c&&(c.value=""),d&&(d.innerHTML=""),u&&(u.checked=!1),this.toggleGeoFields(!1);this.clearFormErrors(),this.openModal(t)}}handleCoverImageSelect(e){const t=e.target.files?.[0],i=document.getElementById("galleryCoverPreview");if(this.coverImageFile=null,!t){i&&(i.innerHTML="");return}if(!t.type.startsWith("image/")){this.showFieldError("coverImageError","Cover image must be a valid image file"),i&&(i.innerHTML="");return}const s=10*1024*1024;if(t.size>s){this.showFieldError("coverImageError","Cover image exceeds 10MB limit"),i&&(i.innerHTML="");return}if(this.coverImageFile=t,this.showFieldError("coverImageError",""),i){i.innerHTML="";const r=new FileReader;r.onload=a=>{i.innerHTML=`
          <img src="${a.target.result}" alt="Cover image preview">
          <span>Selected cover image</span>
        `},r.readAsDataURL(t)}}useCurrentGalleryLocation(){const e=document.getElementById("galleryLatitude"),t=document.getElementById("galleryLongitude");if(typeof window<"u"&&window.isSecureContext===!1){this.showFieldError("locationError","Location requires HTTPS or localhost. Enter coordinates manually.");return}if(!navigator.geolocation){this.showFieldError("locationError","Geolocation is not supported by this browser");return}navigator.geolocation.getCurrentPosition(i=>{e&&(e.value=i.coords.latitude.toString()),t&&(t.value=i.coords.longitude.toString()),this.showFieldError("locationError",""),this.showToast("Location added to gallery","success")},i=>{let s="Unable to retrieve your location";i&&i.code===1?s="Location permission denied. Enable it in your browser settings.":i&&i.code===2?s="Location unavailable. Try again or enter coordinates manually.":i&&i.code===3&&(s="Location request timed out. Try again."),this.showFieldError("locationError",s)},{enableHighAccuracy:!0,timeout:1e4})}async handleGallerySubmit(){const e=document.getElementById("galleryForm"),t=new FormData(e),i=document.getElementById("galleryId").value,s=t.get("is_geo")==="on",r=s?parseFloat(t.get("latitude")):NaN,a=s?parseFloat(t.get("longitude")):NaN,o=Number.isFinite(r),l=Number.isFinite(a),c=this.parseTags(t.get("tags")),d={name:t.get("name"),description:t.get("description")||null,is_public:t.get("is_public")==="on",gallery_type:s?"geo_galleries":"regular_galleries"};if(this.clearFormErrors(),!d.name||d.name.trim().length===0){this.showFieldError("nameError","Gallery name is required");return}if(s&&(!o||!l)){this.showFieldError("locationError","Latitude and longitude are required for geo galleries");return}s&&(d.latitude=r,d.longitude=a),(i||c.length>0)&&(d.tags=c);const u=s,g=!!this.currentGallery?.cover_image_id;if(u&&!this.coverImageFile&&!g){this.showFieldError("coverImageError","Cover image is required for geo galleries");return}const f=document.getElementById("saveGalleryBtn");f.disabled=!0;try{this.coverImageFile&&(d.cover_image_id=await this.uploadCoverImage(this.coverImageFile)),i?await this.updateGallery(i,d):await this.createGallery(d);const p=document.getElementById("galleryModal");this.closeModal(p),await this.loadGalleries()}catch(p){console.error("Failed to save gallery:",p),this.showToast(p.message,"error")}finally{f.disabled=!1}}async createGallery(e){const t=await fetch(`${this.baseUrl}/api/v1/galleries`,{method:"POST",credentials:"include",headers:B({Accept:"application/json"}),body:JSON.stringify(e)});if(!t.ok){const i=await t.json();throw new Error(i.error||"Failed to create gallery")}return this.showToast("Gallery created successfully","success"),t.json()}async updateGallery(e,t){const i=await fetch(`${this.baseUrl}/api/v1/galleries/${e}`,{method:"PUT",credentials:"include",headers:B({Accept:"application/json"}),body:JSON.stringify(t)});if(!i.ok){const s=await i.json();throw new Error(s.error||"Failed to update gallery")}return this.showToast("Gallery updated successfully","success"),i.json()}showDeleteModal(e){this.currentGallery=e;const t=document.getElementById("deleteModal"),i=document.getElementById("deleteMessage");!t||!i||(i.textContent=`Are you sure you want to delete "${e.name}"? This will also delete all pictures in this gallery. This action cannot be undone.`,this.openModal(t))}async handleDelete(){if(!this.currentGallery)return;const e=document.getElementById("confirmDeleteBtn");e.disabled=!0;try{await this.deleteGallery(this.currentGallery.id);const t=document.getElementById("deleteModal");this.closeModal(t),this.currentGallery=null,await this.loadGalleries()}catch(t){console.error("Failed to delete gallery:",t),this.showToast(t.message,"error")}finally{e.disabled=!1}}async deleteGallery(e){const t=await fetch(`${this.baseUrl}/api/v1/galleries/${e}`,{method:"DELETE",credentials:"include",headers:B({Accept:"application/json"})});if(!t.ok){const i=await t.json();throw new Error(i.error||"Failed to delete gallery")}this.showToast("Gallery deleted successfully","success")}showPicturesModal(e){this.currentGalleryForPictures=e,this.selectedPictureIds.clear(),this.pendingPictureDeleteIds=[],this.currentPicturesList=[],this.updateBulkSelectionUI();const t=document.getElementById("picturesModal"),i=document.getElementById("picturesModalTitle");!t||!i||(i.textContent=`${e.name} - Pictures`,this.openModal(t),this.loadGalleryPictures(e.id))}async loadGalleryPictures(e){const t=document.getElementById("picturesGrid"),i=document.getElementById("picturesEmpty");if(!(!t||!i)){t.innerHTML='<div class="loading-state"><div class="spinner"></div><p>Loading pictures...</p></div>',i.style.display="none";try{const s=await fetch(`${this.baseUrl}/api/v1/galleries/${e}/pictures`,{method:"GET",credentials:"include",headers:B({Accept:"application/json"})});if(!s.ok)throw new Error("Failed to load pictures");const a=(await s.json()).pictures||[];a.length===0?(t.innerHTML="",i.style.display="block",this.currentPicturesList=[],this.selectedPictureIds.clear(),this.updateBulkSelectionUI()):this.renderPictures(a)}catch(s){console.error("Failed to load pictures:",s),t.innerHTML=`<div class="error-state"><p>${s.message}</p></div>`}}}renderPictures(e){const t=document.getElementById("picturesGrid");t&&(t.innerHTML="",this.selectedPictureIds.clear(),this.currentPicturesList=e,e.forEach(i=>{const s=document.createElement("div");s.className="picture-card",s.dataset.pictureId=i.id,s.innerHTML=`
        <label class="picture-card__select" aria-label="Select picture">
          <input type="checkbox" class="picture-card__checkbox" data-picture-id="${i.id}">
          <span class="picture-card__checkmark" aria-hidden="true"></span>
        </label>
        <div class="picture-card__image-wrapper" data-action="view-picture">
          <img src="${i.urls.medium}" alt="${this.escapeHtml(i.title||"Picture")}" class="picture-card__image">
        </div>
        <div class="picture-card__content">
          <h4 class="picture-card__title">${this.escapeHtml(i.title||"Untitled")}</h4>
          ${i.description?`<p class="picture-card__description">${this.escapeHtml(i.description)}</p>`:""}
        </div>
        <div class="picture-card__actions">
          <button class="btn btn--icon" data-action="edit-picture" aria-label="Edit metadata">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button class="btn btn--icon btn--danger" data-action="remove-picture" aria-label="Remove from gallery">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      `;const r=s.querySelector('[data-action="view-picture"]');r&&(r.style.cursor="pointer",r.addEventListener("click",()=>this.openPictureLightbox(e,e.indexOf(i))));const a=s.querySelector(".picture-card__checkbox");a&&(a.addEventListener("click",c=>{c.stopPropagation()}),a.addEventListener("change",c=>{c.stopPropagation();const d=a.checked;s.classList.toggle("picture-card--selected",d),this.togglePictureSelection(i.id,d)}));const o=s.querySelector('[data-action="edit-picture"]');o&&o.addEventListener("click",c=>{c.stopPropagation(),this.openPictureLightbox(e,e.indexOf(i),!0)});const l=s.querySelector('[data-action="remove-picture"]');l&&l.addEventListener("click",c=>{c.stopPropagation(),this.openPictureDeleteModal([i.id])}),t.appendChild(s)}),this.updateBulkSelectionUI())}async deletePicturesFromGallery(e){if(!(!this.currentGalleryForPictures||e.length===0))try{const t=await fetch(`${this.baseUrl}/api/v1/galleries/${this.currentGalleryForPictures.id}/pictures/bulk-delete`,{method:"POST",credentials:"include",headers:B({Accept:"application/json"}),body:JSON.stringify({picture_ids:e})});if(!t.ok){const i=await t.json();throw new Error(i.error||"Failed to remove pictures")}this.showToast("Pictures removed successfully","success"),this.selectedPictureIds.clear(),this.updateBulkSelectionUI(),this.currentGalleryForPictures&&this.loadGalleryPictures(this.currentGalleryForPictures.id)}catch(t){console.error("Failed to remove pictures:",t),this.showToast(t.message,"error")}}togglePictureSelection(e,t){t?this.selectedPictureIds.add(e):this.selectedPictureIds.delete(e),this.updateBulkSelectionUI()}handleSelectAllPictures(){const e=this.selectAllPicturesCheckbox?.checked,t=this.currentPicturesList.map(s=>s.id);this.selectedPictureIds=new Set(e?t:[]),document.querySelectorAll(".picture-card__checkbox").forEach(s=>{s.checked=e;const r=s.closest(".picture-card");r&&r.classList.toggle("picture-card--selected",e)}),this.updateBulkSelectionUI()}updateBulkSelectionUI(){const e=this.selectedPictureIds.size,t=this.currentPicturesList.length;this.selectedPicturesCount&&(this.selectedPicturesCount.textContent=`${e} selected`),this.selectAllPicturesCheckbox&&(this.selectAllPicturesCheckbox.disabled=t===0,this.selectAllPicturesCheckbox.checked=e>0&&e===t,this.selectAllPicturesCheckbox.indeterminate=e>0&&e<t),this.bulkDeletePicturesBtn&&(this.bulkDeletePicturesBtn.disabled=e===0,this.bulkDeletePicturesBtn.classList.toggle("btn--hidden",e===0))}openPictureDeleteModal(e){this.pendingPictureDeleteIds=e;const t=document.getElementById("pictureDeleteModal"),i=document.getElementById("pictureDeleteMessage");if(!t||!i)return;const s=e.length;i.textContent=s===1?"Remove this picture from the gallery?":`Remove ${s} pictures from the gallery?`,this.openModal(t)}async handleConfirmPictureDelete(){const e=document.getElementById("pictureDeleteModal"),t=document.getElementById("confirmPictureDeleteBtn");if(!this.pendingPictureDeleteIds||this.pendingPictureDeleteIds.length===0){e&&this.closeModal(e);return}t&&(t.disabled=!0),await this.deletePicturesFromGallery(this.pendingPictureDeleteIds),e&&this.closeModal(e),t&&(t.disabled=!1),this.pendingPictureDeleteIds=[]}openPictureLightbox(e,t,i=!1){console.log("Opening picture lightbox",{picturesCount:e.length,index:t,editMode:i}),this.currentPictures=e,this.currentPictureIndex=t;const s=e[t];let r=document.getElementById("pictureLightbox");if(!r){console.log("Creating new lightbox"),r=document.createElement("div"),r.id="pictureLightbox",r.className="image-lightbox",r.innerHTML=`
        <div class="image-lightbox__container">
          <div class="image-lightbox__image-section">
            <img class="image-lightbox__image" src="" alt="">
            ${e.length>1?`
              <button class="image-lightbox__nav image-lightbox__nav--prev" aria-label="Previous">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
              </button>
              <button class="image-lightbox__nav image-lightbox__nav--next" aria-label="Next">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </button>
            `:""}
          </div>
          <div class="image-lightbox__meta-section">
            <div class="image-lightbox__header">
              <h3 class="image-lightbox__title">Picture Details</h3>
              <button class="image-lightbox__close" aria-label="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="image-lightbox__body">
              <div class="lightbox-form" id="lightboxMetaView">
                <div class="form__group">
                  <h4 class="lightbox__meta-title" style="margin: 0 0 0.5rem 0; color: var(--text-primary);"></h4>
                  <p class="lightbox__meta-description" style="margin: 0; color: var(--text-secondary);"></p>
                  <div class="lightbox__meta-location" style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--text-secondary);">
                    <span class="lightbox__meta-label" style="font-weight: 600; color: var(--text-primary);">Location:</span>
                    <span class="lightbox__meta-value"></span>
                  </div>
                  ${e.length>1?'<p class="lightbox__counter" style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-tertiary);"></p>':""}
                </div>
              </div>
              <div class="lightbox-form" id="lightboxMetaEdit" style="display: none;">
                <div class="form__group">
                  <label class="form__label">Title</label>
                  <input type="text" class="form__input lightbox__title-input" placeholder="Enter title">
                </div>
                <div class="form__group">
                  <label class="form__label">Description</label>
                  <textarea class="form__textarea lightbox__description-input" placeholder="Enter description (optional)" rows="4"></textarea>
                </div>
                <div class="form__group">
                  <label class="form__label">Location (optional)</label>
                  <div class="geo-fields">
                    <input type="number" class="form__input lightbox__latitude-input" placeholder="Latitude" step="any">
                    <input type="number" class="form__input lightbox__longitude-input" placeholder="Longitude" step="any">
                  </div>
                  <span class="form__error lightbox__location-error"></span>
                </div>
              </div>
            </div>
            <div class="image-lightbox__footer" id="lightboxFooterView">
              <button class="btn btn--primary lightbox__edit-btn">Edit Metadata</button>
            </div>
            <div class="image-lightbox__footer" id="lightboxFooterEdit" style="display: none; gap: 0.5rem;">
              <button class="btn btn--secondary lightbox__cancel-edit">Cancel</button>
              <button class="btn btn--primary lightbox__save-edit">Save</button>
            </div>
          </div>
        </div>
      `,document.body.appendChild(r),r.querySelector(".image-lightbox__close").addEventListener("click",()=>{console.log("Close button clicked"),this.closePictureLightbox()});const o=r.querySelector(".image-lightbox__image-section");if(o.addEventListener("click",u=>{u.target===o&&(console.log("Backdrop clicked"),this.closePictureLightbox())}),e.length>1){const u=r.querySelector(".image-lightbox__nav--prev"),g=r.querySelector(".image-lightbox__nav--next");u.addEventListener("click",()=>{console.log("Previous button clicked"),this.navigatePictureLightbox(-1)}),g.addEventListener("click",()=>{console.log("Next button clicked"),this.navigatePictureLightbox(1)})}const l=r.querySelector(".lightbox__edit-btn"),c=r.querySelector(".lightbox__cancel-edit"),d=r.querySelector(".lightbox__save-edit");l.addEventListener("click",()=>{console.log("Edit button clicked"),this.togglePictureEditMode(!0)}),c.addEventListener("click",()=>{console.log("Cancel edit clicked"),this.togglePictureEditMode(!1)}),d.addEventListener("click",()=>{console.log("Save button clicked"),this.savePictureMetadata()}),this.pictureLightboxKeyHandler=u=>{u.key==="Escape"?(console.log("Escape key pressed"),this.closePictureLightbox()):u.key==="ArrowLeft"&&e.length>1?(console.log("Left arrow key pressed"),this.navigatePictureLightbox(-1)):u.key==="ArrowRight"&&e.length>1&&(console.log("Right arrow key pressed"),this.navigatePictureLightbox(1))},document.addEventListener("keydown",this.pictureLightboxKeyHandler)}this.updatePictureLightbox(s,i),r.classList.add("image-lightbox--open"),document.body.style.overflow="hidden",console.log("Lightbox opened")}updatePictureLightbox(e,t=!1){const i=document.getElementById("pictureLightbox");if(!i)return;const s=i.querySelector(".image-lightbox__image"),r=i.querySelector(".lightbox__meta-title"),a=i.querySelector(".lightbox__meta-description"),o=i.querySelector(".lightbox__meta-value"),l=i.querySelector(".lightbox__counter"),c=i.querySelector(".lightbox__title-input"),d=i.querySelector(".lightbox__description-input"),u=i.querySelector(".lightbox__latitude-input"),g=i.querySelector(".lightbox__longitude-input");s.src=e.urls.large,s.alt=e.title||"Picture",r.textContent=e.title||"Untitled",a.textContent=e.description||"",a.style.display=e.description?"block":"none",o&&(o.textContent=this.formatCoordinates(e.latitude,e.longitude)),l&&this.currentPictures.length>1&&(l.textContent=`${this.currentPictureIndex+1} / ${this.currentPictures.length}`),c.value=e.title||"",d.value=e.description||"",u&&(u.value=e.latitude??""),g&&(g.value=e.longitude??""),t&&this.togglePictureEditMode(!0)}togglePictureEditMode(e){const t=document.getElementById("pictureLightbox");if(!t)return;const i=document.getElementById("lightboxMetaView"),s=document.getElementById("lightboxMetaEdit"),r=document.getElementById("lightboxFooterView"),a=document.getElementById("lightboxFooterEdit");if(e)i.style.display="none",s.style.display="block",r.style.display="none",a.style.display="flex";else{i.style.display="block",s.style.display="none",r.style.display="flex",a.style.display="none";const o=this.currentPictures[this.currentPictureIndex],l=t.querySelector(".lightbox__title-input"),c=t.querySelector(".lightbox__description-input"),d=t.querySelector(".lightbox__latitude-input"),u=t.querySelector(".lightbox__longitude-input");l.value=o.title||"",c.value=o.description||"",d&&(d.value=o.latitude??""),u&&(u.value=o.longitude??"")}}async savePictureMetadata(){const e=document.getElementById("pictureLightbox");if(!e)return;const t=e.querySelector(".lightbox__title-input"),i=e.querySelector(".lightbox__description-input"),s=e.querySelector(".lightbox__latitude-input"),r=e.querySelector(".lightbox__longitude-input"),a=e.querySelector(".lightbox__location-error"),o=this.currentPictures[this.currentPictureIndex],l=t.value.trim()||"Untitled",c=i.value.trim()||null,d=s?parseFloat(s.value):NaN,u=r?parseFloat(r.value):NaN,g=Number.isFinite(d),f=Number.isFinite(u);if(a&&(a.textContent=""),g!==f){a&&(a.textContent="Latitude and longitude must be provided together");return}const p={title:l,description:c};g&&f&&(p.latitude=d,p.longitude=u);try{const I=await fetch(`${this.baseUrl}/api/v1/galleries/${this.currentGalleryForPictures.id}/pictures/${o.id}`,{method:"PUT",credentials:"include",headers:B({Accept:"application/json"}),body:JSON.stringify(p)});if(!I.ok){const $=await I.json();throw new Error($.error||"Failed to update picture")}o.title=l,o.description=c,g&&f&&(o.latitude=d,o.longitude=u),this.showToast("Picture updated successfully","success"),this.togglePictureEditMode(!1),this.updatePictureLightbox(o,!1),this.currentGalleryForPictures&&this.loadGalleryPictures(this.currentGalleryForPictures.id)}catch(I){console.error("Failed to update picture:",I),this.showToast(I.message,"error")}}navigatePictureLightbox(e){const t=this.currentPictureIndex+e;if(t>=0&&t<this.currentPictures.length){this.currentPictureIndex=t;const i=this.currentPictures[t];this.updatePictureLightbox(i,!1)}}closePictureLightbox(){console.log("Closing picture lightbox");const e=document.getElementById("pictureLightbox");e&&(e.classList.remove("image-lightbox--open"),document.body.style.overflow="",this.pictureLightboxKeyHandler&&(document.removeEventListener("keydown",this.pictureLightboxKeyHandler),this.pictureLightboxKeyHandler=null),this.currentPictures=null,this.currentPictureIndex=-1)}handleAddPictures(){if(!this.currentGalleryForPictures){this.showToast("No gallery selected","error");return}const e=document.getElementById("uploadSection"),t=document.getElementById("picturesGrid"),i=document.getElementById("picturesEmpty"),s=document.getElementById("addPictureBtn");e&&(e.style.display="block"),t&&(t.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="none")}triggerFileInput(){const e=document.getElementById("pictureFileInput");e&&e.click()}handleFileSelect(e){const t=Array.from(e.target.files);this.processFiles(t)}handleDragOver(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.add("upload-drop-zone--active")}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("upload-drop-zone--active")}handleDrop(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("upload-drop-zone--active");const t=Array.from(e.dataTransfer.files);this.processFiles(t)}async processFiles(e){const t=e.filter(r=>r.type.startsWith("image/"));if(t.length===0){this.showToast("Please select valid image files","error");return}const i=10*1024*1024,s=t.filter(r=>r.size>i?(this.showToast(`${r.name} exceeds 10MB limit`,"error"),!1):!0);s.length!==0&&(this.selectedFiles=s,this.fileMetadata=s.map(r=>({title:r.name.replace(/\.[^/.]+$/,""),description:"",latitude:null,longitude:null,locationSource:null})),this.exifEnabled&&await this.populateExifLocations(s),this.showFilePreview())}async populateExifLocations(e){const t=e.map(async(i,s)=>{try{const r=await Ut.gps(i);r&&typeof r.latitude=="number"&&typeof r.longitude=="number"&&(this.fileMetadata[s].latitude=r.latitude,this.fileMetadata[s].longitude=r.longitude,this.fileMetadata[s].locationSource="exif")}catch(r){console.warn(`Failed to parse EXIF data for ${i.name}`,r)}});await Promise.all(t)}showFilePreview(){const e=document.getElementById("uploadDropZone"),t=document.getElementById("uploadPreview"),i=document.querySelector(".upload-actions"),s=document.getElementById("uploadFilesBtn");e&&(e.style.display="none"),t&&(t.style.display="grid",t.innerHTML="",this.selectedFiles.forEach((r,a)=>{const o=new FileReader;o.onload=l=>{const c=document.createElement("div");c.className="upload-preview__item",c.dataset.index=a,c.innerHTML=`
            <img src="${l.target.result}" alt="${this.escapeHtml(r.name)}" class="upload-preview__image">
            <div class="upload-preview__info">
              <span class="upload-preview__name">${this.escapeHtml(r.name)}</span>
              <span class="upload-preview__size">${this.formatFileSize(r.size)}</span>
            </div>
            <button type="button" class="upload-preview__edit" data-index="${a}" aria-label="Edit details">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
            <button type="button" class="upload-preview__remove" data-index="${a}" aria-label="Remove file">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          `;const d=c.querySelector(".upload-preview__image");d&&d.addEventListener("click",()=>this.openLightbox(a));const u=c.querySelector(".upload-preview__edit");u&&u.addEventListener("click",f=>{f.stopPropagation(),this.openLightbox(a)});const g=c.querySelector(".upload-preview__remove");g&&g.addEventListener("click",f=>{f.stopPropagation(),this.removeFile(a)}),t.appendChild(c)},o.readAsDataURL(r)})),i&&(i.style.display="flex"),s&&(s.disabled=!1)}removeFile(e){this.selectedFiles.splice(e,1),this.selectedFiles.length===0?this.cancelUpload():this.showFilePreview()}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,i=["Bytes","KB","MB"],s=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,s)*100)/100+" "+i[s]}parseTags(e){return e?e.split(",").map(t=>t.trim()).filter(t=>t.length>0):[]}formatCoordinates(e,t){return typeof e!="number"||typeof t!="number"?"No location":`${e.toFixed(6)}, ${t.toFixed(6)}`}cancelUpload(){this.selectedFiles=[],this.fileMetadata=[];const e=document.getElementById("uploadSection"),t=document.getElementById("uploadDropZone"),i=document.getElementById("uploadPreview"),s=document.querySelector(".upload-actions"),r=document.getElementById("uploadFilesBtn"),a=document.getElementById("uploadProgress"),o=document.getElementById("uploadProgressText"),l=document.getElementById("uploadProgressFill"),c=document.getElementById("picturesGrid");document.getElementById("picturesEmpty");const d=document.getElementById("addPictureBtn"),u=document.getElementById("pictureFileInput");e&&(e.style.display="none"),t&&(t.style.display="block"),i&&(i.style.display="none",i.innerHTML=""),s&&(s.style.display="none"),r&&(r.disabled=!1,r.querySelector(".btn__text").textContent="Upload & Add to Gallery"),a&&o&&l&&(a.style.display="none",o.textContent="0/0",l.style.width="0%"),c&&(c.style.display="grid"),d&&(d.style.display="inline-flex"),u&&(u.value=""),this.currentGalleryForPictures&&this.loadGalleryPictures(this.currentGalleryForPictures.id)}async uploadAndAddPictures(){if(!this.currentGalleryForPictures||this.selectedFiles.length===0)return;const e=document.getElementById("uploadFilesBtn"),t=document.getElementById("uploadProgress"),i=document.getElementById("uploadProgressText"),s=document.getElementById("uploadProgressFill"),r=this.selectedFiles.length;e&&(e.disabled=!0,e.querySelector(".btn__text").textContent="Uploading..."),t&&i&&s&&(t.style.display="flex",i.textContent=`0/${r}`,s.style.width="0%");try{for(let a=0;a<this.selectedFiles.length;a++){const o=this.selectedFiles[a],l=this.fileMetadata[a],c=await this.uploadFile(o);await this.addPictureToGallery(c,l.title,l.description,l.latitude,l.longitude);const d=a+1;t&&i&&s&&(i.textContent=`${d}/${r}`,s.style.width=`${Math.round(d/r*100)}%`)}this.showToast(`${this.selectedFiles.length} picture(s) added successfully`,"success"),this.cancelUpload(),await this.loadGalleryPictures(this.currentGalleryForPictures.id),await this.loadGalleries()}catch(a){console.error("Failed to upload pictures:",a),this.showToast(a.message,"error"),e&&(e.disabled=!1,e.querySelector(".btn__text").textContent="Upload & Add to Gallery")}}async uploadCoverImage(e){return this.uploadFile(e)}async uploadFile(e){const t=new FormData;t.append("file",e);const i={},s=Me();s&&(i["X-CSRF-TOKEN"]=s);const r=await fetch(`${this.baseUrl}/api/v1/upload/public`,{method:"POST",credentials:"include",headers:i,body:t});if(!r.ok){const o=await r.json();throw new Error(o.error||"Failed to upload file")}return(await r.json()).id}async addPictureToGallery(e,t,i,s,r){const a={upload_id:e,title:t||"Untitled",description:i||null};Number.isFinite(s)&&Number.isFinite(r)&&(a.latitude=s,a.longitude=r);const o=await fetch(`${this.baseUrl}/api/v1/galleries/${this.currentGalleryForPictures.id}/pictures`,{method:"POST",credentials:"include",headers:B({Accept:"application/json"}),body:JSON.stringify(a)});if(!o.ok){const l=await o.json();throw new Error(l.error||"Failed to add picture to gallery")}return o.json()}openModal(e){e.classList.add("modal--open"),e.setAttribute("aria-hidden","false")}closeModal(e){e.classList.remove("modal--open"),e.setAttribute("aria-hidden","true"),e&&e.id==="picturesModal"&&this.loadGalleries()}showLoadingState(){this.loadingState.style.display="block",this.errorState.style.display="none",this.emptyState.style.display="none",this.galleriesGrid.style.display="none"}showErrorState(e){this.loadingState.style.display="none",this.errorState.style.display="block",this.emptyState.style.display="none",this.galleriesGrid.style.display="none";const t=this.errorState.querySelector(".error-state__message");t&&(t.textContent=e)}showEmptyState(){this.loadingState.style.display="none",this.errorState.style.display="none",this.emptyState.style.display="block",this.galleriesGrid.style.display="none"}showContentState(){this.loadingState.style.display="none",this.errorState.style.display="none",this.emptyState.style.display="none",this.galleriesGrid.style.display="grid"}clearFormErrors(){document.querySelectorAll(".form__error").forEach(t=>{t.textContent=""})}showFieldError(e,t){const i=document.getElementById(e);i&&(i.textContent=t)}isGeoGalleryEnabled(e){return e?typeof e.gallery_type=="string"?e.gallery_type==="geo_galleries":Number.isFinite(e.latitude)&&Number.isFinite(e.longitude):!1}toggleGeoFields(e){document.querySelectorAll("[data-geo-field]").forEach(i=>{i.hidden=!e,i.querySelectorAll("input, textarea, select, button").forEach(s=>{s.disabled=!e})}),e||this.showFieldError("locationError","")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}openLightbox(e){if(e<0||e>=this.selectedFiles.length)return;this.currentLightboxIndex=e;const t=this.selectedFiles[e],i=this.fileMetadata[e],s=document.getElementById("lightboxImage");if(s){const g=new FileReader;g.onload=f=>{s.src=f.target.result,s.alt=t.name},g.readAsDataURL(t)}const r=document.getElementById("lightboxTitle"),a=document.getElementById("lightboxDescription"),o=document.getElementById("lightboxFileIndex"),l=document.getElementById("lightboxLatitude"),c=document.getElementById("lightboxLongitude"),d=document.getElementById("lightboxLocationSource");r&&(r.value=i.title),a&&(a.value=i.description||""),o&&(o.value=e),l&&(l.value=i.latitude??""),c&&(c.value=i.longitude??""),d&&(d.textContent=i.locationSource==="exif"?"Location detected from EXIF data.":""),this.updateLightboxNav();const u=document.getElementById("imageLightbox");u&&(u.classList.add("image-lightbox--open"),u.setAttribute("aria-hidden","false"))}closeLightbox(){const e=document.getElementById("imageLightbox");e&&(e.classList.remove("image-lightbox--open"),e.setAttribute("aria-hidden","true"));const t=document.getElementById("lightboxTitle"),i=document.getElementById("lightboxDescription"),s=document.getElementById("lightboxLatitude"),r=document.getElementById("lightboxLongitude"),a=document.getElementById("lightboxLocationError"),o=document.getElementById("lightboxLocationSource");t&&(t.value=""),i&&(i.value=""),s&&(s.value=""),r&&(r.value=""),a&&(a.textContent=""),o&&(o.textContent=""),this.currentLightboxIndex=0}navigateLightbox(e){const t=this.currentLightboxIndex+e;if(t>=0&&t<this.selectedFiles.length){const i=document.getElementById("lightboxTitle"),s=document.getElementById("lightboxDescription"),r=document.getElementById("lightboxLatitude"),a=document.getElementById("lightboxLongitude");if(i&&this.currentLightboxIndex>=0&&this.currentLightboxIndex<this.fileMetadata.length){const o=r?parseFloat(r.value):NaN,l=a?parseFloat(a.value):NaN,c=Number.isFinite(o),d=Number.isFinite(l);this.fileMetadata[this.currentLightboxIndex]={title:i.value.trim()||this.fileMetadata[this.currentLightboxIndex].title,description:s?s.value.trim():"",latitude:c?o:null,longitude:d?l:null,locationSource:this.fileMetadata[this.currentLightboxIndex].locationSource}}this.openLightbox(t)}}updateLightboxNav(){const e=document.getElementById("lightboxPrevBtn"),t=document.getElementById("lightboxNextBtn");e&&(e.disabled=this.currentLightboxIndex===0),t&&(t.disabled=this.currentLightboxIndex===this.selectedFiles.length-1)}saveLightboxMetadata(e=!0){const t=document.getElementById("lightboxTitle"),i=document.getElementById("lightboxDescription"),s=document.getElementById("lightboxFileIndex"),r=document.getElementById("lightboxLatitude"),a=document.getElementById("lightboxLongitude");if(!t||!s)return;const o=parseInt(s.value,10);if(isNaN(o)||o<0||o>=this.selectedFiles.length)return;const l=t.value.trim(),c=r?parseFloat(r.value):NaN,d=a?parseFloat(a.value):NaN,u=Number.isFinite(c),g=Number.isFinite(d);if(!l){this.showFieldError("lightboxTitleError","Title is required");return}if(u!==g){this.showFieldError("lightboxLocationError","Latitude and longitude must be provided together");return}this.clearFormErrors(),this.fileMetadata[o]={title:l,description:i?i.value.trim():"",latitude:u?c:null,longitude:g?d:null,locationSource:this.fileMetadata[o].locationSource};const f=document.querySelector(`.upload-preview__item[data-index="${o}"]`);if(f){const p=f.querySelector(".upload-preview__name");p&&(p.textContent=l)}e&&(this.showToast("Image details saved","success"),this.closeLightbox())}}function ht(){const n=document.getElementById("galleriesGrid"),e=document.getElementById("loadingState"),t=document.getElementById("errorState"),i=document.getElementById("emptyState");if(!n||!e||!t||!i){console.error("GalleriesPage: Required DOM elements not found");return}const s=window.BASE_URL||"",r=Ht(),a=new Vt({baseUrl:s,galleriesGrid:n,loadingState:e,errorState:t,emptyState:i,showToast:r});typeof window<"u"&&(window.galleriesController=a)}function Ht(){const n={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)"};return function(t,i="success"){typeof Toastify<"u"?Toastify({text:t,duration:4e3,gravity:"top",position:"right",style:{background:n[i]||n.info}}).showToast():console.log(`[${i.toUpperCase()}] ${t}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ht):ht()})();

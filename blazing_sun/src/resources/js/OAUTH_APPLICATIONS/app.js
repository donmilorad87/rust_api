(function(){"use strict";var U=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var E={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */(function(p){(function(t,e){p.exports?p.exports=e():t.Toastify=e()})(U,function(t){var e=function(i){return new e.lib.init(i)},o="1.12.0";e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:o,constructor:e,init:function(i){return i||(i={}),this.options={},this.toastElement=null,this.options.text=i.text||e.defaults.text,this.options.node=i.node||e.defaults.node,this.options.duration=i.duration===0?0:i.duration||e.defaults.duration,this.options.selector=i.selector||e.defaults.selector,this.options.callback=i.callback||e.defaults.callback,this.options.destination=i.destination||e.defaults.destination,this.options.newWindow=i.newWindow||e.defaults.newWindow,this.options.close=i.close||e.defaults.close,this.options.gravity=i.gravity==="bottom"?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=i.positionLeft||e.defaults.positionLeft,this.options.position=i.position||e.defaults.position,this.options.backgroundColor=i.backgroundColor||e.defaults.backgroundColor,this.options.avatar=i.avatar||e.defaults.avatar,this.options.className=i.className||e.defaults.className,this.options.stopOnFocus=i.stopOnFocus===void 0?e.defaults.stopOnFocus:i.stopOnFocus,this.options.onClick=i.onClick||e.defaults.onClick,this.options.offset=i.offset||e.defaults.offset,this.options.escapeMarkup=i.escapeMarkup!==void 0?i.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=i.ariaLive||e.defaults.ariaLive,this.options.style=i.style||e.defaults.style,i.backgroundColor&&(this.options.style.background=i.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var i=document.createElement("div");i.className="toastify on "+this.options.className,this.options.position?i.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(i.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):i.className+=" toastify-right",i.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var a in this.options.style)i.style[a]=this.options.style[a];if(this.options.ariaLive&&i.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)i.appendChild(this.options.node);else if(this.options.escapeMarkup?i.innerText=this.options.text:i.innerHTML=this.options.text,this.options.avatar!==""){var d=document.createElement("img");d.src=this.options.avatar,d.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?i.appendChild(d):i.insertAdjacentElement("afterbegin",d)}if(this.options.close===!0){var r=document.createElement("button");r.type="button",r.setAttribute("aria-label","Close"),r.className="toast-close",r.innerHTML="&#10006;",r.addEventListener("click",(function(m){m.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}).bind(this));var l=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&l>360?i.insertAdjacentElement("afterbegin",r):i.appendChild(r)}if(this.options.stopOnFocus&&this.options.duration>0){var c=this;i.addEventListener("mouseover",function(m){window.clearTimeout(i.timeOutValue)}),i.addEventListener("mouseleave",function(){i.timeOutValue=window.setTimeout(function(){c.removeElement(i)},c.options.duration)})}if(typeof this.options.destination<"u"&&i.addEventListener("click",(function(m){m.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}).bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&i.addEventListener("click",(function(m){m.stopPropagation(),this.options.onClick()}).bind(this)),typeof this.options.offset=="object"){var h=n("x",this.options),u=n("y",this.options),f=this.options.position=="left"?h:"-"+h,g=this.options.gravity=="toastify-top"?u:"-"+u;i.style.transform="translate("+f+","+g+")"}return i},showToast:function(){this.toastElement=this.buildToast();var i;if(typeof this.options.selector=="string"?i=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?i=this.options.selector:i=document.body,!i)throw"Root element is not defined";var a=e.defaults.oldestFirst?i.firstChild:i.lastChild;return i.insertBefore(this.toastElement,a),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((function(){this.removeElement(this.toastElement)}).bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(i){i.className=i.className.replace(" on",""),window.setTimeout((function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),i.parentNode&&i.parentNode.removeChild(i),this.options.callback.call(i),e.reposition()}).bind(this),400)}},e.reposition=function(){for(var i={top:15,bottom:15},a={top:15,bottom:15},d={top:15,bottom:15},r=document.getElementsByClassName("toastify"),l,c=0;c<r.length;c++){s(r[c],"toastify-top")===!0?l="toastify-top":l="toastify-bottom";var h=r[c].offsetHeight;l=l.substr(9,l.length-1);var u=15,f=window.innerWidth>0?window.innerWidth:screen.width;f<=360?(r[c].style[l]=d[l]+"px",d[l]+=h+u):s(r[c],"toastify-left")===!0?(r[c].style[l]=i[l]+"px",i[l]+=h+u):(r[c].style[l]=a[l]+"px",a[l]+=h+u)}return this};function n(i,a){return a.offset[i]?isNaN(a.offset[i])?a.offset[i]:a.offset[i]+"px":"0px"}function s(i,a){return!i||typeof a!="string"?!1:!!(i.className&&i.className.trim().split(/\s+/gi).indexOf(a)>-1)}return e.lib.init.prototype=e.lib,e})})(E);var R=E.exports;const b=P(R);class N{constructor(){this.currentClientId=null,this.currentClientName=null,this.currentClientType=null,this.redirectUris=[],this.grantedScopes=[],this.pkceVerifier=null,this.pkceChallenge=null,this.pendingApiProductId=null,this.pendingApiName=null,this.expandedAccordions=new Set,this.authorizedApps=[],this.authorizedAppsLoaded=!1,this.activeTab="my-apps"}init(){this.setupEventListeners(),this.setupTabNavigation(),this.loadApplications()}setupEventListeners(){var t,e,o,n,s,i,a,d,r,l,c,h,u,f,g,m,v,_,C,w,A,I,k,S,B,L,x,M,T,$,D,z;(t=document.getElementById("createAppBtn"))==null||t.addEventListener("click",()=>{this.showCreateModal()}),(e=document.getElementById("createAppFromEmpty"))==null||e.addEventListener("click",()=>{this.showCreateModal()}),(o=document.getElementById("retryBtn"))==null||o.addEventListener("click",()=>{this.loadApplications()}),(n=document.getElementById("oauthAppForm"))==null||n.addEventListener("submit",y=>{this.handleCreateApp(y)}),(s=document.getElementById("cancelBtn"))==null||s.addEventListener("click",()=>{this.hideCreateModal()}),(i=document.getElementById("modalCloseBtn"))==null||i.addEventListener("click",()=>{this.hideCreateModal()}),(a=document.getElementById("detailsModalCloseBtn"))==null||a.addEventListener("click",()=>{this.hideDetailsModal()}),(d=document.querySelector("#appModal .modal__overlay"))==null||d.addEventListener("click",()=>{this.hideCreateModal()}),(r=document.querySelector("#appDetailsModal .modal__overlay"))==null||r.addEventListener("click",()=>{this.hideDetailsModal()}),(l=document.getElementById("deleteApplicationBtn"))==null||l.addEventListener("click",()=>{this.showDeleteConfirmModal()}),(c=document.getElementById("deleteConfirmCloseBtn"))==null||c.addEventListener("click",()=>{this.hideDeleteConfirmModal()}),(h=document.getElementById("cancelDeleteBtn"))==null||h.addEventListener("click",()=>{this.hideDeleteConfirmModal()}),(u=document.querySelector("#deleteConfirmModal .modal__overlay"))==null||u.addEventListener("click",()=>{this.hideDeleteConfirmModal()}),(f=document.getElementById("deleteConfirmForm"))==null||f.addEventListener("submit",y=>{this.handleDeleteConfirm(y)}),(g=document.getElementById("clientSecretCloseBtn"))==null||g.addEventListener("click",()=>{this.hideClientSecretModal()}),(m=document.getElementById("clientSecretContinueBtn"))==null||m.addEventListener("click",()=>{this.handleClientSecretContinue()}),(v=document.querySelector("#clientSecretModal .modal__overlay"))==null||v.addEventListener("click",()=>{this.hideClientSecretModal()}),(_=document.getElementById("copyClientSecretBtn"))==null||_.addEventListener("click",()=>{document.getElementById("newClientSecret").textContent,this.copyToClipboard("newClientSecret")}),(C=document.getElementById("ssoUrlCloseBtn"))==null||C.addEventListener("click",()=>{this.hideSsoUrlModal()}),(w=document.querySelector("#ssoUrlModal .modal__overlay"))==null||w.addEventListener("click",()=>{this.hideSsoUrlModal()}),(A=document.getElementById("copySsoUrlBtn"))==null||A.addEventListener("click",()=>{this.copyToClipboard("ssoUrlDisplay")}),(I=document.getElementById("regeneratePkceBtn"))==null||I.addEventListener("click",()=>{this.generatePkcePair()}),(k=document.getElementById("copyPkceVerifierBtn"))==null||k.addEventListener("click",()=>{this.copyToClipboard("pkceVerifierDisplay")}),(S=document.getElementById("copyPkceChallengeBtn"))==null||S.addEventListener("click",()=>{this.copyToClipboard("pkceChallengeDisplay")}),(B=document.getElementById("enableApiCloseBtn"))==null||B.addEventListener("click",()=>{this.hideEnableApiModal()}),(L=document.getElementById("cancelEnableApiBtn"))==null||L.addEventListener("click",()=>{this.hideEnableApiModal()}),(x=document.querySelector("#enableApiModal .modal__overlay"))==null||x.addEventListener("click",()=>{this.hideEnableApiModal()}),(M=document.getElementById("confirmEnableApiBtn"))==null||M.addEventListener("click",()=>{this.confirmEnableApi()}),(T=document.getElementById("disableApiCloseBtn"))==null||T.addEventListener("click",()=>{this.hideDisableApiModal()}),($=document.getElementById("cancelDisableApiBtn"))==null||$.addEventListener("click",()=>{this.hideDisableApiModal()}),(D=document.querySelector("#disableApiModal .modal__overlay"))==null||D.addEventListener("click",()=>{this.hideDisableApiModal()}),(z=document.getElementById("confirmDisableApiBtn"))==null||z.addEventListener("click",()=>{this.confirmDisableApi()}),this.setupEventDelegation()}setupEventDelegation(){const t=document.getElementById("appDetailsModal");if(!t)return;t.addEventListener("click",n=>{var r;const s=n.target.closest("[data-action]");if(!s)return;const i=s.dataset.action,a=parseInt(s.dataset.id,10),d=s.dataset.name;switch(i){case"delete-redirect-uri":this.deleteRedirectUri(a);break;case"delete-origin":this.deleteAuthorizedOrigin(a);break;case"enable-api":this.enableApi(a,d);break;case"disable-api":this.disableApi(a,d);break;case"toggle-accordion":this.toggleAccordion(s,a);break;case"add-redirect-uri":this.addRedirectUriInput();break;case"add-origin":this.addOriginInput();break;case"remove-input":(r=s.closest(".add-uri-form"))==null||r.remove();break;case"copy-to-clipboard":this.copyToClipboard(s.dataset.target);break;case"show-sso-url-modal":this.showSsoUrlModal();break;case"hide-sso-url-modal":this.hideSsoUrlModal();break;case"save-all-redirect-uris":this.saveAllRedirectUris();break;case"save-all-origins":this.saveAllOrigins();break}}),t.addEventListener("change",n=>{const s=n.target;if(s.classList.contains("scope-checkbox")&&!s.disabled){const i=parseInt(s.dataset.scopeId,10),a=s.dataset.scopeName;this.toggleScope(i,a,s.checked)}});const e=document.getElementById("ssoRedirectUriSelect");e&&e.addEventListener("change",()=>{this.updateSsoUrl()});const o=document.getElementById("ssoUrlModal");o&&o.addEventListener("click",n=>{const s=n.target.closest("[data-action]");if(!s)return;const i=s.dataset.action;i==="hide-sso-url-modal"?this.hideSsoUrlModal():i==="copy-to-clipboard"&&this.copyToClipboard(s.dataset.target)})}setupTabNavigation(){var o;const t=document.getElementById("myAppsTab"),e=document.getElementById("authorizedAppsTab");t==null||t.addEventListener("click",()=>{this.switchTab("my-apps")}),e==null||e.addEventListener("click",()=>{this.switchTab("authorized-apps")}),(o=document.getElementById("authorizedRetryBtn"))==null||o.addEventListener("click",()=>{this.loadAuthorizedApps()})}switchTab(t){this.activeTab=t;const e=document.getElementById("myAppsTab"),o=document.getElementById("authorizedAppsTab");t==="my-apps"?(e==null||e.classList.add("oauth-tabs__tab--active"),o==null||o.classList.remove("oauth-tabs__tab--active")):(e==null||e.classList.remove("oauth-tabs__tab--active"),o==null||o.classList.add("oauth-tabs__tab--active"));const n=document.getElementById("myAppsContent"),s=document.getElementById("authorizedAppsContent");t==="my-apps"?(this.showElement(n),n.classList.add("oauth-tab-content--active"),this.hideElement(s),s.classList.remove("oauth-tab-content--active")):(this.hideElement(n),n.classList.remove("oauth-tab-content--active"),this.showElement(s),s.classList.add("oauth-tab-content--active"),this.authorizedAppsLoaded||this.loadAuthorizedApps())}getCsrfToken(){const t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):""}showElement(t){t&&t.classList.remove("hidden")}hideElement(t){t&&t.classList.add("hidden")}showSuccess(t){b({text:t,duration:3e3,gravity:"top",position:"right",style:{background:"var(--color-success, #10b981)"}}).showToast()}showError(t){b({text:t,duration:4e3,gravity:"top",position:"right",style:{background:"var(--color-error, #ef4444)"}}).showToast()}async loadApplications(){const t=document.getElementById("loadingState"),e=document.getElementById("emptyState"),o=document.getElementById("errorState"),n=document.getElementById("appsListContainer");this.showElement(t),this.hideElement(e),this.hideElement(o),this.hideElement(n);try{const s=await fetch("/api/v1/oauth/clients",{credentials:"include",headers:{"X-CSRF-Token":this.getCsrfToken()}});if(s.status===401||s.status===403){this.hideElement(t),this.showElement(e);return}if(!s.ok)throw new Error("Failed to load applications");const a=(await s.json()).clients||[];this.hideElement(t),a.length===0?this.showElement(e):n&&(n.innerHTML=a.map(d=>this.renderAppCard(d)).join(""),this.showElement(n),a.forEach(d=>{var r;(r=document.getElementById(`app-card-${d.id}`))==null||r.addEventListener("click",()=>{this.showAppDetails(d.client_id,d.id,d.client_name)})}))}catch(s){if(console.error("Error loading applications:",s),this.hideElement(t),o){this.showElement(o);const i=o.querySelector(".error-state__message");i&&(i.textContent=s.message||"An unexpected error occurred")}}}renderAppCard(t){return`
            <div class="app-card" id="app-card-${t.id}">
                <div class="app-card__header">
                    <div>
                        <h3 class="app-card__title">${this.escapeHtml(t.client_name)}</h3>
                        ${t.description?`<p class="app-card__desc">${this.escapeHtml(t.description)}</p>`:""}
                    </div>
                    <span class="app-card__type">${t.client_type==="confidential"?"Confidential":"Public"}</span>
                </div>
                <div class="app-card__client-id">Client ID: ${this.escapeHtml(t.client_id)}</div>
            </div>
        `}showCreateModal(){const t=document.getElementById("appModal");document.getElementById("modalTitle").textContent="Create OAuth Application",document.getElementById("saveOAuthAppBtn").querySelector(".btn__text").textContent="Create Application",document.getElementById("oauthAppForm").reset(),t.setAttribute("aria-hidden","false")}hideCreateModal(){document.getElementById("appModal").setAttribute("aria-hidden","true")}async handleCreateApp(t){t.preventDefault();const e=new FormData(t.target),o={client_name:e.get("client_name"),description:e.get("description")||null,client_type:e.get("client_type"),homepage_url:e.get("homepage_url")||null,privacy_policy_url:e.get("privacy_policy_url")||null,terms_of_service_url:e.get("terms_of_service_url")||null},n=document.getElementById("saveOAuthAppBtn");n.disabled=!0,n.querySelector(".btn__text").textContent="Creating...";try{const s=await fetch("/api/v1/oauth/clients",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken()},body:JSON.stringify(o),credentials:"include"}),i=await s.json();if(!s.ok)throw new Error(i.error||i.message||"Failed to create application");this.showSuccess("OAuth application created successfully!"),this.hideCreateModal(),await this.loadApplications(),i.client_secret?this.showClientSecretModal(i.client_secret,i.client_id,i.id,o.client_name):i.client_id&&i.id&&this.showAppDetails(i.client_id,i.id,o.client_name)}catch(s){console.error("Error creating OAuth application:",s),this.showError(`Failed to create application: ${s.message}`)}finally{n.disabled=!1,n.querySelector(".btn__text").textContent="Create Application"}}async showAppDetails(t,e,o){this.currentClientId=t,this.currentClientName=o,document.getElementById("appDetailsModal").setAttribute("aria-hidden","false"),document.getElementById("detailsModalTitle").textContent=o||"Application Details",await Promise.all([this.loadCredentials(t),this.loadRedirectUris(t),this.loadAuthorizedOrigins(t),this.loadEnabledApis(t)])}hideDetailsModal(){document.getElementById("appDetailsModal").setAttribute("aria-hidden","true"),this.currentClientId=null,this.currentClientName=null,this.currentClientType=null}showClientSecretModal(t,e,o,n){const s=document.getElementById("clientSecretModal");document.getElementById("newClientSecret").textContent=t,s.dataset.clientId=e,s.dataset.clientDbId=o,s.dataset.clientName=n,s.setAttribute("aria-hidden","false")}hideClientSecretModal(){const t=document.getElementById("clientSecretModal");t.setAttribute("aria-hidden","true"),delete t.dataset.clientId,delete t.dataset.clientDbId,delete t.dataset.clientName}handleClientSecretContinue(){const t=document.getElementById("clientSecretModal"),e=t.dataset.clientId,o=t.dataset.clientDbId,n=t.dataset.clientName;this.hideClientSecretModal(),e&&o&&this.showAppDetails(e,o,n)}async loadCredentials(t){try{const e=await fetch(`/api/v1/oauth/clients/${t}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to load credentials");const o=await e.json();document.getElementById("detailClientId").textContent=o.client_id,this.currentClientType=o.client_type||null,o.secrets&&o.secrets.length>0?(this.showElement(document.getElementById("clientSecretSection")),document.getElementById("detailClientSecret").textContent=o.secrets[0].secret_value||"(already hashed - not shown)"):this.hideElement(document.getElementById("clientSecretSection"))}catch(e){console.error("Error loading credentials:",e)}}async loadRedirectUris(t){const e=document.getElementById("redirectUrisList");try{const o=await fetch(`/api/v1/oauth/clients/${t}/redirect-uris`,{credentials:"include"});if(!o.ok)throw new Error("Failed to load redirect URIs");const s=(await o.json()).redirect_uris||[];s.length===0?e.innerHTML='<p class="oauth-text oauth-text--muted">No redirect URIs configured yet.</p>':e.innerHTML=s.map(i=>`
                    <div class="uri-item">
                        <code>${this.escapeHtml(i.redirect_uri)}</code>
                        <button type="button" class="btn-delete" data-action="delete-redirect-uri" data-id="${i.id}">Delete</button>
                    </div>
                `).join("")}catch(o){console.error("Error loading redirect URIs:",o),e.innerHTML='<p class="oauth-text oauth-text--danger">Failed to load redirect URIs.</p>'}}async loadAuthorizedOrigins(t){const e=document.getElementById("authorizedOriginsList");try{const o=await fetch(`/api/v1/oauth/clients/${t}/authorized-domains`,{credentials:"include"});if(!o.ok)throw new Error("Failed to load authorized origins");const s=(await o.json()).authorized_domains||[];s.length===0?e.innerHTML='<p class="oauth-text oauth-text--muted">No authorized origins configured yet.</p>':e.innerHTML=s.map(i=>`
                    <div class="origin-item">
                        <code>${this.escapeHtml(i.domain)}</code>
                        <button type="button" class="btn-delete" data-action="delete-origin" data-id="${i.id}">Delete</button>
                    </div>
                `).join("")}catch(o){console.error("Error loading authorized origins:",o),e.innerHTML='<p class="oauth-text oauth-text--danger">Failed to load authorized origins.</p>'}}async loadEnabledApis(t){const e=document.getElementById("enabledApisList");try{const o=await fetch(`/api/v1/oauth/clients/${t}/api-products`,{credentials:"include"});if(!o.ok)throw new Error("Failed to load API products");const s=(await o.json()).api_products||[],i=await fetch(`/api/v1/oauth/clients/${t}/enabled-apis`,{credentials:"include"});if(!i.ok)throw new Error("Failed to load enabled APIs");const a=await i.json(),d=(a.enabled_apis||[]).map(l=>parseInt(l.id,10)),r=new Set;(a.enabled_apis||[]).forEach(l=>{(l.scopes||[]).forEach(c=>{r.add(parseInt(c.id,10))})}),console.log("Enabled API IDs:",d),console.log("Granted scope IDs:",[...r]),console.log("All APIs:",s.map(l=>({id:l.id,name:l.product_name}))),s.length===0?e.innerHTML='<p class="oauth-text oauth-text--muted">No APIs available yet.</p>':(e.innerHTML=s.map(l=>{const c=parseInt(l.id,10),h=d.includes(c);return console.log(`API ${l.product_name} (id: ${c}): isEnabled=${h}`),this.renderApiCard(l,h,r)}).join(""),this.restoreAccordionState())}catch(o){console.error("Error loading APIs:",o),e.innerHTML='<p class="oauth-text oauth-text--danger">Failed to load APIs.</p>'}}restoreAccordionState(){this.expandedAccordions.forEach(t=>{const e=document.querySelector(`.api-card__accordion[data-api-id="${t}"]`);if(e){const o=e.querySelector(".api-card__accordion-header"),n=e.querySelector(".api-card__accordion-content"),s=o.querySelector(".api-card__accordion-icon");o&&n&&s&&(o.setAttribute("aria-expanded","true"),n.setAttribute("aria-hidden","false"),n.style.maxHeight=n.scrollHeight+"px",s.textContent="‚ñº")}})}renderApiCard(t,e,o){const n=t.scopes||[],s=n.filter(i=>o.has(parseInt(i.id,10))||i.scope_name==="galleries.read").length;return`
            <div class="api-card ${e?"api-card--enabled":""}">
                <div class="api-card__header">
                    <div>
                        <div class="api-card__title-row">
                            <h4 class="api-card__title">${this.escapeHtml(t.product_name||t.name)}</h4>
                            ${e?'<span class="api-card__status api-card__status--enabled">API Enabled</span>':""}
                        </div>
                        <p class="api-card__desc">${this.escapeHtml(t.product_description||t.description||"No description available")}</p>
                    </div>
                    <button
                        type="button"
                        class="btn btn--${e?"danger":"primary"} btn--small"
                        data-action="${e?"disable-api":"enable-api"}"
                        data-id="${t.id}"
                        data-name="${this.escapeHtml(t.product_name||t.name)}"
                    >
                        ${e?"Disable API":"Enable API"}
                    </button>
                </div>
                ${e&&n.length>0?`
                    <div class="api-card__accordion" data-api-id="${t.id}">
                        <button
                            type="button"
                            class="api-card__accordion-header"
                            data-action="toggle-accordion"
                            data-id="${t.id}"
                            aria-expanded="false"
                        >
                            <span class="api-card__accordion-title">
                                <span class="api-card__accordion-icon">‚ñ∂</span>
                                Scope Permissions
                                <span class="api-card__accordion-badge">${s}/${n.length} enabled</span>
                            </span>
                        </button>
                        <div class="api-card__accordion-content" aria-hidden="true">
                            <p class="api-card__scopes-subtitle">Select which operations this OAuth client can perform on galleries.</p>
                            ${n.map(i=>{const a=parseInt(i.id,10),d=o.has(a),r=i.scope_name==="galleries.read",l=this.getScopeLabel(i.scope_name),c=this.getScopeIcon(i.scope_name);return`
                                    <label class="scope-checkbox ${r?"scope-checkbox--required":""} ${d?"scope-checkbox--granted":""}">
                                        <input
                                            type="checkbox"
                                            class="scope-checkbox"
                                            data-scope-id="${i.id}"
                                            data-scope-name="${this.escapeHtml(i.scope_name)}"
                                            ${d||r?"checked":""}
                                            ${r?"disabled":""}
                                        />
                                        <span class="scope-checkbox__label">
                                            <span class="scope-icon">${c}</span>
                                            <span class="scope-info">
                                                <strong>${l}</strong>
                                                <span class="scope-desc">${this.escapeHtml(i.scope_description||"")}</span>
                                                ${r?'<span class="scope-required-badge">Required</span>':""}
                                                ${i.sensitive?'<span class="scope-sensitive-badge">üîí Sensitive</span>':""}
                                            </span>
                                        </span>
                                    </label>
                                `}).join("")}
                            <p class="api-card__scopes-note">
                                <strong>Note:</strong> Write, Edit, and Delete operations only apply to galleries owned by the user who authorized this application.
                            </p>
                        </div>
                    </div>
                `:""}
            </div>
        `}toggleAccordion(t,e){const o=t.getAttribute("aria-expanded")==="true",n=t.nextElementSibling,s=t.querySelector(".api-card__accordion-icon");t.setAttribute("aria-expanded",!o),n.setAttribute("aria-hidden",o),o?(n.style.maxHeight="0",s.textContent="‚ñ∂",this.expandedAccordions.delete(e)):(n.style.maxHeight=n.scrollHeight+"px",s.textContent="‚ñº",this.expandedAccordions.add(e))}getScopeLabel(t){return{"galleries.read":"Read Galleries","galleries.write":"Create Galleries","galleries.edit":"Edit Galleries","galleries.delete":"Delete Galleries"}[t]||t}getScopeIcon(t){return{"galleries.read":"üëÅÔ∏è","galleries.write":"‚úèÔ∏è","galleries.edit":"üìù","galleries.delete":"üóëÔ∏è"}[t]||"üîë"}enableApi(t,e){this.showEnableApiModal(t,e)}showEnableApiModal(t,e){this.pendingApiProductId=t,this.pendingApiName=e,document.getElementById("enableApiNameDisplay").textContent=e,document.getElementById("enableApiModal").setAttribute("aria-hidden","false")}hideEnableApiModal(){document.getElementById("enableApiModal").setAttribute("aria-hidden","true"),this.pendingApiProductId=null,this.pendingApiName=null}async confirmEnableApi(){const t=this.pendingApiProductId,e=this.pendingApiName;if(!t){this.hideEnableApiModal();return}const o=document.getElementById("confirmEnableApiBtn");o.disabled=!0,o.querySelector(".btn__text").textContent="Enabling...";try{const n=await fetch(`/api/v1/oauth/clients/${this.currentClientId}/enable-api`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken()},body:JSON.stringify({api_product_id:t}),credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to enable API")}this.hideEnableApiModal(),this.showSuccess(`${e} enabled successfully!`),await this.loadEnabledApis(this.currentClientId)}catch(n){console.error("Error enabling API:",n),this.showError(`Failed to enable API: ${n.message}`)}finally{o.disabled=!1,o.querySelector(".btn__text").textContent="Enable API"}}disableApi(t,e){this.showDisableApiModal(t,e)}showDisableApiModal(t,e){this.pendingApiProductId=t,this.pendingApiName=e,document.getElementById("disableApiNameDisplay").textContent=e,document.getElementById("disableApiModal").setAttribute("aria-hidden","false")}hideDisableApiModal(){document.getElementById("disableApiModal").setAttribute("aria-hidden","true"),this.pendingApiProductId=null,this.pendingApiName=null}async confirmDisableApi(){const t=this.pendingApiProductId,e=this.pendingApiName;if(!t){this.hideDisableApiModal();return}const o=document.getElementById("confirmDisableApiBtn");o.disabled=!0,o.querySelector(".btn__text").textContent="Disabling...";try{const n=await fetch(`/api/v1/oauth/clients/${this.currentClientId}/enabled-apis/${t}`,{method:"DELETE",headers:{"X-CSRF-Token":this.getCsrfToken()},credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to disable API")}this.hideDisableApiModal(),this.showSuccess(`${e} disabled successfully!`),await this.loadEnabledApis(this.currentClientId)}catch(n){console.error("Error disabling API:",n),this.showError(`Failed to disable API: ${n.message}`)}finally{o.disabled=!1,o.querySelector(".btn__text").textContent="Disable API"}}async toggleScope(t,e,o){try{if(o){const n=await fetch(`/api/v1/oauth/clients/${this.currentClientId}/scopes`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken()},body:JSON.stringify({scope_id:t}),credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to grant scope")}this.showSuccess(`Scope '${e}' granted successfully!`)}else{const n=await fetch(`/api/v1/oauth/clients/${this.currentClientId}/scopes/${t}`,{method:"DELETE",headers:{"X-CSRF-Token":this.getCsrfToken()},credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to revoke scope")}this.showSuccess(`Scope '${e}' revoked successfully!`)}await this.updateScopeUI(t,o)}catch(n){console.error("Error toggling scope:",n),this.showError(`Failed to ${o?"grant":"revoke"} scope: ${n.message}`);const s=document.querySelector(`[data-scope-id="${t}"]`);s&&(s.checked=!o)}}updateScopeUI(t,e){e?this.grantedScopes.includes(t)||this.grantedScopes.push(t):this.grantedScopes=this.grantedScopes.filter(n=>n!==t);const o=document.querySelector(".api-card__accordion");if(o){const n=o.querySelector(".api-card__accordion-header"),s=n==null?void 0:n.querySelector(".api-card__accordion-badge");if(s){const i=o.querySelectorAll("input.scope-checkbox:not(:disabled)"),a=Array.from(i).filter(r=>r.checked).length,d=i.length+1;s.textContent=`${a+1}/${d} enabled`}}}addRedirectUriInput(){const t=document.getElementById("redirectUriInputs"),e=document.createElement("div");e.className="add-uri-form",e.innerHTML=`
            <input type="text" placeholder="https://example.com/callback" class="form__input form__input--full redirect-uri-input" />
            <button type="button" class="btn-remove-uri" title="Remove this input" data-action="remove-input">-</button>
        `,t.appendChild(e)}async saveAllRedirectUris(){const t=document.querySelectorAll(".redirect-uri-input"),e=[];if(t.forEach(i=>{const a=i.value.trim();a&&e.push(a)}),e.length===0){this.showError("Please enter at least one redirect URI");return}let o=0,n=0;for(const i of e)try{(await fetch(`/api/v1/oauth/clients/${this.currentClientId}/redirect-uris`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken()},body:JSON.stringify({redirect_uri:i}),credentials:"include"})).ok?o++:n++}catch(a){console.error("Error adding redirect URI:",a),n++}const s=document.getElementById("redirectUriInputs");s.innerHTML=`
            <div class="add-uri-form">
                <input type="text" placeholder="https://example.com/callback" class="form__input form__input--full redirect-uri-input" />
                <button type="button" class="btn-add-uri" title="Add Another Redirect URI" data-action="add-redirect-uri">+</button>
            </div>
        `,o>0&&this.showSuccess(`${o} redirect URI(s) added successfully!`),n>0&&this.showError(`Failed to add ${n} redirect URI(s)`),await this.loadRedirectUris(this.currentClientId)}async deleteRedirectUri(t){if(confirm("Delete this redirect URI?"))try{const e=await fetch(`/api/v1/oauth/clients/${this.currentClientId}/redirect-uris/${t}`,{method:"DELETE",headers:{"X-CSRF-Token":this.getCsrfToken()},credentials:"include"});if(!e.ok){const o=await e.json();throw new Error(o.message||"Failed to delete redirect URI")}this.showSuccess("Redirect URI deleted successfully!"),await this.loadRedirectUris(this.currentClientId)}catch(e){console.error("Error deleting redirect URI:",e),this.showError(`Failed to delete redirect URI: ${e.message}`)}}addOriginInput(){const t=document.getElementById("authorizedOriginInputs"),e=document.createElement("div");e.className="add-uri-form",e.innerHTML=`
            <input type="text" placeholder="https://example.com" class="form__input form__input--full origin-input" />
            <button type="button" class="btn-remove-uri" title="Remove this input" data-action="remove-input">-</button>
        `,t.appendChild(e)}async saveAllOrigins(){const t=document.querySelectorAll(".origin-input"),e=[];if(t.forEach(i=>{const a=i.value.trim();a&&e.push(a)}),e.length===0){this.showError("Please enter at least one authorized origin");return}let o=0,n=0;for(const i of e)try{(await fetch(`/api/v1/oauth/clients/${this.currentClientId}/authorized-domains`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken()},body:JSON.stringify({domain:i}),credentials:"include"})).ok?o++:n++}catch(a){console.error("Error adding authorized origin:",a),n++}const s=document.getElementById("authorizedOriginInputs");s.innerHTML=`
            <div class="add-uri-form">
                <input type="text" placeholder="https://example.com" class="form__input form__input--full origin-input" />
                <button type="button" class="btn-add-uri" title="Add Another Origin" data-action="add-origin">+</button>
            </div>
        `,o>0&&this.showSuccess(`${o} authorized origin(s) added successfully!`),n>0&&this.showError(`Failed to add ${n} authorized origin(s)`),await this.loadAuthorizedOrigins(this.currentClientId)}async deleteAuthorizedOrigin(t){if(confirm("Delete this authorized origin?"))try{const e=await fetch(`/api/v1/oauth/clients/${this.currentClientId}/authorized-domains/${t}`,{method:"DELETE",headers:{"X-CSRF-Token":this.getCsrfToken()},credentials:"include"});if(!e.ok){const o=await e.json();throw new Error(o.message||"Failed to delete authorized origin")}this.showSuccess("Authorized origin deleted successfully!"),await this.loadAuthorizedOrigins(this.currentClientId)}catch(e){console.error("Error deleting authorized origin:",e),this.showError(`Failed to delete authorized origin: ${e.message}`)}}showDeleteConfirmModal(){if(!this.currentClientId||!this.currentClientName){this.showError("No application selected");return}document.getElementById("deleteAppNameDisplay").textContent=this.currentClientName,document.getElementById("deleteConfirmInput").value="",document.getElementById("deleteConfirmError").textContent="",document.getElementById("deleteConfirmModal").setAttribute("aria-hidden","false")}hideDeleteConfirmModal(){document.getElementById("deleteConfirmModal").setAttribute("aria-hidden","true"),document.getElementById("deleteConfirmInput").value="",document.getElementById("deleteConfirmError").textContent=""}async handleDeleteConfirm(t){t.preventDefault();const e=document.getElementById("deleteConfirmInput"),o=document.getElementById("deleteConfirmError"),n=document.getElementById("confirmDeleteBtn"),s=e.value.trim();if(o.textContent="",s!==this.currentClientName){o.textContent="Application name does not match. Please type the exact name.",e.focus();return}n.disabled=!0,n.querySelector(".btn__text").textContent="Deleting...";try{const i=await fetch(`/api/v1/oauth/clients/${this.currentClientId}`,{method:"DELETE",headers:{"X-CSRF-Token":this.getCsrfToken()},credentials:"include"});if(!i.ok){const a=await i.json();throw new Error(a.message||"Failed to delete application")}this.showSuccess(`Application "${this.currentClientName}" deleted successfully!`),this.hideDeleteConfirmModal(),this.hideDetailsModal(),await this.loadApplications()}catch(i){console.error("Error deleting application:",i),o.textContent=i.message,this.showError(`Failed to delete application: ${i.message}`)}finally{n.disabled=!1,n.querySelector(".btn__text").textContent="Delete Application"}}async showSsoUrlModal(){if(!this.currentClientId){this.showError("No application selected");return}await this.generatePkcePair(),await this.loadRedirectUrisForModal(this.currentClientId),await this.loadGrantedScopesForModal(this.currentClientId),document.getElementById("ssoUrlModal").setAttribute("aria-hidden","false"),this.updatePkceRequirementNote(),document.getElementById("ssoUrlDisplay").textContent="Select a redirect URI to generate the URL",document.getElementById("copySsoUrlBtn").disabled=!0}hideSsoUrlModal(){document.getElementById("ssoUrlModal").setAttribute("aria-hidden","true");const e=document.getElementById("ssoRedirectUriSelect");e.innerHTML='<option value="">-- Select a redirect URI --</option>',this.pkceVerifier=null,this.pkceChallenge=null,this.updatePkceDisplay()}async loadRedirectUrisForModal(t){const e=document.getElementById("ssoRedirectUriSelect");try{const o=await fetch(`/api/v1/oauth/clients/${t}/redirect-uris`,{credentials:"include"});if(!o.ok)throw new Error("Failed to load redirect URIs");const n=await o.json();this.redirectUris=n.redirect_uris||[],e.innerHTML='<option value="">-- Select a redirect URI --</option>',this.redirectUris.forEach(s=>{const i=document.createElement("option");i.value=s.redirect_uri,i.textContent=s.redirect_uri,e.appendChild(i)}),this.redirectUris.length===0&&(e.innerHTML='<option value="">No redirect URIs configured</option>')}catch(o){console.error("Error loading redirect URIs:",o),e.innerHTML='<option value="">Failed to load redirect URIs</option>'}}async loadGrantedScopesForModal(t){try{const e=await fetch(`/api/v1/oauth/clients/${t}/enabled-apis`,{credentials:"include"});if(!e.ok)throw new Error("Failed to load granted scopes");const n=(await e.json()).enabled_apis||[];this.grantedScopes=[],n.forEach(s=>{(s.scopes||[]).forEach(i=>{this.grantedScopes.push(i.scope_name)})})}catch(e){console.error("Error loading granted scopes:",e),this.grantedScopes=[]}}async updateSsoUrl(){const e=document.getElementById("ssoRedirectUriSelect").value,o=document.getElementById("ssoUrlDisplay"),n=document.getElementById("copySsoUrlBtn");if(!e){o.textContent="Select a redirect URI to generate the URL",n.disabled=!0;return}(!this.pkceVerifier||!this.pkceChallenge)&&await this.generatePkcePair();const s=window.location.origin,i=new URL("/oauth/authorize",s);i.searchParams.set("client_id",this.currentClientId),i.searchParams.set("redirect_uri",e),i.searchParams.set("response_type","code"),this.grantedScopes.length>0&&i.searchParams.set("scope",this.grantedScopes.join(" ")),i.searchParams.set("state","YOUR_STATE_TOKEN_HERE"),this.pkceChallenge&&(i.searchParams.set("code_challenge",this.pkceChallenge),i.searchParams.set("code_challenge_method","S256")),o.textContent=i.toString(),n.disabled=!1}updatePkceRequirementNote(){const t=document.getElementById("pkceRequirementNote");t&&(t.textContent="PKCE is required for all clients. Use the verifier below when exchanging the code.")}updatePkceDisplay(){const t=document.getElementById("pkceVerifierDisplay"),e=document.getElementById("pkceChallengeDisplay"),o=document.getElementById("copyPkceVerifierBtn"),n=document.getElementById("copyPkceChallengeBtn");t&&(t.textContent=this.pkceVerifier||"Generate a PKCE verifier to continue"),e&&(e.textContent=this.pkceChallenge||"Generate a PKCE challenge to continue"),o&&(o.disabled=!this.pkceVerifier),n&&(n.disabled=!this.pkceChallenge)}base64UrlEncode(t){let e="";return t.forEach(o=>{e+=String.fromCharCode(o)}),btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}async generatePkcePair(){const t=new Uint8Array(32);crypto.getRandomValues(t),this.pkceVerifier=this.base64UrlEncode(t);const e=new TextEncoder().encode(this.pkceVerifier),o=await crypto.subtle.digest("SHA-256",e);this.pkceChallenge=this.base64UrlEncode(new Uint8Array(o)),this.updatePkceDisplay(),await this.updateSsoUrl()}async copyToClipboard(t){const e=document.getElementById(t);if(!e)return;const o=e.textContent;try{await navigator.clipboard.writeText(o),this.showSuccess("Copied to clipboard!")}catch(n){console.error("Failed to copy:",n);const s=document.createElement("textarea");s.value=o,s.style.position="fixed",s.style.left="-9999px",document.body.appendChild(s),s.select();try{document.execCommand("copy"),this.showSuccess("Copied to clipboard!")}catch{this.showError("Failed to copy to clipboard")}document.body.removeChild(s)}}async loadAuthorizedApps(){const t=document.getElementById("authorizedLoadingState"),e=document.getElementById("authorizedEmptyState"),o=document.getElementById("authorizedErrorState"),n=document.getElementById("authorizedAppsListContainer"),s=document.getElementById("authorizedAppsBadge");this.showElement(t),this.hideElement(e),this.hideElement(o),this.hideElement(n);try{const i=await fetch("/oauth/authorized-apps",{credentials:"include",headers:{"X-CSRF-Token":this.getCsrfToken()}});if(i.status===401||i.status===403){this.hideElement(t),this.showElement(e);return}if(!i.ok)throw new Error("Failed to load authorized apps");const a=await i.json();this.authorizedApps=a.apps||[],this.authorizedAppsLoaded=!0,s&&(this.authorizedApps.length>0?(s.textContent=this.authorizedApps.length,s.classList.remove("hidden")):s.classList.add("hidden")),this.hideElement(t),this.authorizedApps.length===0?this.showElement(e):n&&(n.innerHTML=this.authorizedApps.map(d=>this.renderAuthorizedAppCard(d)).join(""),this.showElement(n),this.authorizedApps.forEach(d=>{var r;(r=document.getElementById(`revoke-btn-${d.consent_id}`))==null||r.addEventListener("click",l=>{l.stopPropagation(),this.revokeAuthorization(d.client_db_id,d.client_name)})}))}catch(i){if(console.error("Error loading authorized apps:",i),this.hideElement(t),o){this.showElement(o);const a=o.querySelector(".error-state__message");a&&(a.textContent=i.message||"An unexpected error occurred")}}}renderAuthorizedAppCard(t){const e=new Date(t.authorized_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),o=new Date(t.last_used_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),n=(t.granted_scopes||[]).map(s=>({"galleries.read":"Read Galleries","galleries.write":"Create Galleries","galleries.edit":"Edit Galleries","galleries.delete":"Delete Galleries"})[s]||s);return`
            <div class="authorized-app-card" id="authorized-app-${t.consent_id}">
                <div class="authorized-app-card__header">
                    <div class="authorized-app-card__info">
                        ${t.logo_url?`
                            <img src="${this.escapeHtml(t.logo_url)}" alt="${this.escapeHtml(t.client_name)} logo" class="authorized-app-card__logo">
                        `:`
                            <div class="authorized-app-card__logo authorized-app-card__logo--placeholder">
                                ${this.escapeHtml(t.client_name.charAt(0).toUpperCase())}
                            </div>
                        `}
                        <div>
                            <h3 class="authorized-app-card__title">${this.escapeHtml(t.client_name)}</h3>
                            ${t.client_description?`<p class="authorized-app-card__desc">${this.escapeHtml(t.client_description)}</p>`:""}
                        </div>
                    </div>
                    <button
                        type="button"
                        class="btn btn--danger btn--small"
                        id="revoke-btn-${t.consent_id}"
                        title="Revoke access"
                    >
                        Revoke Access
                    </button>
                </div>

                <div class="authorized-app-card__meta">
                    <div class="authorized-app-card__meta-item">
                        <span class="authorized-app-card__meta-label">Authorized:</span>
                        <span class="authorized-app-card__meta-value">${e}</span>
                    </div>
                    <div class="authorized-app-card__meta-item">
                        <span class="authorized-app-card__meta-label">Last used:</span>
                        <span class="authorized-app-card__meta-value">${o}</span>
                    </div>
                </div>

                ${n.length>0?`
                    <div class="authorized-app-card__scopes">
                        <span class="authorized-app-card__scopes-label">Permissions:</span>
                        <div class="authorized-app-card__scopes-list">
                            ${n.map(s=>`<span class="scope-badge">${this.escapeHtml(s)}</span>`).join("")}
                        </div>
                    </div>
                `:""}

                ${t.homepage_url||t.privacy_policy_url?`
                    <div class="authorized-app-card__links">
                        ${t.homepage_url?`<a href="${this.escapeHtml(t.homepage_url)}" target="_blank" rel="noopener noreferrer" class="authorized-app-card__link">üåê Website</a>`:""}
                        ${t.privacy_policy_url?`<a href="${this.escapeHtml(t.privacy_policy_url)}" target="_blank" rel="noopener noreferrer" class="authorized-app-card__link">üîí Privacy Policy</a>`:""}
                    </div>
                `:""}
            </div>
        `}async revokeAuthorization(t,e){if(confirm(`Are you sure you want to revoke access for "${e}"?

This app will no longer be able to access your data.`))try{const o=await fetch("/oauth/authorized-apps/revoke",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCsrfToken()},body:JSON.stringify({client_db_id:t}),credentials:"include"});if(!o.ok){const n=await o.json();throw new Error(n.message||"Failed to revoke authorization")}this.showSuccess(`Access revoked for "${e}"`),this.authorizedAppsLoaded=!1,await this.loadAuthorizedApps()}catch(o){console.error("Error revoking authorization:",o),this.showError(`Failed to revoke access: ${o.message}`)}}escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{new N().init()})})();

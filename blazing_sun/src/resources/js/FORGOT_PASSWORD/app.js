(function(){"use strict";var h=document.createElement("style");h.textContent=`.forgot-password-page{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:var(--gradient-primary);min-height:100vh;color:var(--color-text-primary);transition:background .25s ease}.container{max-width:1200px;margin:0 auto;padding:2rem;display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 80px)}.card{background:var(--color-surface);border-radius:6px;padding:2rem;box-shadow:var(--shadow-lg);max-width:400px;width:100%;transition:background-color .25s ease,box-shadow .25s ease,opacity .25s ease,transform .25s ease}.card h1{text-align:center;color:var(--color-text-primary);margin-bottom:1.5rem;font-size:1.5rem;font-weight:600;transition:color .25s ease}.card.hidden{display:none}.card--entering{animation:cardFadeIn .25s ease forwards}.card--exiting{animation:cardFadeOut .15s ease forwards}@keyframes cardFadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes cardFadeOut{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-10px)}}.step-indicator{display:flex;justify-content:center;gap:.5rem;margin-bottom:1.5rem}.step-indicator__dot{width:10px;height:10px;border-radius:50%;background:var(--color-border);transition:background .25s ease,transform .25s ease}.step-indicator__dot--active{background:var(--color-primary);transform:scale(1.2)}.step-indicator__dot--completed{background:var(--color-success)}.form-group{margin-bottom:1rem}.form-group label{display:block;margin-bottom:.5rem;font-weight:500;color:var(--gray-700);transition:color .25s ease}.form-group input{width:100%;padding:.75rem 1rem;border:2px solid var(--input-border);border-radius:4px;font-size:1rem;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:var(--input-bg);color:var(--color-text-primary);transition:border-color .25s ease,background-color .25s ease,color .25s ease}.form-group input:focus{outline:none;border-color:var(--color-border-focus);box-shadow:var(--focus-ring)}.form-group input::placeholder{color:var(--input-placeholder)}.form-group input.input--error{border-color:var(--color-border-error)}.form-group input.input--success{border-color:var(--color-border-success)}.form-group--code input{text-align:center;font-size:1.25rem;letter-spacing:.5em;font-weight:600}.password-strength{margin-top:.5rem;height:4px;border-radius:4px;background:var(--color-border);overflow:hidden}.password-strength__bar{height:100%;transition:width .25s ease,background .25s ease;border-radius:4px}.password-strength__bar--weak{width:25%;background:var(--color-error)}.password-strength__bar--fair{width:50%;background:var(--color-warning)}.password-strength__bar--good{width:75%;background:var(--color-info)}.password-strength__bar--strong{width:100%;background:var(--color-success)}.password-strength-text{font-size:.875rem;margin-top:.25rem;color:var(--color-text-muted)}.btn{width:100%;padding:.75rem 1rem;background:var(--gradient-primary);color:var(--color-text-on-primary);border:none;border-radius:4px;font-size:1rem;font-weight:600;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease;margin-top:.5rem}.btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:var(--shadow-primary-glow)}.btn:active:not(:disabled){transform:translateY(0)}.btn:focus{outline:none;box-shadow:var(--focus-ring)}.btn:disabled{opacity:var(--btn-disabled-opacity);cursor:not-allowed;transform:none}.btn--loading{position:relative;color:transparent}.btn--loading:after{content:"";position:absolute;width:20px;height:20px;top:50%;left:50%;margin-left:-10px;margin-top:-10px;border:2px solid transparent;border-top-color:var(--color-text-on-primary);border-radius:50%;animation:spin .8s linear infinite}.btn--secondary{background:transparent;color:var(--color-primary);border:2px solid var(--color-primary)}.btn--secondary:hover:not(:disabled){background:var(--color-primary);color:var(--color-text-on-primary)}@keyframes spin{to{transform:rotate(360deg)}}.link{color:var(--color-primary);text-decoration:none;font-weight:500;transition:color .15s ease}.link:hover{text-decoration:underline;color:var(--color-primary-dark)}.link:focus{outline:none;box-shadow:var(--focus-ring);border-radius:4px}.text-center{text-align:center}.text-muted{color:var(--color-text-muted)}.mt-1{margin-top:1rem}.info-text{color:var(--color-text-secondary);text-align:center;margin-bottom:1.5rem;line-height:1.6}.resend-link{display:block;text-align:center;margin-top:1rem;font-size:.875rem;color:var(--color-text-muted)}.resend-link button{background:none;border:none;color:var(--color-primary);font-weight:500;cursor:pointer;font-size:inherit;font-family:inherit;padding:0;transition:color .15s ease}.resend-link button:hover{text-decoration:underline;color:var(--color-primary-dark)}.resend-link button:disabled{color:var(--color-text-muted);cursor:not-allowed}.success-message{text-align:center;padding:1.5rem}.success-message__icon{width:64px;height:64px;margin:0 auto 1rem;background:var(--gradient-success);border-radius:50%;display:flex;align-items:center;justify-content:center;animation:scaleIn .25s ease forwards}.success-message__icon svg{width:32px;height:32px;color:#fff}.success-message__title{font-size:1.25rem;font-weight:600;margin-bottom:.5rem;color:var(--color-text-primary)}.success-message__text{color:var(--color-text-secondary);margin-bottom:1.5rem}@keyframes scaleIn{0%{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}@media(max-width:768px){.container{padding:1rem}.card{padding:1.5rem}.card h1{font-size:1.25rem}}@media(max-width:480px){.card{padding:1rem;margin:.5rem}.card h1{font-size:1.125rem}.btn{padding:1rem}.form-group--code input{font-size:1.125rem;letter-spacing:.3em}}*,*:before,*:after{margin:0;padding:0;box-sizing:border-box}html{font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color-scheme:light dark}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.5;color:var(--color-text-primary);background-color:var(--color-bg-primary);transition:background-color .25s ease,color .25s ease}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}:focus-visible{outline:2px solid var(--color-primary);outline-offset:2px}
/*$vite$:1*/`,document.head.appendChild(h);function v(){const a=document.querySelector('meta[name="csrf-token"]');return a?a.getAttribute("content"):(console.warn('CSRF token not found. Ensure <meta name="csrf-token"> exists in page head.'),null)}function w(a={}){const t=v(),e={"Content-Type":"application/json",...a};return t&&(e["X-CSRF-TOKEN"]=t),e}class g{constructor(t={}){this.options={showIcons:!0,validateOnInput:!0,...t},this.validationRules={email:[{test:e=>e.length>0,message:"Email is required",key:"required"},{test:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:"Must be a valid email format",key:"format"}],password:[{test:e=>e.length>0,message:"Password is required",key:"required"},{test:e=>e.length>=8,message:"Minimum 8 characters",key:"minLength"},{test:e=>/[A-Z]/.test(e),message:"At least one uppercase letter",key:"uppercase"},{test:e=>/[a-z]/.test(e),message:"At least one lowercase letter",key:"lowercase"},{test:e=>/[0-9]/.test(e),message:"At least one number",key:"number"},{test:e=>/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/`~]/.test(e),message:"At least one special character",key:"special"}],first_name:[{test:e=>e.length>0,message:"First name is required",key:"required"},{test:e=>e.length>=2,message:"Minimum 2 characters",key:"minLength"},{test:e=>/^[a-zA-Z\s'-]+$/.test(e)||e.length===0,message:"Letters only (no special characters)",key:"letters"}],last_name:[{test:e=>e.length>0,message:"Last name is required",key:"required"},{test:e=>e.length>=2,message:"Minimum 2 characters",key:"minLength"},{test:e=>/^[a-zA-Z\s'-]+$/.test(e)||e.length===0,message:"Letters only (no special characters)",key:"letters"}],current_password:[{test:e=>e.length>0,message:"Current password is required",key:"required"}],new_password:[{test:e=>e.length>0,message:"New password is required",key:"required"},{test:e=>e.length>=8,message:"Minimum 8 characters",key:"minLength"},{test:e=>/[A-Z]/.test(e),message:"At least one uppercase letter",key:"uppercase"},{test:e=>/[a-z]/.test(e),message:"At least one lowercase letter",key:"lowercase"},{test:e=>/[0-9]/.test(e),message:"At least one number",key:"number"},{test:e=>/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/`~]/.test(e),message:"At least one special character",key:"special"}]},this.boundInputs=new Map,this.passwordConfirmPairs=new Map}bindPasswordConfirm(t,e,s){if(!t||!e)return;const r={input:t,type:"password_confirm",feedbackContainer:s,isValid:!1,touched:!1,passwordInput:e};if(this.boundInputs.set(t,r),this.passwordConfirmPairs.set(t,e),s){s.innerHTML="",s.className="validation-feedback";const o=document.createElement("div");o.className="validation-item",o.dataset.rule="match",o.innerHTML=`
                <span class="validation-icon"></span>
                <span class="validation-text">Passwords must match</span>
            `,s.appendChild(o)}this.options.validateOnInput&&(t.addEventListener("input",()=>this.validatePasswordConfirm(r)),t.addEventListener("blur",()=>{r.touched=!0,this.validatePasswordConfirm(r)}),e.addEventListener("input",()=>{t.value.length>0&&this.validatePasswordConfirm(r)}))}validatePasswordConfirm(t){const{input:e,feedbackContainer:s,touched:r,passwordInput:o}=t,i=e.value,n=o.value,l=i.length>0&&i===n;if(t.isValid=l,s){const d=s.querySelector('[data-rule="match"]');d&&(d.classList.remove("valid","invalid"),(i.length>0||r)&&d.classList.add(l?"valid":"invalid"))}return e.classList.remove("input--valid","input--invalid"),(i.length>0||r)&&e.classList.add(l?"input--valid":"input--invalid"),l}bindInput(t,e,s){if(!t||!this.validationRules[e])return;const r={input:t,type:e,feedbackContainer:s,isValid:!1,touched:!1};this.boundInputs.set(t,r),this.createFeedbackElements(r),this.options.validateOnInput&&(t.addEventListener("input",()=>this.validateInput(r)),t.addEventListener("blur",()=>{r.touched=!0,this.validateInput(r)})),this.validateInput(r,!1)}createFeedbackElements(t){const{feedbackContainer:e,type:s}=t;if(!e)return;e.innerHTML="",e.className="validation-feedback",this.validationRules[s].forEach(o=>{const i=document.createElement("div");i.className="validation-item",i.dataset.rule=o.key,i.innerHTML=`
                <span class="validation-icon"></span>
                <span class="validation-text">${o.message}</span>
            `,e.appendChild(i)})}validateInput(t,e=!0){const{input:s,type:r,feedbackContainer:o,touched:i}=t,n=s.value,l=this.validationRules[r];let d=!0;return l.forEach(c=>{const u=c.test(n);if(u||(d=!1),o&&(e||i)){const m=o.querySelector(`[data-rule="${c.key}"]`);m&&(m.classList.remove("valid","invalid"),(n.length>0||i)&&m.classList.add(u?"valid":"invalid"))}}),t.isValid=d,s.classList.remove("input--valid","input--invalid"),(n.length>0||i)&&e&&s.classList.add(d?"input--valid":"input--invalid"),d}validateAll(){let t=!0;return this.boundInputs.forEach(e=>{e.touched=!0,e.type==="password_confirm"?this.validatePasswordConfirm(e)||(t=!1):this.validateInput(e,!0)||(t=!1)}),t}isValid(){let t=!0;return this.boundInputs.forEach(e=>{e.isValid||(t=!1)}),t}reset(){this.boundInputs.forEach(t=>{t.touched=!1,t.isValid=!1,t.input.classList.remove("input--valid","input--invalid"),t.feedbackContainer&&t.feedbackContainer.querySelectorAll(".validation-item").forEach(s=>s.classList.remove("valid","invalid"))})}getErrors(){const t={};return this.boundInputs.forEach((e,s)=>{const r=s.value,o=this.validationRules[e.type],i=[];o.forEach(n=>{n.test(r)||i.push(n.message)}),i.length>0&&(t[s.name||s.id||e.type]=i)}),t}}class p{constructor(t,e){this.input=t,this.toggleBtn=e,this.isVisible=!1,this.input&&this.toggleBtn&&this.init()}init(){this.toggleBtn.addEventListener("click",t=>{t.preventDefault(),this.toggle()}),this.updateIcon()}toggle(){this.isVisible=!this.isVisible,this.input.type=this.isVisible?"text":"password",this.updateIcon()}updateIcon(){const t='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>',e='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>';this.toggleBtn.innerHTML=this.isVisible?e:t,this.toggleBtn.setAttribute("aria-label",this.isVisible?"Hide password":"Show password")}}class y{constructor(t){this.baseUrl=t.baseUrl||"",this.requestCard=t.requestCard,this.verifyCard=t.verifyCard,this.resetCard=t.resetCard,this.requestForm=t.requestForm,this.verifyForm=t.verifyForm,this.resetForm=t.resetForm,this.requestBtn=t.requestBtn,this.verifyBtn=t.verifyBtn,this.resetBtn=t.resetBtn,this.showToast=t.showToast||this.defaultToast.bind(this),this.currentStep=1,this.isSubmitting=!1,this.userEmail="",this.verifiedCode="",this.emailValidator=null,this.passwordValidator=null,this.newPasswordToggle=null,this.confirmPasswordToggle=null,this.init()}init(){if(!this.requestForm||!this.verifyForm||!this.resetForm){console.error("ForgotPassword: Required form elements not found");return}this.initValidators(),this.initPasswordToggles(),this.requestForm.addEventListener("submit",e=>this.handleRequestCode(e)),this.verifyForm.addEventListener("submit",e=>this.handleVerifyCode(e)),this.resetForm.addEventListener("submit",e=>this.handleResetPassword(e));const t=document.getElementById("reset_code");t&&t.addEventListener("input",e=>this.formatCodeInput(e))}initValidators(){const t=document.getElementById("email"),e=document.getElementById("emailFeedback"),s=document.getElementById("new_password"),r=document.getElementById("confirm_password"),o=document.getElementById("newPasswordFeedback"),i=document.getElementById("confirmPasswordFeedback");this.emailValidator=new g({validateOnInput:!0}),t&&e&&this.emailValidator.bindInput(t,"email",e),this.passwordValidator=new g({validateOnInput:!0}),s&&o&&this.passwordValidator.bindInput(s,"password",o),r&&s&&i&&this.passwordValidator.bindPasswordConfirm(r,s,i)}initPasswordToggles(){const t=document.getElementById("new_password"),e=document.getElementById("confirm_password"),s=document.getElementById("newPasswordToggle"),r=document.getElementById("confirmPasswordToggle");t&&s&&(this.newPasswordToggle=new p(t,s)),e&&r&&(this.confirmPasswordToggle=new p(e,r))}async handleRequestCode(t){if(t.preventDefault(),this.isSubmitting||this.emailValidator&&!this.emailValidator.validateAll())return;const e=this.requestForm.querySelector("#email")?.value.trim()||"";this.setButtonLoading(this.requestBtn,!0,"Sending..."),this.isSubmitting=!0;const s=await this.apiRequest("/api/v1/account/forgot-password","POST",{email:e});if(this.isSubmitting=!1,s.ok){this.userEmail=e,this.showToast("Reset code sent! Please check your email.","success");const r=document.getElementById("verify_email"),o=document.getElementById("reset_email");r&&(r.value=e),o&&(o.value=e),this.goToStep(2)}else this.setButtonLoading(this.requestBtn,!1,"Send Reset Code"),this.handleApiError(s)}async handleVerifyCode(t){if(t.preventDefault(),this.isSubmitting)return;const e=this.verifyForm.querySelector("#reset_code")?.value.trim()||"",s=this.userEmail||document.getElementById("verify_email")?.value||"";if(!e||e.length<20){this.showToast("Please enter the 20 character code","error");return}this.setButtonLoading(this.verifyBtn,!0,"Verifying..."),this.isSubmitting=!0;const r=await this.apiRequest("/api/v1/account/verify-hash","POST",{email:s,code:e});this.isSubmitting=!1,r.ok?(this.showToast("Code verified! Please enter your new password.","success"),this.verifiedCode=e,this.goToStep(3)):(this.setButtonLoading(this.verifyBtn,!1,"Verify Code"),this.handleApiError(r))}async handleResetPassword(t){if(t.preventDefault(),this.isSubmitting)return;const e=this.verifiedCode;if(!e){this.showToast("Verification code is missing. Please start over.","error"),this.goToStep(1);return}if(this.passwordValidator&&!this.passwordValidator.validateAll())return;const s=this.resetForm.querySelector("#new_password")?.value||"",r=this.resetForm.querySelector("#confirm_password")?.value||"";this.setButtonLoading(this.resetBtn,!0,"Resetting..."),this.isSubmitting=!0;const o=await this.apiRequest("/api/v1/account/reset-password","POST",{code:e,password:s,confirm_password:r});this.isSubmitting=!1,o.ok?(this.showToast("Password reset successful! Redirecting to sign in...","success"),this.setButtonLoading(this.resetBtn,!1,"Redirecting..."),setTimeout(()=>{window.location.href="/sign_in"},2e3)):(this.setButtonLoading(this.resetBtn,!1,"Reset Password"),this.handleApiError(o))}goToStep(t){this.currentStep=t,this.requestCard?.classList.add("hidden"),this.verifyCard?.classList.add("hidden"),this.resetCard?.classList.add("hidden");const e=this.getCardForStep(t);if(e){e.classList.remove("hidden");const s=e.querySelector('input:not([type="hidden"])');s&&setTimeout(()=>s.focus(),100)}this.setButtonLoading(this.requestBtn,!1,"Send Reset Code"),this.setButtonLoading(this.verifyBtn,!1,"Verify Code"),this.setButtonLoading(this.resetBtn,!1,"Reset Password")}getCardForStep(t){switch(t){case 1:return this.requestCard;case 2:return this.verifyCard;case 3:return this.resetCard;default:return null}}formatCodeInput(t){const e=t.target;e.value=e.value.replace(/[^a-zA-Z0-9]/g,"").slice(0,20)}setButtonLoading(t,e,s){t&&(t.disabled=e,t.textContent=s,e?t.classList.add("btn--loading"):t.classList.remove("btn--loading"))}handleApiError(t){const e=t.data?.message||"An error occurred. Please try again.";if(this.showToast(e,"error"),t.data?.errors)for(const[s,r]of Object.entries(t.data.errors))Array.isArray(r)&&r.forEach(o=>this.showToast(`${s}: ${o}`,"error"))}async apiRequest(t,e="GET",s=null){const r={method:e,headers:w()};s&&(r.body=JSON.stringify(s));try{const o=await fetch(`${this.baseUrl}${t}`,r),i=await o.json();return{ok:o.ok,data:i}}catch(o){return console.error("API request failed:",o),{ok:!1,data:{message:"Network error. Please try again."}}}}defaultToast(t,e="info"){console.log(`[${e.toUpperCase()}] ${t}`),alert(t)}}function f(){const a=document.getElementById("requestCard"),t=document.getElementById("verifyCard"),e=document.getElementById("resetCard"),s=document.getElementById("requestForm"),r=document.getElementById("verifyForm"),o=document.getElementById("resetForm"),i=document.getElementById("requestBtn"),n=document.getElementById("verifyBtn"),l=document.getElementById("resetBtn");if(!a||!t||!e){console.error("ForgotPassword page: Required card elements not found");return}if(!s||!r||!o){console.error("ForgotPassword page: Required form elements not found");return}const d=window.BASE_URL||"",c=b(),u=new y({baseUrl:d,requestCard:a,verifyCard:t,resetCard:e,requestForm:s,verifyForm:r,resetForm:o,requestBtn:i,verifyBtn:n,resetBtn:l,showToast:c});typeof window<"u"&&(window.forgotPasswordController=u)}function b(){const a={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)"};return function(e,s="success"){typeof Toastify<"u"?Toastify({text:e,duration:4e3,gravity:"top",position:"right",style:{background:a[s]||a.info}}).showToast():console.log(`[${s.toUpperCase()}] ${e}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f()})();

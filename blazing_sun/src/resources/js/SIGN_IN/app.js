(function(){"use strict";function m(){const r=document.querySelector('meta[name="csrf-token"]');return r?r.getAttribute("content"):(console.warn('CSRF token not found. Ensure <meta name="csrf-token"> exists in page head.'),null)}function f(r={}){const t=m(),e={"Content-Type":"application/json",...r};return t&&(e["X-CSRF-TOKEN"]=t),e}class p{constructor(t={}){this.options={showIcons:!0,validateOnInput:!0,...t},this.validationRules={email:[{test:e=>e.length>0,message:"Email is required",key:"required"},{test:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:"Must be a valid email format",key:"format"}],password:[{test:e=>e.length>0,message:"Password is required",key:"required"},{test:e=>e.length>=8,message:"Minimum 8 characters",key:"minLength"},{test:e=>/[A-Z]/.test(e),message:"At least one uppercase letter",key:"uppercase"},{test:e=>/[a-z]/.test(e),message:"At least one lowercase letter",key:"lowercase"},{test:e=>/[0-9]/.test(e),message:"At least one number",key:"number"},{test:e=>/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/`~]/.test(e),message:"At least one special character",key:"special"}],first_name:[{test:e=>e.length>0,message:"First name is required",key:"required"},{test:e=>e.length>=2,message:"Minimum 2 characters",key:"minLength"},{test:e=>/^[a-zA-Z\s'-]+$/.test(e)||e.length===0,message:"Letters only (no special characters)",key:"letters"}],last_name:[{test:e=>e.length>0,message:"Last name is required",key:"required"},{test:e=>e.length>=2,message:"Minimum 2 characters",key:"minLength"},{test:e=>/^[a-zA-Z\s'-]+$/.test(e)||e.length===0,message:"Letters only (no special characters)",key:"letters"}],current_password:[{test:e=>e.length>0,message:"Current password is required",key:"required"}],new_password:[{test:e=>e.length>0,message:"New password is required",key:"required"},{test:e=>e.length>=8,message:"Minimum 8 characters",key:"minLength"},{test:e=>/[A-Z]/.test(e),message:"At least one uppercase letter",key:"uppercase"},{test:e=>/[a-z]/.test(e),message:"At least one lowercase letter",key:"lowercase"},{test:e=>/[0-9]/.test(e),message:"At least one number",key:"number"},{test:e=>/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/`~]/.test(e),message:"At least one special character",key:"special"}]},this.boundInputs=new Map,this.passwordConfirmPairs=new Map}bindPasswordConfirm(t,e,s){if(!t||!e)return;const i={input:t,type:"password_confirm",feedbackContainer:s,isValid:!1,touched:!1,passwordInput:e};if(this.boundInputs.set(t,i),this.passwordConfirmPairs.set(t,e),s){s.innerHTML="",s.className="validation-feedback";const n=document.createElement("div");n.className="validation-item",n.dataset.rule="match",n.innerHTML=`
                <span class="validation-icon"></span>
                <span class="validation-text">Passwords must match</span>
            `,s.appendChild(n)}this.options.validateOnInput&&(t.addEventListener("input",()=>this.validatePasswordConfirm(i)),t.addEventListener("blur",()=>{i.touched=!0,this.validatePasswordConfirm(i)}),e.addEventListener("input",()=>{t.value.length>0&&this.validatePasswordConfirm(i)}))}validatePasswordConfirm(t){const{input:e,feedbackContainer:s,touched:i,passwordInput:n}=t,a=e.value,o=n.value,d=a.length>0&&a===o;if(t.isValid=d,s){const l=s.querySelector('[data-rule="match"]');l&&(l.classList.remove("valid","invalid"),(a.length>0||i)&&l.classList.add(d?"valid":"invalid"))}return e.classList.remove("input--valid","input--invalid"),(a.length>0||i)&&e.classList.add(d?"input--valid":"input--invalid"),d}bindInput(t,e,s){if(!t||!this.validationRules[e])return;const i={input:t,type:e,feedbackContainer:s,isValid:!1,touched:!1};this.boundInputs.set(t,i),this.createFeedbackElements(i),this.options.validateOnInput&&(t.addEventListener("input",()=>this.validateInput(i)),t.addEventListener("blur",()=>{i.touched=!0,this.validateInput(i)})),this.validateInput(i,!1)}createFeedbackElements(t){const{feedbackContainer:e,type:s}=t;if(!e)return;e.innerHTML="",e.className="validation-feedback",this.validationRules[s].forEach(n=>{const a=document.createElement("div");a.className="validation-item",a.dataset.rule=n.key,a.innerHTML=`
                <span class="validation-icon"></span>
                <span class="validation-text">${n.message}</span>
            `,e.appendChild(a)})}validateInput(t,e=!0){const{input:s,type:i,feedbackContainer:n,touched:a}=t,o=s.value,d=this.validationRules[i];let l=!0;return d.forEach(h=>{const g=h.test(o);if(g||(l=!1),n&&(e||a)){const c=n.querySelector(`[data-rule="${h.key}"]`);c&&(c.classList.remove("valid","invalid"),(o.length>0||a)&&c.classList.add(g?"valid":"invalid"))}}),t.isValid=l,s.classList.remove("input--valid","input--invalid"),(o.length>0||a)&&e&&s.classList.add(l?"input--valid":"input--invalid"),l}validateAll(){let t=!0;return this.boundInputs.forEach(e=>{e.touched=!0,e.type==="password_confirm"?this.validatePasswordConfirm(e)||(t=!1):this.validateInput(e,!0)||(t=!1)}),t}isValid(){let t=!0;return this.boundInputs.forEach(e=>{e.isValid||(t=!1)}),t}reset(){this.boundInputs.forEach(t=>{t.touched=!1,t.isValid=!1,t.input.classList.remove("input--valid","input--invalid"),t.feedbackContainer&&t.feedbackContainer.querySelectorAll(".validation-item").forEach(s=>s.classList.remove("valid","invalid"))})}getErrors(){const t={};return this.boundInputs.forEach((e,s)=>{const i=s.value,n=this.validationRules[e.type],a=[];n.forEach(o=>{o.test(i)||a.push(o.message)}),a.length>0&&(t[s.name||s.id||e.type]=a)}),t}}class v{constructor(t,e){this.input=t,this.toggleBtn=e,this.isVisible=!1,this.input&&this.toggleBtn&&this.init()}init(){this.toggleBtn.addEventListener("click",t=>{t.preventDefault(),this.toggle()}),this.updateIcon()}toggle(){this.isVisible=!this.isVisible,this.input.type=this.isVisible?"text":"password",this.updateIcon()}updateIcon(){const t='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>',e='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>';this.toggleBtn.innerHTML=this.isVisible?e:t,this.toggleBtn.setAttribute("aria-label",this.isVisible?"Hide password":"Show password")}}class w{constructor(t){this.baseUrl=t.baseUrl||"",this.signinForm=t.signinForm,this.signinBtn=t.signinBtn,this.showToast=t.showToast||this.defaultToast.bind(this),this.isSubmitting=!1,this.validator=null,this.passwordToggle=null,this.init()}init(){if(!this.signinForm){console.error("SignIn: Required form element not found");return}this.initValidator(),this.initPasswordToggle(),this.signinForm.addEventListener("submit",t=>this.handleSignin(t))}initValidator(){const t=this.signinForm.querySelector("#email"),e=this.signinForm.querySelector("#password"),s=document.getElementById("emailFeedback"),i=document.getElementById("passwordFeedback");this.validator=new p({validateOnInput:!0}),t&&s&&this.validator.bindInput(t,"email",s),e&&i&&this.validator.bindInput(e,"password",i)}initPasswordToggle(){const t=this.signinForm.querySelector("#password"),e=document.getElementById("passwordToggle");t&&e&&(this.passwordToggle=new v(t,e))}async handleSignin(t){if(t.preventDefault(),this.isSubmitting||this.validator&&!this.validator.validateAll())return;const e=this.getFormData();this.setButtonLoading(!0,"Signing in..."),this.isSubmitting=!0;const s=await this.apiRequest("/api/v1/auth/sign-in","POST",e);this.isSubmitting=!1,s.ok?(this.showToast("Sign in successful!","success"),s.data.token&&this.setAuthCookie(s.data.token,e.remember),this.setButtonLoading(!1,"Redirecting..."),setTimeout(()=>{window.location.href="/"},1500)):(this.setButtonLoading(!1,"Sign In"),this.handleApiError(s))}getFormData(){return{email:this.signinForm.querySelector("#email")?.value.trim()||"",password:this.signinForm.querySelector("#password")?.value||"",remember:this.signinForm.querySelector("#remember")?.checked||!1}}setAuthCookie(t,e=!1){const s=e?2592e3:604800;document.cookie=`auth_token=${t}; path=/; max-age=${s}; SameSite=Strict`}setButtonLoading(t,e){this.signinBtn&&(this.signinBtn.disabled=t,this.signinBtn.textContent=e,t?this.signinBtn.classList.add("btn--loading"):this.signinBtn.classList.remove("btn--loading"))}handleApiError(t){const e=t.data?.message||"Sign in failed. Please check your credentials.";if(this.showToast(e,"error"),t.data?.errors)for(const[s,i]of Object.entries(t.data.errors))Array.isArray(i)&&i.forEach(n=>this.showToast(`${s}: ${n}`,"error"))}async apiRequest(t,e="GET",s=null){const i={method:e,headers:f()};s&&(i.body=JSON.stringify(s));try{const n=await fetch(`${this.baseUrl}${t}`,i),a=await n.json();return{ok:n.ok,data:a}}catch(n){return console.error("API request failed:",n),{ok:!1,data:{message:"Network error. Please try again."}}}}defaultToast(t,e="info"){console.log(`[${e.toUpperCase()}] ${t}`),alert(t)}}function u(){const r=document.getElementById("signinForm"),t=document.getElementById("signinBtn");if(!r){console.error("SignIn page: Required DOM elements not found");return}const e=window.BASE_URL||"",s=y(),i=new w({baseUrl:e,signinForm:r,signinBtn:t,showToast:s});typeof window<"u"&&(window.signinController=i)}function y(){const r={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)"};return function(e,s="success"){typeof Toastify<"u"?Toastify({text:e,duration:4e3,gravity:"top",position:"right",style:{background:r[s]||r.info}}).showToast():console.log(`[${s.toUpperCase()}] ${e}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u()})();

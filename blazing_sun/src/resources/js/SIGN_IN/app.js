(function(){"use strict";class l{constructor(t){this.baseUrl=t.baseUrl||"",this.signinForm=t.signinForm,this.signinBtn=t.signinBtn,this.showToast=t.showToast||this.defaultToast.bind(this),this.isSubmitting=!1,this.init()}init(){if(!this.signinForm){console.error("SignIn: Required form element not found");return}this.signinForm.addEventListener("submit",t=>this.handleSignin(t))}async handleSignin(t){if(t.preventDefault(),this.isSubmitting)return;const i=this.getFormData();if(!this.validateFormData(i))return;this.setButtonLoading(!0,"Signing in..."),this.isSubmitting=!0;const e=await this.apiRequest("/api/v1/auth/sign-in","POST",i);this.isSubmitting=!1,e.ok?(this.showToast("Sign in successful!","success"),e.data.token&&this.setAuthCookie(e.data.token),this.setButtonLoading(!1,"Redirecting..."),setTimeout(()=>{window.location.href="/"},1500)):(this.setButtonLoading(!1,"Sign In"),this.handleApiError(e))}getFormData(){var t,i;return{email:((t=this.signinForm.querySelector("#email"))==null?void 0:t.value.trim())||"",password:((i=this.signinForm.querySelector("#password"))==null?void 0:i.value)||""}}validateFormData(t){return t.email?this.isValidEmail(t.email)?t.password?!0:(this.showToast("Password is required","error"),!1):(this.showToast("Please enter a valid email address","error"),!1):(this.showToast("Email is required","error"),!1)}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}setAuthCookie(t){document.cookie=`auth_token=${t}; path=/; max-age=604800; SameSite=Strict`}setButtonLoading(t,i){this.signinBtn&&(this.signinBtn.disabled=t,this.signinBtn.textContent=i,t?this.signinBtn.classList.add("btn--loading"):this.signinBtn.classList.remove("btn--loading"))}handleApiError(t){var e,s;const i=((e=t.data)==null?void 0:e.message)||"Sign in failed. Please check your credentials.";if(this.showToast(i,"error"),(s=t.data)!=null&&s.errors)for(const[o,r]of Object.entries(t.data.errors))Array.isArray(r)&&r.forEach(u=>this.showToast(`${o}: ${u}`,"error"))}async apiRequest(t,i="GET",e=null){const s={method:i,headers:{"Content-Type":"application/json"}};e&&(s.body=JSON.stringify(e));try{const o=await fetch(`${this.baseUrl}${t}`,s),r=await o.json();return{ok:o.ok,data:r}}catch(o){return console.error("API request failed:",o),{ok:!1,data:{message:"Network error. Please try again."}}}}defaultToast(t,i="info"){console.log(`[${i.toUpperCase()}] ${t}`),alert(t)}}function a(){const n=document.getElementById("signinForm"),t=document.getElementById("signinBtn");if(!n){console.error("SignIn page: Required DOM elements not found");return}const i=window.BASE_URL||"",e=d(),s=new l({baseUrl:i,signinForm:n,signinBtn:t,showToast:e});typeof window<"u"&&(window.signinController=s)}function d(){const n={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)"};return function(i,e="success"){typeof Toastify<"u"?Toastify({text:i,duration:4e3,gravity:"top",position:"right",style:{background:n[e]||n.info}}).showToast():console.log(`[${e.toUpperCase()}] ${i}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a()})();

(function(){"use strict";var c=document.createElement("style");c.textContent=`.profile{min-height:calc(100vh - 60px);padding:2rem;background:var(--bg-primary)}.profile__container{max-width:900px;margin:0 auto}.profile__header{margin-bottom:2rem}.profile__title{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin:0}.profile__grid{display:grid;gap:2rem}@media (min-width: 768px){.profile__grid{grid-template-columns:300px 1fr}}.profile-card{background:var(--card-bg);border-radius:8px;padding:2rem;box-shadow:0 4px 20px var(--card-shadow);transition:box-shadow .25s ease}.profile-card:hover{box-shadow:0 6px 24px var(--card-shadow)}.profile-card__title{font-size:1.125rem;font-weight:600;color:var(--text-primary);margin:0 0 1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border-color)}.avatar-section{display:flex;flex-direction:column;align-items:center}.avatar{position:relative;width:120px;height:120px;margin-bottom:1.5rem}.avatar__image{width:100%;height:100%;border-radius:9999px;object-fit:cover;border:4px solid var(--border-color);transition:border-color .25s ease}.avatar__placeholder{width:100%;height:100%;border-radius:9999px;background:var(--avatar-placeholder-bg, #e5e7eb);display:flex;align-items:center;justify-content:center;color:var(--avatar-placeholder-color, #9ca3af);border:4px solid var(--border-color)}.avatar__placeholder svg{width:60%;height:60%}.avatar__overlay{position:absolute;top:0;right:0;bottom:0;left:0;border-radius:9999px;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .25s ease;cursor:pointer}.avatar__overlay:hover{opacity:1}.avatar__overlay-icon{width:32px;height:32px;color:#fff}.avatar__input{display:none}.avatar__name{font-size:1.125rem;font-weight:600;color:var(--text-primary);margin-bottom:.25rem}.avatar__email{font-size:.875rem;color:var(--text-muted)}.avatar-preview{position:fixed;top:0;right:0;bottom:0;left:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:500;padding:2rem}.avatar-preview.hidden{display:none}.avatar-preview__container{background:var(--card-bg);border-radius:8px;padding:2rem;max-width:400px;width:100%}.avatar-preview__image{width:200px;height:200px;border-radius:9999px;object-fit:cover;margin:0 auto 1.5rem;display:block;border:4px solid var(--border-color)}.avatar-preview__actions{display:flex;gap:1rem;justify-content:center}.form-section{margin-bottom:2rem}.form-section:last-child{margin-bottom:0}.form-section__title{font-size:1rem;font-weight:600;color:var(--text-secondary);margin:0 0 1rem;text-transform:uppercase;letter-spacing:.5px}.form-group{margin-bottom:1rem}.form-group:last-child{margin-bottom:0}.form-group__label{display:block;font-size:.875rem;font-weight:500;color:var(--text-secondary);margin-bottom:.25rem}.form-group__input{width:100%;padding:.75rem 1rem;border:2px solid var(--input-border);border-radius:6px;background:var(--input-bg);color:var(--text-primary);font-size:1rem;font-family:inherit;transition:border-color .25s ease,box-shadow .25s ease}.form-group__input:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px #3498db33}.form-group__input:disabled{opacity:.6;cursor:not-allowed}.form-group__input::placeholder{color:var(--text-muted)}.form-group__hint{font-size:.875rem;color:var(--text-muted);margin-top:.25rem}.form-group__error{font-size:.875rem;color:#ef4444;margin-top:.25rem}.form-row{display:grid;gap:1rem}@media (min-width: 480px){.form-row{grid-template-columns:repeat(2,1fr)}}.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;border:none;border-radius:6px;font-size:1rem;font-weight:600;font-family:inherit;cursor:pointer;transition:all .25s ease;text-decoration:none}.btn:disabled{opacity:.6;cursor:not-allowed}.btn--primary{background:linear-gradient(135deg,#3498db,#764ba2);color:#fff}.btn--primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #3498db66}.btn--secondary{background:var(--btn-secondary-bg);color:var(--text-primary);border:2px solid var(--border-color)}.btn--secondary:hover:not(:disabled){border-color:#3498db;color:#3498db}.btn--danger{background:#ef4444;color:#fff}.btn--danger:hover:not(:disabled){background:#d93636}.btn--sm{padding:.5rem 1rem;font-size:.875rem}.btn--loading{pointer-events:none;opacity:.8}.btn--full{width:100%}.password-strength{margin-top:.5rem}.password-strength__track{height:4px;background:var(--border-color);border-radius:2px;overflow:hidden}.password-strength__bar{height:100%;width:0;transition:width .25s ease,background .25s ease}.password-strength__bar--weak{width:25%;background:#ef4444}.password-strength__bar--fair{width:50%;background:#f59e0b}.password-strength__bar--good{width:75%;background:#84cc16}.password-strength__bar--strong{width:100%;background:#10b981}.password-strength-text{font-size:.875rem;margin-top:.25rem;color:var(--text-muted)}.email-steps{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-bottom:2rem}.email-step{display:flex;align-items:center;gap:.5rem}.email-step__number{width:28px;height:28px;border-radius:9999px;background:var(--border-color);color:var(--text-muted);font-size:.875rem;font-weight:600;display:flex;align-items:center;justify-content:center;transition:all .25s ease}.email-step__label{font-size:.875rem;color:var(--text-muted);transition:color .25s ease}@media (max-width: 480px){.email-step__label{display:none}}.email-step--active .email-step__number{background:linear-gradient(135deg,#3498db,#764ba2);color:#fff}.email-step--active .email-step__label{color:var(--text-primary);font-weight:500}.email-step--completed .email-step__number{background:#10b981;color:#fff}.email-step__connector{width:30px;height:2px;background:var(--border-color)}@media (max-width: 480px){.email-step__connector{width:20px}}.section-divider{height:1px;background:var(--border-color);margin:2rem 0}.message-box{padding:1rem;border-radius:6px;margin-bottom:1.5rem}.message-box--info{background:#3498db1a;border:1px solid rgba(52,152,219,.3);color:var(--text-primary)}.message-box--success{background:#10b9811a;border:1px solid rgba(16,185,129,.3);color:#10b981}.message-box--warning{background:#f59e0b1a;border:1px solid rgba(245,158,11,.3);color:var(--text-primary)}.message-box--error{background:#ef44441a;border:1px solid rgba(239,68,68,.3);color:#ef4444}@media (max-width: 768px){.profile{padding:1rem}.profile__grid{grid-template-columns:1fr}.profile-card{padding:1.5rem}}@media (max-width: 480px){.profile{padding:.5rem}.avatar{width:80px;height:80px}.avatar__placeholder{font-size:1.25rem}}
/*$vite$:1*/`,document.head.appendChild(c);class p{constructor(e){var t,a;this.baseUrl=e.baseUrl||"",this.profileForm=e.profileForm,this.firstNameInput=e.firstNameInput,this.lastNameInput=e.lastNameInput,this.displayName=e.displayName,this.displayEmail=e.displayEmail,this.saveBtn=e.saveBtn,this.showToast=e.showToast||this.defaultToast.bind(this),this.isSubmitting=!1,this.userData=e.userData||null,this.originalFirstName=((t=this.firstNameInput)==null?void 0:t.value)||"",this.originalLastName=((a=this.lastNameInput)==null?void 0:a.value)||"",this.authToken=null,this.init()}init(){if(this.authToken=this.getTokenFromCookie(),!this.authToken&&!this.userData){this.showToast("Please sign in to view your profile","error"),setTimeout(()=>{window.location.href="/sign-in"},1500);return}this.profileForm&&this.profileForm.addEventListener("submit",e=>this.handleSubmit(e)),this.firstNameInput&&this.firstNameInput.addEventListener("input",()=>this.checkForChanges()),this.lastNameInput&&this.lastNameInput.addEventListener("input",()=>this.checkForChanges()),this.saveBtn&&(this.saveBtn.disabled=!0)}getTokenFromCookie(){const e=document.cookie.split(";");for(const t of e){const[a,i]=t.trim().split("=");if(a==="auth_token")return decodeURIComponent(i)}return null}getAuthToken(){return this.authToken}checkForChanges(){var i,r;if(!this.saveBtn)return;const e=((i=this.firstNameInput)==null?void 0:i.value)||"",t=((r=this.lastNameInput)==null?void 0:r.value)||"",a=e!==this.originalFirstName||t!==this.originalLastName;this.saveBtn.disabled=!a}async handleSubmit(e){var i,r;if(e.preventDefault(),this.isSubmitting)return;const t=((i=this.firstNameInput)==null?void 0:i.value.trim())||"",a=((r=this.lastNameInput)==null?void 0:r.value.trim())||"";if(!t){this.showToast("First name is required","error");return}if(!a){this.showToast("Last name is required","error");return}this.isSubmitting=!0,this.setButtonLoading(!0);try{const s={"Content-Type":"application/json"};this.authToken&&(s.Authorization=`Bearer ${this.authToken}`);const o=await fetch(`${this.baseUrl}/api/v1/user`,{method:"PATCH",headers:s,credentials:"same-origin",body:JSON.stringify({first_name:t,last_name:a})}),l=await o.json();o.ok?(this.originalFirstName=t,this.originalLastName=a,this.userData&&(this.userData.first_name=t,this.userData.last_name=a),this.displayName&&(this.displayName.textContent=`${t} ${a}`),this.showToast("Profile updated successfully!","success"),this.saveBtn.disabled=!0):this.handleApiError(l)}catch(s){console.error("Profile update failed:",s),this.showToast("Network error. Please try again.","error")}finally{this.isSubmitting=!1,this.setButtonLoading(!1)}}updateEmail(e){this.userData&&(this.userData.email=e),this.displayEmail&&(this.displayEmail.textContent=e)}getUserInitials(){var a,i;if(!this.userData)return"?";const e=((a=this.userData.first_name)==null?void 0:a[0])||"",t=((i=this.userData.last_name)==null?void 0:i[0])||"";return(e+t).toUpperCase()||"?"}getUserData(){return this.userData}setButtonLoading(e){this.saveBtn&&(this.saveBtn.disabled=e,this.saveBtn.textContent=e?"Saving...":"Save Changes",e?this.saveBtn.classList.add("btn--loading"):this.saveBtn.classList.remove("btn--loading"))}handleApiError(e){const t=e.message||"An error occurred. Please try again.";if(this.showToast(t,"error"),e.errors)for(const[a,i]of Object.entries(e.errors))Array.isArray(i)&&i.forEach(r=>this.showToast(`${a}: ${r}`,"error"))}defaultToast(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),alert(e)}}class f{constructor(e){this.baseUrl=e.baseUrl||"",this.avatarContainer=e.avatarContainer,this.avatarImage=e.avatarImage,this.avatarPlaceholder=e.avatarPlaceholder,this.fileInput=e.fileInput,this.previewModal=e.previewModal,this.previewImage=e.previewImage,this.confirmBtn=e.confirmBtn,this.cancelBtn=e.cancelBtn,this.showToast=e.showToast||this.defaultToast.bind(this),this.getAuthToken=e.getAuthToken||(()=>null),this.onUploadSuccess=e.onUploadSuccess||(()=>{}),this.selectedFile=null,this.isUploading=!1,this.maxFileSize=5*1024*1024,this.allowedTypes=["image/jpeg","image/png","image/gif","image/webp"],this.init()}init(){if(!this.fileInput||!this.avatarContainer){console.error("AvatarUpload: Required elements not found");return}const e=this.avatarContainer.querySelector(".avatar__overlay");e&&e.addEventListener("click",()=>this.fileInput.click()),this.fileInput.addEventListener("change",t=>this.handleFileSelect(t)),this.confirmBtn&&this.confirmBtn.addEventListener("click",()=>this.uploadAvatar()),this.cancelBtn&&this.cancelBtn.addEventListener("click",()=>this.closePreview()),this.previewModal&&this.previewModal.addEventListener("click",t=>{t.target===this.previewModal&&this.closePreview()})}handleFileSelect(e){const t=e.target.files[0];if(t){if(!this.allowedTypes.includes(t.type)){this.showToast("Please select a valid image file (JPEG, PNG, GIF, or WebP)","error"),this.fileInput.value="";return}if(t.size>this.maxFileSize){this.showToast("Image must be smaller than 5MB","error"),this.fileInput.value="";return}this.selectedFile=t,this.showPreview(t)}}showPreview(e){if(!this.previewModal||!this.previewImage)return;const t=new FileReader;t.onload=a=>{this.previewImage.src=a.target.result,this.previewModal.classList.remove("hidden")},t.readAsDataURL(e)}closePreview(){this.previewModal&&this.previewModal.classList.add("hidden"),this.selectedFile=null,this.fileInput.value=""}async uploadAvatar(){if(!this.selectedFile||this.isUploading)return;this.isUploading=!0,this.setButtonLoading(!0);const e=new FormData;e.append("file",this.selectedFile);try{const t=await fetch(`${this.baseUrl}/api/v1/upload/avatar`,{method:"POST",credentials:"same-origin",body:e}),a=await t.json();if(t.ok&&a.status==="success"){const i=a.upload,r=`${i.url}?variant=small`;this.updateAvatarDisplay(r),this.showToast("Profile picture updated!","success"),this.closePreview(),this.onUploadSuccess(i)}else this.showToast(a.message||"Failed to upload profile picture","error")}catch(t){console.error("Avatar upload failed:",t),this.showToast("Network error. Please try again.","error")}finally{this.isUploading=!1,this.setButtonLoading(!1)}}updateAvatarDisplay(e){this.avatarImage&&(this.avatarImage.src=e,this.avatarImage.classList.remove("hidden")),this.avatarPlaceholder&&this.avatarPlaceholder.classList.add("hidden")}setAvatar(e){if(e){const t=e.includes("?")?`${e}&variant=small`:`${e}?variant=small`;this.updateAvatarDisplay(t)}else this.avatarImage&&this.avatarImage.classList.add("hidden"),this.avatarPlaceholder&&this.avatarPlaceholder.classList.remove("hidden")}setButtonLoading(e){this.confirmBtn&&(this.confirmBtn.disabled=e,this.confirmBtn.textContent=e?"Uploading...":"Save",e?this.confirmBtn.classList.add("btn--loading"):this.confirmBtn.classList.remove("btn--loading"))}defaultToast(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),alert(e)}}class g{constructor(e){this.baseUrl=e.baseUrl||"",this.form=e.form,this.currentPasswordInput=e.currentPasswordInput,this.newPasswordInput=e.newPasswordInput,this.confirmPasswordInput=e.confirmPasswordInput,this.strengthBar=e.strengthBar,this.strengthText=e.strengthText,this.submitBtn=e.submitBtn,this.showToast=e.showToast||this.defaultToast.bind(this),this.getAuthToken=e.getAuthToken||(()=>null),this.isSubmitting=!1,this.init()}init(){if(!this.form){console.error("PasswordChange: Form element not found");return}this.form.addEventListener("submit",e=>this.handleSubmit(e)),this.newPasswordInput&&this.newPasswordInput.addEventListener("input",e=>{this.updatePasswordStrength(e.target.value)})}async handleSubmit(e){var r,s,o;if(e.preventDefault(),this.isSubmitting)return;const t=((r=this.currentPasswordInput)==null?void 0:r.value)||"",a=((s=this.newPasswordInput)==null?void 0:s.value)||"",i=((o=this.confirmPasswordInput)==null?void 0:o.value)||"";if(this.validatePasswords(t,a,i)){this.isSubmitting=!0,this.setButtonLoading(!0);try{const l={"Content-Type":"application/json"},d=this.getAuthToken();d&&(l.Authorization=`Bearer ${d}`);const h=await fetch(`${this.baseUrl}/api/v1/password/change-password`,{method:"POST",headers:l,credentials:"same-origin",body:JSON.stringify({current_password:t,new_password:a,confirm_password:i})}),v=await h.json();h.ok?(this.showToast("Password changed successfully! Redirecting to sign in...","success"),this.form.reset(),this.updatePasswordStrength(""),setTimeout(()=>{window.location.href="/sign-in"},1500)):this.handleApiError(v)}catch(l){console.error("Password change failed:",l),this.showToast("Network error. Please try again.","error")}finally{this.isSubmitting=!1,this.setButtonLoading(!1)}}}validatePasswords(e,t,a){return e?t?t.length<8?(this.showToast("Password must be at least 8 characters","error"),!1):/[A-Z]/.test(t)?/[a-z]/.test(t)?/[0-9]/.test(t)?/[^\p{L}\p{N}]/u.test(t)?t!==a?(this.showToast("Passwords do not match","error"),!1):e===t?(this.showToast("New password must be different from current password","error"),!1):!0:(this.showToast("Password must contain at least one special character","error"),!1):(this.showToast("Password must contain at least one digit","error"),!1):(this.showToast("Password must contain at least one lowercase letter","error"),!1):(this.showToast("Password must contain at least one uppercase letter","error"),!1):(this.showToast("New password is required","error"),!1):(this.showToast("Current password is required","error"),!1)}updatePasswordStrength(e){if(!this.strengthBar||!this.strengthText)return;const t=this.calculatePasswordStrength(e);if(this.strengthBar.classList.remove("password-strength__bar--weak","password-strength__bar--fair","password-strength__bar--good","password-strength__bar--strong"),e.length===0){this.strengthBar.style.width="0",this.strengthText.textContent="";return}t<2?(this.strengthBar.classList.add("password-strength__bar--weak"),this.strengthText.textContent="Weak"):t<3?(this.strengthBar.classList.add("password-strength__bar--fair"),this.strengthText.textContent="Fair"):t<4?(this.strengthBar.classList.add("password-strength__bar--good"),this.strengthText.textContent="Good"):(this.strengthBar.classList.add("password-strength__bar--strong"),this.strengthText.textContent="Strong")}calculatePasswordStrength(e){let t=0;return e.length>=8&&t++,e.length>=12&&t++,/[A-Z]/.test(e)&&t++,/[a-z]/.test(e)&&t++,/[0-9]/.test(e)&&t++,/[!@#$%^&*(),.?":{}|<>]/.test(e)&&t++,Math.min(t,5)}setButtonLoading(e){this.submitBtn&&(this.submitBtn.disabled=e,this.submitBtn.textContent=e?"Changing...":"Change Password",e?this.submitBtn.classList.add("btn--loading"):this.submitBtn.classList.remove("btn--loading"))}handleApiError(e){const t=e.message||"An error occurred. Please try again.";if(this.showToast(t,"error"),e.errors)for(const[a,i]of Object.entries(e.errors))Array.isArray(i)&&i.forEach(r=>this.showToast(`${a}: ${r}`,"error"))}defaultToast(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),alert(e)}}class w{constructor(e){this.baseUrl=e.baseUrl||"",this.step1Card=e.step1Card,this.step2Card=e.step2Card,this.step3Card=e.step3Card,this.step4Card=e.step4Card,this.newEmailForm=e.newEmailForm,this.verifyOldEmailForm=e.verifyOldEmailForm,this.verifyNewEmailForm=e.verifyNewEmailForm,this.newEmailInput=e.newEmailInput,this.oldEmailCodeInput=e.oldEmailCodeInput,this.newEmailCodeInput=e.newEmailCodeInput,this.sendEmailCodeBtn=e.sendEmailCodeBtn,this.verifyOldEmailBtn=e.verifyOldEmailBtn,this.verifyNewEmailBtn=e.verifyNewEmailBtn,this.stepIndicators=e.stepIndicators||[],this.currentEmailDisplay=e.currentEmailDisplay,this.newEmailDisplay=e.newEmailDisplay,this.showToast=e.showToast||this.defaultToast.bind(this),this.getAuthToken=e.getAuthToken||(()=>null),this.currentEmail=e.currentEmail||"",this.currentStep=1,this.isSubmitting=!1,this.newEmail="",this.init()}init(){this.newEmailForm&&this.newEmailForm.addEventListener("submit",e=>this.handleNewEmailSubmit(e)),this.verifyOldEmailForm&&this.verifyOldEmailForm.addEventListener("submit",e=>this.handleVerifyOldEmailSubmit(e)),this.verifyNewEmailForm&&this.verifyNewEmailForm.addEventListener("submit",e=>this.handleVerifyNewEmailSubmit(e)),this.oldEmailCodeInput&&this.oldEmailCodeInput.addEventListener("input",e=>this.formatCodeInput(e)),this.newEmailCodeInput&&this.newEmailCodeInput.addEventListener("input",e=>this.formatCodeInput(e)),document.querySelectorAll('[data-action="cancel"]').forEach(e=>{e.addEventListener("click",()=>this.goToStep(1))})}async handleNewEmailSubmit(e){var r;if(e.preventDefault(),this.isSubmitting)return;const t=((r=this.newEmailInput)==null?void 0:r.value.trim())||"";if(!this.validateEmail(t))return;if(t.toLowerCase()===this.currentEmail.toLowerCase()){this.showToast("New email cannot be the same as your current email","error");return}this.isSubmitting=!0,this.setButtonLoading(this.sendEmailCodeBtn,!0,"Sending...");const a={"Content-Type":"application/json"},i=this.getAuthToken();i&&(a.Authorization=`Bearer ${i}`);try{const s=await fetch(`${this.baseUrl}/api/v1/email/request-change`,{method:"POST",headers:a,credentials:"same-origin",body:JSON.stringify({new_email:t})}),o=await s.json();s.ok?(this.newEmail=t,this.showToast("Verification code sent to your current email!","success"),this.currentEmailDisplay&&(this.currentEmailDisplay.textContent=this.currentEmail),this.goToStep(2)):(this.showToast(o.message||"Failed to send verification code","error"),this.setButtonLoading(this.sendEmailCodeBtn,!1,"Request Email Change"))}catch(s){console.error("Email change request failed:",s),this.showToast("Network error. Please try again.","error"),this.setButtonLoading(this.sendEmailCodeBtn,!1,"Request Email Change")}finally{this.isSubmitting=!1}}async handleVerifyOldEmailSubmit(e){var r;if(e.preventDefault(),this.isSubmitting)return;const t=((r=this.oldEmailCodeInput)==null?void 0:r.value.trim())||"";if(!t||t.length<32){this.showToast("Please enter the verification code from your current email","error");return}this.isSubmitting=!0,this.setButtonLoading(this.verifyOldEmailBtn,!0,"Verifying...");const a={"Content-Type":"application/json"},i=this.getAuthToken();i&&(a.Authorization=`Bearer ${i}`);try{const s=await fetch(`${this.baseUrl}/api/v1/email/verify-old-email`,{method:"POST",headers:a,credentials:"same-origin",body:JSON.stringify({code:t})}),o=await s.json();s.ok?(this.showToast("Old email verified! Check your new email for the next code.","success"),this.newEmailDisplay&&(this.newEmailDisplay.textContent=this.newEmail),this.goToStep(3)):(this.showToast(o.message||"Invalid or expired verification code","error"),this.setButtonLoading(this.verifyOldEmailBtn,!1,"Verify Old Email"))}catch(s){console.error("Old email verification failed:",s),this.showToast("Network error. Please try again.","error"),this.setButtonLoading(this.verifyOldEmailBtn,!1,"Verify Old Email")}finally{this.isSubmitting=!1}}async handleVerifyNewEmailSubmit(e){var r;if(e.preventDefault(),this.isSubmitting)return;const t=((r=this.newEmailCodeInput)==null?void 0:r.value.trim())||"";if(!t||t.length<32){this.showToast("Please enter the verification code from your new email","error");return}this.isSubmitting=!0,this.setButtonLoading(this.verifyNewEmailBtn,!0,"Completing...");const a={"Content-Type":"application/json"},i=this.getAuthToken();i&&(a.Authorization=`Bearer ${i}`);try{const s=await fetch(`${this.baseUrl}/api/v1/email/verify-new-email`,{method:"POST",headers:a,credentials:"same-origin",body:JSON.stringify({code:t})}),o=await s.json();s.ok?(this.showToast("Email changed successfully!","success"),this.goToStep(4),this.startRedirectCountdown()):(this.showToast(o.message||"Invalid or expired verification code","error"),this.setButtonLoading(this.verifyNewEmailBtn,!1,"Complete Email Change"))}catch(s){console.error("New email verification failed:",s),this.showToast("Network error. Please try again.","error"),this.setButtonLoading(this.verifyNewEmailBtn,!1,"Complete Email Change")}finally{this.isSubmitting=!1}}startRedirectCountdown(){let e=5;const t=document.getElementById("redirectCountdown"),a=setInterval(()=>{e--,t&&(t.textContent=e),e<=0&&(clearInterval(a),window.location.href="/sign-in")},1e3)}goToStep(e){var a,i,r,s,o,l,d;this.currentStep=e,(a=this.step1Card)==null||a.classList.add("hidden"),(i=this.step2Card)==null||i.classList.add("hidden"),(r=this.step3Card)==null||r.classList.add("hidden"),(s=this.step4Card)==null||s.classList.add("hidden");const t=this.getCardForStep(e);if(t&&(t.classList.remove("hidden"),e<4)){const h=t.querySelector('input:not([type="hidden"])');h&&setTimeout(()=>h.focus(),100)}this.updateStepIndicators(e),this.setButtonLoading(this.sendEmailCodeBtn,!1,"Request Email Change"),this.setButtonLoading(this.verifyOldEmailBtn,!1,"Verify Old Email"),this.setButtonLoading(this.verifyNewEmailBtn,!1,"Complete Email Change"),e===1&&((o=this.newEmailForm)==null||o.reset(),(l=this.verifyOldEmailForm)==null||l.reset(),(d=this.verifyNewEmailForm)==null||d.reset(),this.newEmail="")}getCardForStep(e){switch(e){case 1:return this.step1Card;case 2:return this.step2Card;case 3:return this.step3Card;case 4:return this.step4Card;default:return null}}updateStepIndicators(e){this.stepIndicators.forEach((t,a)=>{const i=a+1;t.classList.remove("email-step--active","email-step--completed"),i<e?t.classList.add("email-step--completed"):i===e&&t.classList.add("email-step--active")})}validateEmail(e){return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?!0:(this.showToast("Please enter a valid email address","error"),!1):(this.showToast("Email is required","error"),!1)}formatCodeInput(e){const t=e.target;t.value=t.value.replace(/[^a-zA-Z0-9]/g,"").slice(0,32)}setButtonLoading(e,t,a){e&&(e.disabled=t,e.textContent=a,t?e.classList.add("btn--loading"):e.classList.remove("btn--loading"))}defaultToast(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),alert(e)}}function m(n,e="info"){const t={success:"linear-gradient(135deg, #10b981 0%, #059669 100%)",error:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",warning:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",info:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"};typeof Toastify=="function"?Toastify({text:n,duration:4e3,gravity:"top",position:"right",stopOnFocus:!0,style:{background:t[e]||t.info,borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}}).showToast():console.log(`[${e.toUpperCase()}] ${n}`)}function u(){const n=window.BASE_URL||"",e=window.USER_DATA||null,t=new p({baseUrl:n,userData:e,profileForm:document.getElementById("profileForm"),firstNameInput:document.getElementById("first_name"),lastNameInput:document.getElementById("last_name"),displayName:document.getElementById("displayName"),displayEmail:document.getElementById("displayEmail"),saveBtn:document.getElementById("saveProfileBtn"),showToast:m}),a=new f({baseUrl:n,avatarContainer:document.getElementById("avatarContainer"),avatarImage:document.getElementById("avatarImage"),avatarPlaceholder:document.getElementById("avatarPlaceholder"),fileInput:document.getElementById("avatarInput"),previewModal:document.getElementById("avatarPreviewModal"),previewImage:document.getElementById("previewImage"),confirmBtn:document.getElementById("confirmAvatarBtn"),cancelBtn:document.getElementById("cancelAvatarBtn"),showToast:m,getAuthToken:()=>t.getAuthToken(),onUploadSuccess:s=>{console.log("Avatar uploaded:",s)}}),i=new g({baseUrl:n,form:document.getElementById("passwordForm"),currentPasswordInput:document.getElementById("current_password"),newPasswordInput:document.getElementById("new_password"),confirmPasswordInput:document.getElementById("confirm_password"),strengthBar:document.querySelector(".password-strength__bar"),strengthText:document.querySelector(".password-strength-text"),submitBtn:document.getElementById("changePasswordBtn"),showToast:m,getAuthToken:()=>t.getAuthToken()}),r=new w({baseUrl:n,step1Card:document.getElementById("emailStep1"),step2Card:document.getElementById("emailStep2"),step3Card:document.getElementById("emailStep3"),step4Card:document.getElementById("emailStep4"),newEmailForm:document.getElementById("newEmailForm"),verifyOldEmailForm:document.getElementById("verifyOldEmailForm"),verifyNewEmailForm:document.getElementById("verifyNewEmailForm"),newEmailInput:document.getElementById("new_email"),oldEmailCodeInput:document.getElementById("old_email_code"),newEmailCodeInput:document.getElementById("new_email_code"),sendEmailCodeBtn:document.getElementById("sendEmailCodeBtn"),verifyOldEmailBtn:document.getElementById("verifyOldEmailBtn"),verifyNewEmailBtn:document.getElementById("verifyNewEmailBtn"),stepIndicators:Array.from(document.querySelectorAll(".email-step")),currentEmailDisplay:document.getElementById("currentEmailDisplay"),newEmailDisplay:document.getElementById("newEmailDisplay"),currentEmail:(e==null?void 0:e.email)||"",showToast:m,getAuthToken:()=>t.getAuthToken()});window.profilePage=t,window.avatarUpload=a,window.passwordChange=i,window.emailChange=r}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u()})();

(function(){"use strict";class u{constructor(t){this.baseUrl=t.baseUrl||"",this.signupCard=t.signupCard,this.activationCard=t.activationCard,this.signupForm=t.signupForm,this.activationForm=t.activationForm,this.showToast=t.showToast||this.defaultToast.bind(this),this.userEmail="",this.isSubmitting=!1,this.init()}init(){if(!this.signupForm||!this.activationForm){console.error("SignUp: Required form elements not found");return}this.signupForm.addEventListener("submit",t=>this.handleSignup(t)),this.activationForm.addEventListener("submit",t=>this.handleActivation(t)),this.setupInputValidation()}setupInputValidation(){const t=this.signupForm.querySelector("#password"),i=this.signupForm.querySelector("#confirm_password");t&&i&&(i.addEventListener("input",()=>{this.validatePasswordMatch(t,i)}),t.addEventListener("input",()=>{i.value&&this.validatePasswordMatch(t,i)}))}validatePasswordMatch(t,i){i.value&&t.value!==i.value?i.classList.add("form-group__input--error"):i.classList.remove("form-group__input--error")}async handleSignup(t){if(t.preventDefault(),this.isSubmitting)return;const i=this.signupForm.querySelector('button[type="submit"]'),s=this.getSignupFormData();if(!this.validateSignupData(s))return;this.setButtonLoading(i,!0,"Creating account..."),this.isSubmitting=!0;const e=await this.apiRequest("/api/v1/auth/sign-up","POST",s);this.setButtonLoading(i,!1,"Sign Up"),this.isSubmitting=!1,e.ok?(this.showToast("Sign up successful! Please check your email for the activation code.","success"),this.userEmail=s.email,this.showActivationForm()):this.handleApiError(e)}async handleActivation(t){if(t.preventDefault(),this.isSubmitting)return;const i=this.activationForm.querySelector('button[type="submit"]'),s=this.activationForm.querySelector("#activation_code");if(!s||!s.value.trim()){this.showToast("Please enter the activation code","error");return}const e={code:s.value.trim()};this.setButtonLoading(i,!0,"Activating..."),this.isSubmitting=!0;const r=await this.apiRequest("/api/v1/account/activate-account","POST",e);r.ok?(this.showToast("Account activated successfully! Redirecting to sign in...","success"),this.setButtonLoading(i,!1,"Activated!"),setTimeout(()=>{window.location.href="/sign-in"},2e3)):(this.setButtonLoading(i,!1,"Activate Account"),this.isSubmitting=!1,this.handleApiError(r))}getSignupFormData(){var t,i,s,e,r;return{first_name:((t=this.signupForm.querySelector("#first_name"))==null?void 0:t.value.trim())||"",last_name:((i=this.signupForm.querySelector("#last_name"))==null?void 0:i.value.trim())||"",email:((s=this.signupForm.querySelector("#email"))==null?void 0:s.value.trim())||"",password:((e=this.signupForm.querySelector("#password"))==null?void 0:e.value)||"",confirm_password:((r=this.signupForm.querySelector("#confirm_password"))==null?void 0:r.value)||""}}validateSignupData(t){return t.first_name?t.last_name?t.email?this.isValidEmail(t.email)?t.password?t.password.length<8?(this.showToast("Password must be at least 8 characters","error"),!1):t.password!==t.confirm_password?(this.showToast("Passwords do not match","error"),!1):!0:(this.showToast("Password is required","error"),!1):(this.showToast("Please enter a valid email address","error"),!1):(this.showToast("Email is required","error"),!1):(this.showToast("Last name is required","error"),!1):(this.showToast("First name is required","error"),!1)}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}showActivationForm(){if(this.signupCard&&this.activationCard){this.signupCard.classList.add("hidden"),this.activationCard.classList.remove("hidden");const t=this.activationCard.querySelector("#activation_email_display");t&&(t.textContent=this.userEmail);const i=this.activationCard.querySelector("#activation_code");i&&i.focus()}}setButtonLoading(t,i,s){t&&(t.disabled=i,t.textContent=s,i?t.classList.add("btn--loading"):t.classList.remove("btn--loading"))}handleApiError(t){var s,e;const i=((s=t.data)==null?void 0:s.message)||"An error occurred. Please try again.";if(this.showToast(i,"error"),(e=t.data)!=null&&e.errors)for(const[r,o]of Object.entries(t.data.errors))Array.isArray(o)&&o.forEach(l=>this.showToast(`${r}: ${l}`,"error"))}async apiRequest(t,i="GET",s=null){const e={method:i,headers:{"Content-Type":"application/json"}};s&&(e.body=JSON.stringify(s));try{const r=await fetch(`${this.baseUrl}${t}`,e),o=await r.json();return{ok:r.ok,data:o}}catch(r){return console.error("API request failed:",r),{ok:!1,data:{message:"Network error. Please try again."}}}}defaultToast(t,i="info"){console.log(`[${i.toUpperCase()}] ${t}`),alert(t)}}function n(){const a=document.getElementById("signupCard"),t=document.getElementById("activationCard"),i=document.getElementById("signupForm"),s=document.getElementById("activationForm");if(!a||!t||!i||!s){console.error("SignUp page: Required DOM elements not found");return}const e=window.BASE_URL||"",r=c(),o=new u({baseUrl:e,signupCard:a,activationCard:t,signupForm:i,activationForm:s,showToast:r});typeof window<"u"&&(window.signupController=o)}function c(){const a={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)"};return function(i,s="success"){typeof Toastify<"u"?Toastify({text:i,duration:4e3,gravity:"top",position:"right",style:{background:a[s]||a.info}}).showToast():console.log(`[${s.toUpperCase()}] ${i}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})();

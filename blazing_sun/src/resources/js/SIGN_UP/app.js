(function(){"use strict";function p(){const o=document.querySelector('meta[name="csrf-token"]');return o?o.getAttribute("content"):(console.warn('CSRF token not found. Ensure <meta name="csrf-token"> exists in page head.'),null)}function f(o={}){const e=p(),t={"Content-Type":"application/json",...o};return e&&(t["X-CSRF-TOKEN"]=e),t}class v{constructor(e={}){this.options={showIcons:!0,validateOnInput:!0,...e},this.validationRules={email:[{test:t=>t.length>0,message:"Email is required",key:"required"},{test:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),message:"Must be a valid email format",key:"format"}],password:[{test:t=>t.length>0,message:"Password is required",key:"required"},{test:t=>t.length>=8,message:"Minimum 8 characters",key:"minLength"},{test:t=>/[A-Z]/.test(t),message:"At least one uppercase letter",key:"uppercase"},{test:t=>/[a-z]/.test(t),message:"At least one lowercase letter",key:"lowercase"},{test:t=>/[0-9]/.test(t),message:"At least one number",key:"number"},{test:t=>/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/`~]/.test(t),message:"At least one special character",key:"special"}],first_name:[{test:t=>t.length>0,message:"First name is required",key:"required"},{test:t=>t.length>=2,message:"Minimum 2 characters",key:"minLength"},{test:t=>/^[a-zA-Z\s'-]+$/.test(t)||t.length===0,message:"Letters only (no special characters)",key:"letters"}],last_name:[{test:t=>t.length>0,message:"Last name is required",key:"required"},{test:t=>t.length>=2,message:"Minimum 2 characters",key:"minLength"},{test:t=>/^[a-zA-Z\s'-]+$/.test(t)||t.length===0,message:"Letters only (no special characters)",key:"letters"}],current_password:[{test:t=>t.length>0,message:"Current password is required",key:"required"}],new_password:[{test:t=>t.length>0,message:"New password is required",key:"required"},{test:t=>t.length>=8,message:"Minimum 8 characters",key:"minLength"},{test:t=>/[A-Z]/.test(t),message:"At least one uppercase letter",key:"uppercase"},{test:t=>/[a-z]/.test(t),message:"At least one lowercase letter",key:"lowercase"},{test:t=>/[0-9]/.test(t),message:"At least one number",key:"number"},{test:t=>/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/`~]/.test(t),message:"At least one special character",key:"special"}]},this.boundInputs=new Map,this.passwordConfirmPairs=new Map}bindPasswordConfirm(e,t,s){if(!e||!t)return;const i={input:e,type:"password_confirm",feedbackContainer:s,isValid:!1,touched:!1,passwordInput:t};if(this.boundInputs.set(e,i),this.passwordConfirmPairs.set(e,t),s){s.innerHTML="",s.className="validation-feedback";const a=document.createElement("div");a.className="validation-item",a.dataset.rule="match",a.innerHTML=`
                <span class="validation-icon"></span>
                <span class="validation-text">Passwords must match</span>
            `,s.appendChild(a)}this.options.validateOnInput&&(e.addEventListener("input",()=>this.validatePasswordConfirm(i)),e.addEventListener("blur",()=>{i.touched=!0,this.validatePasswordConfirm(i)}),t.addEventListener("input",()=>{e.value.length>0&&this.validatePasswordConfirm(i)}))}validatePasswordConfirm(e){const{input:t,feedbackContainer:s,touched:i,passwordInput:a}=e,n=t.value,r=a.value,d=n.length>0&&n===r;if(e.isValid=d,s){const l=s.querySelector('[data-rule="match"]');l&&(l.classList.remove("valid","invalid"),(n.length>0||i)&&l.classList.add(d?"valid":"invalid"))}return t.classList.remove("input--valid","input--invalid"),(n.length>0||i)&&t.classList.add(d?"input--valid":"input--invalid"),d}bindInput(e,t,s){if(!e||!this.validationRules[t])return;const i={input:e,type:t,feedbackContainer:s,isValid:!1,touched:!1};this.boundInputs.set(e,i),this.createFeedbackElements(i),this.options.validateOnInput&&(e.addEventListener("input",()=>this.validateInput(i)),e.addEventListener("blur",()=>{i.touched=!0,this.validateInput(i)})),this.validateInput(i,!1)}createFeedbackElements(e){const{feedbackContainer:t,type:s}=e;if(!t)return;t.innerHTML="",t.className="validation-feedback",this.validationRules[s].forEach(a=>{const n=document.createElement("div");n.className="validation-item",n.dataset.rule=a.key,n.innerHTML=`
                <span class="validation-icon"></span>
                <span class="validation-text">${a.message}</span>
            `,t.appendChild(n)})}validateInput(e,t=!0){const{input:s,type:i,feedbackContainer:a,touched:n}=e,r=s.value,d=this.validationRules[i];let l=!0;return d.forEach(c=>{const g=c.test(r);if(g||(l=!1),a&&(t||n)){const u=a.querySelector(`[data-rule="${c.key}"]`);u&&(u.classList.remove("valid","invalid"),(r.length>0||n)&&u.classList.add(g?"valid":"invalid"))}}),e.isValid=l,s.classList.remove("input--valid","input--invalid"),(r.length>0||n)&&t&&s.classList.add(l?"input--valid":"input--invalid"),l}validateAll(){let e=!0;return this.boundInputs.forEach(t=>{t.touched=!0,t.type==="password_confirm"?this.validatePasswordConfirm(t)||(e=!1):this.validateInput(t,!0)||(e=!1)}),e}isValid(){let e=!0;return this.boundInputs.forEach(t=>{t.isValid||(e=!1)}),e}reset(){this.boundInputs.forEach(e=>{e.touched=!1,e.isValid=!1,e.input.classList.remove("input--valid","input--invalid"),e.feedbackContainer&&e.feedbackContainer.querySelectorAll(".validation-item").forEach(s=>s.classList.remove("valid","invalid"))})}getErrors(){const e={};return this.boundInputs.forEach((t,s)=>{const i=s.value,a=this.validationRules[t.type],n=[];a.forEach(r=>{r.test(i)||n.push(r.message)}),n.length>0&&(e[s.name||s.id||t.type]=n)}),e}}class h{constructor(e,t){this.input=e,this.toggleBtn=t,this.isVisible=!1,this.input&&this.toggleBtn&&this.init()}init(){this.toggleBtn.addEventListener("click",e=>{e.preventDefault(),this.toggle()}),this.updateIcon()}toggle(){this.isVisible=!this.isVisible,this.input.type=this.isVisible?"text":"password",this.updateIcon()}updateIcon(){const e='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>',t='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>';this.toggleBtn.innerHTML=this.isVisible?t:e,this.toggleBtn.setAttribute("aria-label",this.isVisible?"Hide password":"Show password")}}class w{constructor(e){this.baseUrl=e.baseUrl||"",this.signupCard=e.signupCard,this.activationCard=e.activationCard,this.signupForm=e.signupForm,this.activationForm=e.activationForm,this.showToast=e.showToast||this.defaultToast.bind(this),this.userEmail="",this.isSubmitting=!1,this.validator=null,this.passwordToggle=null,this.confirmPasswordToggle=null,this.init()}init(){if(!this.signupForm||!this.activationForm){console.error("SignUp: Required form elements not found");return}this.initValidator(),this.initPasswordToggles(),this.signupForm.addEventListener("submit",e=>this.handleSignup(e)),this.activationForm.addEventListener("submit",e=>this.handleActivation(e))}initValidator(){const e=this.signupForm.querySelector("#first_name"),t=this.signupForm.querySelector("#last_name"),s=this.signupForm.querySelector("#email"),i=this.signupForm.querySelector("#password"),a=this.signupForm.querySelector("#confirm_password"),n=document.getElementById("firstNameFeedback"),r=document.getElementById("lastNameFeedback"),d=document.getElementById("emailFeedback"),l=document.getElementById("passwordFeedback"),c=document.getElementById("confirmPasswordFeedback");this.validator=new v({validateOnInput:!0}),e&&n&&this.validator.bindInput(e,"first_name",n),t&&r&&this.validator.bindInput(t,"last_name",r),s&&d&&this.validator.bindInput(s,"email",d),i&&l&&this.validator.bindInput(i,"password",l),a&&i&&c&&this.validator.bindPasswordConfirm(a,i,c)}initPasswordToggles(){const e=this.signupForm.querySelector("#password"),t=this.signupForm.querySelector("#confirm_password"),s=document.getElementById("passwordToggle"),i=document.getElementById("confirmPasswordToggle");e&&s&&(this.passwordToggle=new h(e,s)),t&&i&&(this.confirmPasswordToggle=new h(t,i))}async handleSignup(e){if(e.preventDefault(),this.isSubmitting||this.validator&&!this.validator.validateAll())return;const t=this.signupForm.querySelector('button[type="submit"]'),s=this.getSignupFormData();this.setButtonLoading(t,!0,"Creating account..."),this.isSubmitting=!0;const i=await this.apiRequest("/api/v1/auth/sign-up","POST",s);this.setButtonLoading(t,!1,"Sign Up"),this.isSubmitting=!1,i.ok?(this.showToast("Sign up successful! Please check your email for the activation code.","success"),this.userEmail=s.email,this.showActivationForm()):this.handleApiError(i)}async handleActivation(e){if(e.preventDefault(),this.isSubmitting)return;const t=this.activationForm.querySelector('button[type="submit"]'),s=this.activationForm.querySelector("#activation_code");if(!s||!s.value.trim()){this.showToast("Please enter the activation code","error");return}const i={code:s.value.trim()};this.setButtonLoading(t,!0,"Activating..."),this.isSubmitting=!0;const a=await this.apiRequest("/api/v1/account/activate-account","POST",i);a.ok?(this.showToast("Account activated successfully! Redirecting to sign in...","success"),this.setButtonLoading(t,!1,"Activated!"),setTimeout(()=>{window.location.href="/sign-in"},2e3)):(this.setButtonLoading(t,!1,"Activate Account"),this.isSubmitting=!1,this.handleApiError(a))}getSignupFormData(){var e,t,s,i,a;return{first_name:((e=this.signupForm.querySelector("#first_name"))==null?void 0:e.value.trim())||"",last_name:((t=this.signupForm.querySelector("#last_name"))==null?void 0:t.value.trim())||"",email:((s=this.signupForm.querySelector("#email"))==null?void 0:s.value.trim())||"",password:((i=this.signupForm.querySelector("#password"))==null?void 0:i.value)||"",confirm_password:((a=this.signupForm.querySelector("#confirm_password"))==null?void 0:a.value)||""}}showActivationForm(){if(this.signupCard&&this.activationCard){this.signupCard.classList.add("hidden"),this.activationCard.classList.remove("hidden");const e=this.activationCard.querySelector("#activation_email_display");e&&(e.textContent=this.userEmail);const t=this.activationCard.querySelector("#activation_code");t&&t.focus()}}setButtonLoading(e,t,s){e&&(e.disabled=t,e.textContent=s,t?e.classList.add("btn--loading"):e.classList.remove("btn--loading"))}handleApiError(e){var s,i;const t=((s=e.data)==null?void 0:s.message)||"An error occurred. Please try again.";if(this.showToast(t,"error"),(i=e.data)!=null&&i.errors)for(const[a,n]of Object.entries(e.data.errors))Array.isArray(n)&&n.forEach(r=>this.showToast(`${a}: ${r}`,"error"))}async apiRequest(e,t="GET",s=null){const i={method:t,headers:f()};s&&(i.body=JSON.stringify(s));try{const a=await fetch(`${this.baseUrl}${e}`,i),n=await a.json();return{ok:a.ok,data:n}}catch(a){return console.error("API request failed:",a),{ok:!1,data:{message:"Network error. Please try again."}}}}defaultToast(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),alert(e)}}function m(){const o=document.getElementById("signupCard"),e=document.getElementById("activationCard"),t=document.getElementById("signupForm"),s=document.getElementById("activationForm");if(!o||!e||!t||!s){console.error("SignUp page: Required DOM elements not found");return}const i=window.BASE_URL||"",a=y(),n=new w({baseUrl:i,signupCard:o,activationCard:e,signupForm:t,activationForm:s,showToast:a});typeof window<"u"&&(window.signupController=n)}function y(){const o={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)"};return function(t,s="success"){typeof Toastify<"u"?Toastify({text:t,duration:4e3,gravity:"top",position:"right",style:{background:o[s]||o.info}}).showToast():console.log(`[${s.toUpperCase()}] ${t}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()})();

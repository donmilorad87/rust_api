{"version":3,"file":"app.js","sources":["../../../../frontend/games/TIC_TAC_TOE/src/TicTacToe.js","../../../../frontend/games/TIC_TAC_TOE/src/main.js"],"sourcesContent":["/**\n * TicTacToe Web Component\n *\n * A self-contained tic-tac-toe game component that handles WebSocket communication,\n * game state, and rendering. Supports lobby mode, game mode, and spectator mode.\n *\n * Game Rules:\n * - Best-of-9 match (first to 5 wins)\n * - 60-second turn timer\n * - Turn order reverses after each game (win or draw)\n * - Winner gets 60% of prize pool (1200 coins from 2000 pool)\n *\n * Usage (Lobby Mode):\n * <tic-tac-toe\n *   data-ws-url=\"wss://localhost/ws/games\"\n *   data-user-id=\"1\"\n *   data-username=\"Player1\"\n *   data-mode=\"lobby\"\n * ></tic-tac-toe>\n *\n * Usage (Game Mode):\n * <tic-tac-toe\n *   data-ws-url=\"wss://localhost/ws/games\"\n *   data-room-id=\"abc123\"\n *   data-room-name=\"My Game\"\n *   data-user-id=\"1\"\n *   data-username=\"Player1\"\n *   data-avatar-id=\"avatar123\"\n *   data-mode=\"game\"\n * ></tic-tac-toe>\n */\n\nconst TURN_TIMER_SECONDS = 60;\nconst WIN_SCORE = 5;\n\nconst template = document.createElement('template');\ntemplate.innerHTML = `\n  <style>\n    :host {\n      display: block;\n      font-family: var(--font-family, system-ui, sans-serif);\n      --primary-color: var(--game-primary, #6366f1);\n      --success-color: var(--game-success, #22c55e);\n      --danger-color: var(--game-danger, #ef4444);\n      --warning-color: var(--game-warning, #f59e0b);\n      --bg-color: var(--game-bg, #1e1e2e);\n      --card-bg: var(--game-card-bg, #2a2a3e);\n      --text-color: var(--game-text, #e2e8f0);\n      --text-muted: var(--game-text-muted, #94a3b8);\n      --border-color: var(--game-border, #3f3f5a);\n      --x-color: #3b82f6;\n      --o-color: #f59e0b;\n    }\n\n    * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    .game-container {\n      background: var(--bg-color);\n      border-radius: 1rem;\n      padding: 1.5rem;\n      color: var(--text-color);\n      min-height: 400px;\n    }\n\n    .game-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1.5rem;\n      padding-bottom: 1rem;\n      border-bottom: 1px solid var(--border-color);\n      flex-wrap: wrap;\n      gap: 1rem;\n    }\n\n    .game-title {\n      font-size: 1.5rem;\n      font-weight: 600;\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    .game-status {\n      font-size: 0.875rem;\n      padding: 0.375rem 0.75rem;\n      border-radius: 9999px;\n      background: var(--card-bg);\n    }\n\n    .game-status--waiting { color: var(--warning-color); }\n    .game-status--playing { color: var(--success-color); }\n    .game-status--finished { color: var(--text-muted); }\n\n    .connection-indicator {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n      font-size: 0.75rem;\n      color: var(--text-muted);\n    }\n\n    .connection-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      background: var(--danger-color);\n    }\n\n    .connection-dot--connected { background: var(--success-color); }\n    .connection-dot--connecting {\n      background: var(--warning-color);\n      animation: pulse 1s infinite;\n    }\n\n    @keyframes pulse {\n      0%, 100% { opacity: 1; }\n      50% { opacity: 0.5; }\n    }\n\n    /* ============================================\n       LOBBY MODE STYLES\n       ============================================ */\n\n    .lobby-section {\n      display: none;\n    }\n\n    .lobby-section.active {\n      display: block;\n    }\n\n    .lobby-controls {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1.5rem;\n      flex-wrap: wrap;\n      gap: 1rem;\n    }\n\n    .lobby-title {\n      font-size: 1.25rem;\n      font-weight: 600;\n    }\n\n    .create-room-btn {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n      padding: 0.625rem 1.25rem;\n      font-size: 0.9375rem;\n      font-weight: 600;\n      border: none;\n      border-radius: 0.5rem;\n      background: var(--primary-color);\n      color: white;\n      cursor: pointer;\n      transition: opacity 0.2s, transform 0.2s;\n    }\n\n    .create-room-btn:hover {\n      opacity: 0.9;\n      transform: translateY(-1px);\n    }\n\n    .rooms-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n      gap: 1rem;\n    }\n\n    .room-card {\n      background: var(--card-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 0.75rem;\n      padding: 1.25rem;\n      cursor: pointer;\n      transition: border-color 0.2s, transform 0.2s;\n    }\n\n    .room-card:hover {\n      border-color: var(--primary-color);\n      transform: translateY(-2px);\n    }\n\n    .room-card__header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 0.75rem;\n    }\n\n    .room-card__name {\n      font-size: 1.125rem;\n      font-weight: 600;\n    }\n\n    .room-card__status {\n      font-size: 0.75rem;\n      padding: 0.25rem 0.5rem;\n      border-radius: 9999px;\n      text-transform: uppercase;\n      font-weight: 600;\n    }\n\n    .room-card__status--waiting {\n      background: rgba(245, 158, 11, 0.2);\n      color: var(--warning-color);\n    }\n\n    .room-card__status--playing {\n      background: rgba(34, 197, 94, 0.2);\n      color: var(--success-color);\n    }\n\n    .room-card__info {\n      display: flex;\n      gap: 1rem;\n      color: var(--text-muted);\n      font-size: 0.8125rem;\n      margin-bottom: 0.75rem;\n    }\n\n    .room-card__info-item {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.25rem;\n    }\n\n    .room-card__info-icon {\n      width: 14px;\n      height: 14px;\n    }\n\n    .room-card__no-spectators {\n      font-size: 0.75rem;\n      color: var(--text-muted);\n      opacity: 0.7;\n    }\n\n    .room-card__players {\n      display: flex;\n      gap: 0.5rem;\n      margin-bottom: 1rem;\n      flex-wrap: wrap;\n    }\n\n    .player-badge {\n      font-size: 0.75rem;\n      padding: 0.25rem 0.625rem;\n      border-radius: 0.375rem;\n      background: var(--bg-color);\n    }\n\n    .player-badge--ready {\n      background: rgba(34, 197, 94, 0.15);\n      color: var(--success-color);\n    }\n\n    .room-card__actions {\n      display: flex;\n      gap: 0.5rem;\n    }\n\n    .join-btn {\n      flex: 1;\n      padding: 0.5rem 1rem;\n      font-size: 0.875rem;\n      font-weight: 500;\n      border: none;\n      border-radius: 0.5rem;\n      background: var(--primary-color);\n      color: white;\n      cursor: pointer;\n      transition: opacity 0.2s;\n    }\n\n    .join-btn:hover {\n      opacity: 0.9;\n    }\n\n    .spectate-btn {\n      padding: 0.5rem 1rem;\n      font-size: 0.875rem;\n      font-weight: 500;\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      background: transparent;\n      color: var(--text-color);\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .spectate-btn:hover {\n      background: var(--border-color);\n    }\n\n    .room-card__lock {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.25rem;\n      color: var(--text-muted);\n      font-size: 0.75rem;\n    }\n\n    .room-card__lock-icon {\n      width: 14px;\n      height: 14px;\n    }\n\n    .room-card__status--in_progress {\n      background: rgba(34, 197, 94, 0.15);\n      color: var(--success-color);\n    }\n\n    .no-rooms {\n      text-align: center;\n      padding: 3rem;\n      color: var(--text-muted);\n    }\n\n    .empty-state {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 4rem 2rem;\n      text-align: center;\n    }\n\n    .empty-state__icon {\n      font-size: 4rem;\n      margin-bottom: 1rem;\n    }\n\n    .empty-state__title {\n      font-size: 1.25rem;\n      font-weight: 600;\n      margin-bottom: 0.5rem;\n    }\n\n    .empty-state__message {\n      color: var(--text-muted);\n      margin-bottom: 1.5rem;\n    }\n\n    .loading-state {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 4rem 2rem;\n    }\n\n    .spinner {\n      width: 40px;\n      height: 40px;\n      border: 3px solid var(--border-color);\n      border-top-color: var(--primary-color);\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n      margin-bottom: 1rem;\n    }\n\n    /* ============================================\n       GAME MODE STYLES\n       ============================================ */\n\n    .game-section {\n      display: none;\n    }\n\n    .game-section.active {\n      display: block;\n    }\n\n    .match-info {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 2rem;\n      margin-bottom: 1.5rem;\n      padding: 1rem;\n      background: var(--card-bg);\n      border-radius: 0.75rem;\n    }\n\n    .player-score {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 0.5rem;\n      min-width: 120px;\n    }\n\n    .player-score__name {\n      font-weight: 600;\n      font-size: 1rem;\n    }\n\n    .player-score__mark {\n      font-size: 1.5rem;\n      font-weight: bold;\n    }\n\n    .player-score__mark--x { color: var(--x-color); }\n    .player-score__mark--o { color: var(--o-color); }\n\n    .player-score__value {\n      font-size: 2rem;\n      font-weight: bold;\n    }\n\n    .player-score--active {\n      background: rgba(99, 102, 241, 0.2);\n      border-radius: 0.5rem;\n      padding: 0.5rem 1rem;\n    }\n\n    .vs-divider {\n      font-size: 1.25rem;\n      color: var(--text-muted);\n      font-weight: bold;\n    }\n\n    .game-number {\n      text-align: center;\n      margin-bottom: 1rem;\n      color: var(--text-muted);\n      font-size: 0.875rem;\n    }\n\n    .turn-timer {\n      text-align: center;\n      margin-bottom: 1rem;\n    }\n\n    .turn-timer__text {\n      font-size: 0.875rem;\n      color: var(--text-muted);\n    }\n\n    .turn-timer__value {\n      font-size: 1.5rem;\n      font-weight: bold;\n      color: var(--text-color);\n    }\n\n    .turn-timer__value--warning {\n      color: var(--warning-color);\n    }\n\n    .turn-timer__value--danger {\n      color: var(--danger-color);\n      animation: pulse 0.5s infinite;\n    }\n\n    /* ============================================\n       GAME BOARD STYLES\n       ============================================ */\n\n    .board-container {\n      display: flex;\n      justify-content: center;\n      margin-bottom: 1.5rem;\n    }\n\n    .board {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: 0.5rem;\n      max-width: 300px;\n      width: 100%;\n    }\n\n    .cell {\n      aspect-ratio: 1;\n      background: var(--card-bg);\n      border: 2px solid var(--border-color);\n      border-radius: 0.5rem;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 3rem;\n      font-weight: bold;\n      cursor: pointer;\n      transition: background 0.2s, border-color 0.2s, transform 0.1s;\n    }\n\n    .cell:hover:not(.cell--disabled) {\n      background: rgba(99, 102, 241, 0.1);\n      border-color: var(--primary-color);\n    }\n\n    .cell--disabled {\n      cursor: not-allowed;\n      opacity: 0.7;\n    }\n\n    .cell--x {\n      color: var(--x-color);\n    }\n\n    .cell--o {\n      color: var(--o-color);\n    }\n\n    .cell--winning {\n      background: rgba(34, 197, 94, 0.3);\n      border-color: var(--success-color);\n      animation: winPulse 0.5s ease-in-out 3;\n    }\n\n    @keyframes winPulse {\n      0%, 100% { transform: scale(1); }\n      50% { transform: scale(1.05); }\n    }\n\n    /* ============================================\n       TURN INDICATOR\n       ============================================ */\n\n    .turn-indicator {\n      text-align: center;\n      padding: 1rem;\n      background: var(--card-bg);\n      border-radius: 0.5rem;\n      margin-bottom: 1rem;\n    }\n\n    .turn-indicator__text {\n      font-size: 1.125rem;\n      font-weight: 600;\n    }\n\n    .turn-indicator--your-turn {\n      background: rgba(99, 102, 241, 0.2);\n      border: 2px solid var(--primary-color);\n    }\n\n    /* ============================================\n       GAME RESULT OVERLAY\n       ============================================ */\n\n    .game-result {\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.8);\n      z-index: 100;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .game-result.active {\n      display: flex;\n    }\n\n    .game-result__content {\n      background: var(--card-bg);\n      border-radius: 1rem;\n      padding: 2rem;\n      text-align: center;\n      max-width: 400px;\n      width: 90%;\n    }\n\n    .game-result__title {\n      font-size: 2rem;\n      font-weight: bold;\n      margin-bottom: 1rem;\n    }\n\n    .game-result__title--win {\n      color: var(--success-color);\n    }\n\n    .game-result__title--lose {\n      color: var(--danger-color);\n    }\n\n    .game-result__title--draw {\n      color: var(--warning-color);\n    }\n\n    .game-result__message {\n      font-size: 1rem;\n      color: var(--text-muted);\n      margin-bottom: 1.5rem;\n    }\n\n    .game-result__prize {\n      font-size: 1.5rem;\n      font-weight: bold;\n      color: var(--success-color);\n      margin-bottom: 1rem;\n    }\n\n    .game-result__btn {\n      padding: 0.75rem 2rem;\n      font-size: 1rem;\n      font-weight: 600;\n      border: none;\n      border-radius: 0.5rem;\n      background: var(--primary-color);\n      color: white;\n      cursor: pointer;\n    }\n\n    /* ============================================\n       WAITING ROOM\n       ============================================ */\n\n    .waiting-room {\n      display: none;\n      text-align: center;\n      padding: 2rem;\n    }\n\n    .waiting-room.active {\n      display: block;\n    }\n\n    .waiting-room__title {\n      font-size: 1.5rem;\n      font-weight: 600;\n      margin-bottom: 1rem;\n    }\n\n    .waiting-room__players {\n      display: flex;\n      justify-content: center;\n      gap: 2rem;\n      margin-bottom: 1.5rem;\n    }\n\n    .waiting-player {\n      padding: 1rem 2rem;\n      background: var(--card-bg);\n      border-radius: 0.5rem;\n      min-width: 150px;\n    }\n\n    .waiting-player__name {\n      font-weight: 600;\n      margin-bottom: 0.5rem;\n    }\n\n    .waiting-player__status {\n      font-size: 0.875rem;\n      color: var(--text-muted);\n    }\n\n    .waiting-player__status--ready {\n      color: var(--success-color);\n    }\n\n    .ready-btn {\n      padding: 0.75rem 2rem;\n      font-size: 1rem;\n      font-weight: 600;\n      border: none;\n      border-radius: 0.5rem;\n      background: var(--success-color);\n      color: white;\n      cursor: pointer;\n      transition: opacity 0.2s;\n    }\n\n    .ready-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .leave-btn {\n      margin-top: 1rem;\n      padding: 0.5rem 1rem;\n      font-size: 0.875rem;\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      background: transparent;\n      color: var(--text-muted);\n      cursor: pointer;\n    }\n\n    /* ============================================\n       CHAT STYLES\n       ============================================ */\n\n    .chat-container {\n      margin-top: 1.5rem;\n      border-top: 1px solid var(--border-color);\n      padding-top: 1rem;\n    }\n\n    .chat-messages {\n      max-height: 200px;\n      overflow-y: auto;\n      margin-bottom: 0.75rem;\n      padding: 0.5rem;\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 0.5rem;\n    }\n\n    .chat-message {\n      font-size: 0.875rem;\n      margin-bottom: 0.25rem;\n    }\n\n    .chat-message__sender {\n      font-weight: 600;\n      color: var(--primary-color);\n    }\n\n    .chat-message__content {\n      color: var(--text-color);\n    }\n\n    .chat-input-container {\n      display: flex;\n      gap: 0.5rem;\n    }\n\n    .chat-input {\n      flex: 1;\n      padding: 0.5rem 0.75rem;\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      background: var(--card-bg);\n      color: var(--text-color);\n      font-size: 0.875rem;\n    }\n\n    .chat-input:focus {\n      outline: none;\n      border-color: var(--primary-color);\n    }\n\n    .chat-send-btn {\n      padding: 0.5rem 1rem;\n      border: none;\n      border-radius: 0.5rem;\n      background: var(--primary-color);\n      color: white;\n      cursor: pointer;\n    }\n\n    /* ============================================\n       MODAL STYLES\n       ============================================ */\n\n    .modal-overlay {\n      position: fixed;\n      inset: 0;\n      background: rgba(0, 0, 0, 0.7);\n      display: none;\n      align-items: center;\n      justify-content: center;\n      z-index: 1000;\n    }\n\n    .modal-overlay.active {\n      display: flex;\n    }\n\n    .modal-content {\n      background: var(--card-bg);\n      border-radius: 1rem;\n      padding: 2rem;\n      width: 90%;\n      max-width: 400px;\n      animation: scaleIn 0.2s;\n    }\n\n    @keyframes scaleIn {\n      from {\n        opacity: 0;\n        transform: scale(0.95);\n      }\n      to {\n        opacity: 1;\n        transform: scale(1);\n      }\n    }\n\n    .modal-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1.5rem;\n    }\n\n    .modal-title {\n      font-size: 1.25rem;\n      font-weight: 600;\n    }\n\n    .modal-close {\n      background: none;\n      border: none;\n      color: var(--text-muted);\n      font-size: 1.5rem;\n      cursor: pointer;\n      line-height: 1;\n    }\n\n    .modal-close:hover {\n      color: var(--text-color);\n    }\n\n    .form-group {\n      margin-bottom: 1.25rem;\n    }\n\n    .form-label {\n      display: block;\n      font-size: 0.875rem;\n      font-weight: 500;\n      margin-bottom: 0.5rem;\n    }\n\n    .form-label__optional {\n      font-weight: 400;\n      color: var(--text-muted);\n    }\n\n    .form-input {\n      width: 100%;\n      padding: 0.625rem 0.875rem;\n      font-size: 1rem;\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      background: var(--bg-color);\n      color: var(--text-color);\n      outline: none;\n      transition: border-color 0.2s;\n    }\n\n    .form-input:focus {\n      border-color: var(--primary-color);\n    }\n\n    .form-hint {\n      display: block;\n      font-size: 0.75rem;\n      color: var(--text-muted);\n      margin-top: 0.375rem;\n    }\n\n    .form-group--checkbox {\n      padding-top: 0.25rem;\n    }\n\n    .form-checkbox {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n      cursor: pointer;\n    }\n\n    .form-checkbox input[type=\"checkbox\"] {\n      width: 1.125rem;\n      height: 1.125rem;\n      margin: 0;\n      accent-color: var(--primary-color);\n      cursor: pointer;\n    }\n\n    .form-checkbox__label {\n      font-size: 0.9375rem;\n      font-weight: 500;\n      color: var(--text-color);\n    }\n\n    .form-error {\n      color: var(--danger-color);\n      font-size: 0.8125rem;\n      margin-top: 0.375rem;\n    }\n\n    .modal-actions {\n      display: flex;\n      gap: 0.75rem;\n      justify-content: flex-end;\n    }\n\n    .btn-secondary {\n      padding: 0.625rem 1.25rem;\n      font-size: 0.9375rem;\n      font-weight: 500;\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      background: transparent;\n      color: var(--text-color);\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .btn-secondary:hover {\n      background: var(--border-color);\n      color: var(--text-color);\n    }\n\n    .btn-primary {\n      padding: 0.625rem 1.25rem;\n      font-size: 0.9375rem;\n      font-weight: 500;\n      border: none;\n      border-radius: 0.5rem;\n      background: var(--primary-color);\n      color: white;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .btn-primary:hover {\n      opacity: 0.9;\n    }\n\n    .hidden {\n      display: none !important;\n    }\n\n    /* ============================================\n       PAUSED OVERLAY\n       ============================================ */\n\n    .paused-overlay {\n      display: none;\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.8);\n      z-index: 50;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .paused-overlay.active {\n      display: flex;\n    }\n\n    .paused-content {\n      text-align: center;\n      padding: 2rem;\n    }\n\n    .paused-title {\n      font-size: 1.5rem;\n      font-weight: 600;\n      color: var(--warning-color);\n      margin-bottom: 0.5rem;\n    }\n\n    .paused-message {\n      color: var(--text-muted);\n    }\n\n    /* ============================================\n       CONFIRMATION MODALS\n       ============================================ */\n\n    .modal-content--small {\n      max-width: 340px;\n      padding: 1.5rem;\n    }\n\n    .modal-body {\n      margin-bottom: 1.5rem;\n    }\n\n    .confirm-message {\n      font-size: 0.9375rem;\n      line-height: 1.5;\n      color: var(--text-color);\n    }\n\n    .confirm-message--error {\n      color: var(--danger-color);\n    }\n\n    .confirm-loader {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 0.75rem;\n      padding: 1rem 0;\n    }\n\n    .loader-spinner {\n      width: 32px;\n      height: 32px;\n      border: 3px solid var(--border-color);\n      border-top-color: var(--primary-color);\n      border-radius: 50%;\n      animation: spin 0.8s linear infinite;\n    }\n\n    @keyframes spin {\n      to {\n        transform: rotate(360deg);\n      }\n    }\n\n    .loader-text {\n      color: var(--text-muted);\n      font-size: 0.875rem;\n    }\n\n    /* ============================================\n       TOAST NOTIFICATIONS\n       ============================================ */\n\n    .toast-container {\n      position: fixed;\n      top: 1rem;\n      right: 1rem;\n      z-index: 2000;\n      display: flex;\n      flex-direction: column;\n      gap: 0.5rem;\n      pointer-events: none;\n    }\n\n    .toast {\n      background: var(--card-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      padding: 0.875rem 1rem;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n      max-width: 320px;\n      pointer-events: auto;\n      animation: toastSlideIn 0.3s ease;\n    }\n\n    .toast--error {\n      border-color: var(--danger-color);\n      background: rgba(220, 53, 69, 0.1);\n    }\n\n    .toast--success {\n      border-color: var(--success-color);\n      background: rgba(40, 167, 69, 0.1);\n    }\n\n    .toast__message {\n      font-size: 0.875rem;\n      color: var(--text-color);\n      line-height: 1.4;\n    }\n\n    .toast--error .toast__message {\n      color: var(--danger-color);\n    }\n\n    .toast--success .toast__message {\n      color: var(--success-color);\n    }\n\n    @keyframes toastSlideIn {\n      from {\n        opacity: 0;\n        transform: translateX(100%);\n      }\n      to {\n        opacity: 1;\n        transform: translateX(0);\n      }\n    }\n\n    @keyframes toastSlideOut {\n      from {\n        opacity: 1;\n        transform: translateX(0);\n      }\n      to {\n        opacity: 0;\n        transform: translateX(100%);\n      }\n    }\n\n    /* ============================================\n       ADMIN LOBBY STYLES\n       ============================================ */\n    .admin-lobby {\n      margin-bottom: 2rem;\n    }\n\n    .admin-lobby__header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    }\n\n    .admin-lobby__title {\n      font-size: 1rem;\n      font-weight: 600;\n      color: var(--text-color);\n    }\n\n    .admin-lobby__count {\n      font-size: 0.875rem;\n      color: var(--text-muted);\n    }\n\n    .lobby-players {\n      display: flex;\n      flex-direction: column;\n      gap: 0.75rem;\n    }\n\n    .lobby-player {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 0.875rem 1rem;\n      background: var(--card-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      transition: border-color 0.2s;\n    }\n\n    .lobby-player:hover {\n      border-color: var(--primary-color);\n    }\n\n    .lobby-player__info {\n      display: flex;\n      align-items: center;\n      gap: 0.75rem;\n    }\n\n    .lobby-player__avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      background: var(--border-color);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: 600;\n      font-size: 1rem;\n    }\n\n    .lobby-player__name {\n      font-weight: 500;\n    }\n\n    .lobby-player__joined {\n      font-size: 0.75rem;\n      color: var(--text-muted);\n    }\n\n    .lobby-player__actions {\n      display: flex;\n      gap: 0.5rem;\n    }\n\n    .lobby-player--ready {\n      border-color: var(--success-color);\n      background: rgba(34, 197, 94, 0.05);\n    }\n\n    .lobby-player--admin {\n      border-color: var(--primary-color);\n      background: rgba(99, 102, 241, 0.05);\n    }\n\n    .lobby-player__avatar--admin {\n      background: rgba(99, 102, 241, 0.2);\n      color: var(--primary-color);\n      border: 2px solid var(--primary-color);\n    }\n\n    .lobby-player--spectator {\n      border-color: var(--warning-color);\n      background: rgba(245, 158, 11, 0.05);\n    }\n\n    .lobby-player__avatar--spectator {\n      background: rgba(245, 158, 11, 0.2);\n      color: var(--warning-color);\n    }\n\n    /* Action Buttons */\n    .select-btn {\n      padding: 0.375rem 0.875rem;\n      font-size: 0.8125rem;\n      font-weight: 500;\n      border: none;\n      border-radius: 0.375rem;\n      background: var(--success-color);\n      color: white;\n      cursor: pointer;\n      transition: opacity 0.2s;\n    }\n\n    .select-btn:hover {\n      opacity: 0.9;\n    }\n\n    .kick-btn, .ban-btn {\n      padding: 0.375rem 0.75rem;\n      font-size: 0.8125rem;\n      font-weight: 500;\n      border: 1px solid var(--border-color);\n      border-radius: 0.375rem;\n      background: transparent;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .kick-btn {\n      color: var(--warning-color);\n    }\n\n    .kick-btn:hover {\n      background: var(--warning-color);\n      color: white;\n      border-color: var(--warning-color);\n    }\n\n    .ban-btn {\n      color: var(--danger-color);\n    }\n\n    .ban-btn:hover {\n      background: var(--danger-color);\n      color: white;\n      border-color: var(--danger-color);\n    }\n\n    .lobby-empty {\n      text-align: center;\n      padding: 2rem 1rem;\n      color: var(--text-muted);\n      background: var(--card-bg);\n      border-radius: 0.5rem;\n    }\n\n    .lobby-empty__icon {\n      font-size: 2rem;\n      margin-bottom: 0.5rem;\n    }\n\n    /* Badges */\n    .admin-badge {\n      display: inline-flex;\n      align-items: center;\n      gap: 0.25rem;\n      font-size: 0.6875rem;\n      padding: 0.125rem 0.5rem;\n      border-radius: 9999px;\n      background: rgba(99, 102, 241, 0.15);\n      color: var(--primary-color);\n      font-weight: 600;\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n    }\n\n    .ready-badge {\n      display: inline-block;\n      padding: 0.125rem 0.5rem;\n      background: var(--success-color);\n      color: white;\n      font-size: 0.7rem;\n      font-weight: 600;\n      border-radius: 1rem;\n      margin-left: 0.5rem;\n    }\n\n    .waiting-badge {\n      display: inline-block;\n      padding: 0.125rem 0.5rem;\n      background: var(--text-muted);\n      color: white;\n      font-size: 0.7rem;\n      font-weight: 500;\n      border-radius: 1rem;\n      margin-left: 0.5rem;\n    }\n\n    .spectator-badge {\n      display: inline-block;\n      padding: 0.125rem 0.5rem;\n      background: rgba(245, 158, 11, 0.15);\n      color: var(--warning-color);\n      font-size: 0.7rem;\n      font-weight: 600;\n      border-radius: 1rem;\n      margin-left: 0.5rem;\n    }\n\n    /* ============================================\n       BANNED PLAYERS SECTION\n       ============================================ */\n    .banned-players-section {\n      margin-top: 1.5rem;\n      padding-top: 1.5rem;\n      border-top: 1px solid var(--border-color);\n    }\n\n    .banned-players-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 0.75rem;\n    }\n\n    .banned-players-title {\n      font-size: 0.875rem;\n      font-weight: 600;\n      color: var(--danger-color);\n      margin: 0;\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    .banned-players-count {\n      font-size: 0.75rem;\n      color: var(--text-muted);\n    }\n\n    .banned-players-list {\n      display: flex;\n      flex-direction: column;\n      gap: 0.5rem;\n    }\n\n    .banned-player {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 0.625rem 0.875rem;\n      background: rgba(239, 68, 68, 0.08);\n      border: 1px solid rgba(239, 68, 68, 0.2);\n      border-radius: 0.375rem;\n    }\n\n    .banned-player__info {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    .banned-player__avatar {\n      width: 32px;\n      height: 32px;\n      border-radius: 50%;\n      background: rgba(239, 68, 68, 0.15);\n      color: var(--danger-color);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: 600;\n      font-size: 0.875rem;\n    }\n\n    .banned-player__name {\n      font-size: 0.875rem;\n      font-weight: 500;\n    }\n\n    .unban-btn {\n      padding: 0.25rem 0.625rem;\n      font-size: 0.75rem;\n      font-weight: 500;\n      border: 1px solid var(--success-color);\n      border-radius: 0.25rem;\n      background: transparent;\n      color: var(--success-color);\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .unban-btn:hover {\n      background: var(--success-color);\n      color: white;\n    }\n\n    /* ============================================\n       WAITING FOR ADMIN STYLES\n       ============================================ */\n    .waiting-for-admin {\n      text-align: center;\n      padding: 2rem 1rem;\n      background: var(--card-bg);\n      border-radius: 0.75rem;\n      margin-bottom: 1.5rem;\n    }\n\n    .waiting-for-admin__icon {\n      font-size: 2.5rem;\n      margin-bottom: 0.75rem;\n    }\n\n    .waiting-for-admin__title {\n      font-size: 1.125rem;\n      font-weight: 600;\n      margin-bottom: 0.5rem;\n    }\n\n    .waiting-for-admin__message {\n      color: var(--text-muted);\n    }\n\n    .waiting-players-list {\n      margin-top: 1.5rem;\n      display: flex;\n      flex-direction: column;\n      gap: 0.5rem;\n      max-width: 300px;\n      margin-left: auto;\n      margin-right: auto;\n    }\n\n    .waiting-player {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 0.5rem 0.75rem;\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 0.5rem;\n      font-size: 0.875rem;\n    }\n\n    .waiting-player--ready {\n      background: rgba(34, 197, 94, 0.1);\n    }\n\n    .waiting-player--admin {\n      background: rgba(99, 102, 241, 0.1);\n      border-left: 3px solid var(--primary-color);\n    }\n\n    .waiting-player__name {\n      font-weight: 500;\n    }\n\n    .waiting-player__status {\n      font-size: 0.75rem;\n    }\n\n    .waiting-player__status--ready {\n      color: var(--success-color);\n      font-weight: 600;\n    }\n\n    .waiting-player__status--waiting {\n      color: var(--text-muted);\n    }\n\n    /* ============================================\n       NOT IN ROOM STYLES\n       ============================================ */\n    .not-in-room {\n      text-align: center;\n      padding: 3rem 1rem;\n      background: var(--card-bg);\n      border-radius: 1rem;\n      border: 1px solid var(--border-color);\n    }\n\n    .not-in-room__icon {\n      font-size: 3rem;\n      margin-bottom: 1rem;\n    }\n\n    .not-in-room__title {\n      font-size: 1.25rem;\n      font-weight: 600;\n      margin-bottom: 0.5rem;\n      color: var(--text-color);\n    }\n\n    .not-in-room__text {\n      color: var(--text-muted);\n      margin-bottom: 1.5rem;\n    }\n\n    .not-in-room__actions {\n      display: flex;\n      justify-content: center;\n      gap: 1rem;\n    }\n\n    .not-in-room__hint {\n      font-size: 0.875rem;\n      color: var(--text-muted);\n      margin-top: 1rem;\n    }\n\n    .not-in-room__spectator-option {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 0.25rem;\n      margin-bottom: 1.5rem;\n      padding: 1rem;\n      background: rgba(99, 102, 241, 0.1);\n      border-radius: 0.5rem;\n      border: 1px solid var(--primary-color);\n    }\n\n    /* ============================================\n       WAITING MESSAGE STYLES\n       ============================================ */\n    .waiting-message {\n      text-align: center;\n      padding: 3rem 1rem;\n    }\n\n    .waiting-message__icon {\n      font-size: 1.25rem;\n      margin-bottom: 0.5rem;\n    }\n\n    /* ============================================\n       SPECTATOR BANNER & PANEL STYLES\n       ============================================ */\n    .spectator-banner {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 0.75rem;\n      padding: 0.75rem 1rem;\n      background: rgba(245, 158, 11, 0.15);\n      border: 1px solid var(--warning-color);\n      border-radius: 0.5rem;\n      margin-bottom: 1rem;\n    }\n\n    .spectator-banner__icon {\n      font-size: 1.25rem;\n    }\n\n    .spectator-banner__text {\n      font-size: 0.875rem;\n      font-weight: 500;\n      color: var(--warning-color);\n    }\n\n    .spectator-banner__action {\n      padding: 0.375rem 0.75rem;\n      font-size: 0.8125rem;\n      font-weight: 500;\n      border: 1px solid var(--warning-color);\n      border-radius: 0.375rem;\n      background: transparent;\n      color: var(--warning-color);\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .spectator-banner__action:hover {\n      background: var(--warning-color);\n      color: white;\n    }\n\n    .spectators-panel {\n      background: var(--card-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 0.5rem;\n      padding: 0.75rem;\n      margin-bottom: 1rem;\n    }\n\n    .spectators-panel__header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 0.5rem;\n    }\n\n    .spectators-panel__title {\n      font-size: 0.875rem;\n      font-weight: 600;\n      color: var(--text-muted);\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n    }\n\n    .spectators-panel__count {\n      padding: 0.125rem 0.5rem;\n      background: rgba(245, 158, 11, 0.15);\n      color: var(--warning-color);\n      border-radius: 9999px;\n      font-size: 0.75rem;\n      font-weight: 600;\n    }\n\n    .spectators-list {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 0.5rem;\n    }\n\n    .spectators-empty {\n      font-size: 0.8125rem;\n      color: var(--text-muted);\n    }\n\n    .spectator-item {\n      display: flex;\n      align-items: center;\n      gap: 0.375rem;\n      padding: 0.25rem 0.5rem;\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 0.375rem;\n      font-size: 0.8125rem;\n    }\n\n    .spectator-item--me {\n      background: rgba(99, 102, 241, 0.15);\n      border: 1px solid var(--primary-color);\n    }\n\n    .spectator-item__avatar {\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      background: var(--border-color);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 0.625rem;\n      font-weight: 600;\n    }\n\n    .spectator-item__name {\n      font-weight: 500;\n    }\n\n    /* ============================================\n       MULTI-CHANNEL CHAT PANEL STYLES\n       ============================================ */\n    .chat-panel {\n      background: var(--card-bg);\n      border: 1px solid var(--border-color);\n      border-radius: 0.75rem;\n      margin-top: 1.5rem;\n      overflow: hidden;\n    }\n\n    .chat-panel.collapsed .chat-body {\n      display: none;\n    }\n\n    .chat-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 0.5rem;\n      background: var(--bg-color);\n      border-bottom: 1px solid var(--border-color);\n    }\n\n    .chat-tabs {\n      display: flex;\n      gap: 0.25rem;\n    }\n\n    .chat-tab {\n      display: flex;\n      align-items: center;\n      gap: 0.375rem;\n      padding: 0.375rem 0.75rem;\n      font-size: 0.8125rem;\n      font-weight: 500;\n      border: none;\n      border-radius: 0.375rem;\n      background: transparent;\n      color: var(--text-muted);\n      cursor: pointer;\n      transition: background 0.2s, color 0.2s;\n    }\n\n    .chat-tab:hover {\n      background: var(--border-color);\n      color: var(--text-color);\n    }\n\n    .chat-tab.active {\n      background: var(--primary-color);\n      color: white;\n    }\n\n    .chat-tab.disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .chat-tab__badge {\n      min-width: 1.25rem;\n      padding: 0.125rem 0.375rem;\n      font-size: 0.6875rem;\n      font-weight: 600;\n      border-radius: 9999px;\n      background: var(--danger-color);\n      color: white;\n    }\n\n    .chat-tab.active .chat-tab__badge {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .chat-toggle {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 2rem;\n      height: 2rem;\n      border: none;\n      border-radius: 0.375rem;\n      background: transparent;\n      color: var(--text-muted);\n      cursor: pointer;\n      transition: background 0.2s, color 0.2s;\n    }\n\n    .chat-toggle:hover {\n      background: var(--border-color);\n      color: var(--text-color);\n    }\n\n    .chat-toggle__icon {\n      width: 1.125rem;\n      height: 1.125rem;\n    }\n\n    .chat-body {\n      display: flex;\n      flex-direction: column;\n      height: 250px;\n    }\n\n    .chat-messages {\n      flex: 1;\n      overflow-y: auto;\n      padding: 0.75rem;\n      display: flex;\n      flex-direction: column;\n      gap: 0.5rem;\n    }\n\n    .chat-empty {\n      color: var(--text-muted);\n      font-size: 0.875rem;\n      text-align: center;\n      padding: 2rem;\n    }\n\n    .chat-message {\n      display: flex;\n      gap: 0.5rem;\n      padding: 0.5rem;\n      border-radius: 0.5rem;\n      background: var(--bg-color);\n    }\n\n    .chat-message--system {\n      background: rgba(99, 102, 241, 0.1);\n      justify-content: center;\n      font-size: 0.8125rem;\n      color: var(--text-muted);\n      font-style: italic;\n    }\n\n    .chat-message--muted {\n      opacity: 0.3;\n    }\n\n    .chat-message__avatar {\n      width: 2rem;\n      height: 2rem;\n      border-radius: 50%;\n      background: var(--primary-color);\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 0.75rem;\n      font-weight: 600;\n      flex-shrink: 0;\n    }\n\n    .chat-message__content {\n      flex: 1;\n      min-width: 0;\n    }\n\n    .chat-message__header {\n      display: flex;\n      align-items: center;\n      gap: 0.5rem;\n      margin-bottom: 0.125rem;\n    }\n\n    .chat-message__username {\n      font-size: 0.8125rem;\n      font-weight: 600;\n      color: var(--text-color);\n    }\n\n    .chat-message__time {\n      font-size: 0.6875rem;\n      color: var(--text-muted);\n    }\n\n    .chat-message__text {\n      font-size: 0.875rem;\n      color: var(--text-color);\n      word-wrap: break-word;\n    }\n\n    .chat-message__mute {\n      opacity: 0;\n      padding: 0.25rem;\n      border: none;\n      border-radius: 0.25rem;\n      background: transparent;\n      color: var(--text-muted);\n      cursor: pointer;\n      transition: opacity 0.2s, color 0.2s;\n    }\n\n    .chat-message:hover .chat-message__mute {\n      opacity: 1;\n    }\n\n    .chat-message__mute:hover {\n      color: var(--danger-color);\n    }\n\n    .chat-form {\n      display: flex;\n      gap: 0.5rem;\n      padding: 0.75rem;\n      border-top: 1px solid var(--border-color);\n    }\n\n    .chat-form .chat-input {\n      flex: 1;\n      padding: 0.5rem 0.75rem;\n      font-size: 0.875rem;\n      border: 1px solid var(--border-color);\n      border-radius: 0.375rem;\n      background: var(--bg-color);\n      color: var(--text-color);\n      outline: none;\n      transition: border-color 0.2s;\n    }\n\n    .chat-form .chat-input:focus {\n      border-color: var(--primary-color);\n    }\n\n    .chat-form .chat-input:disabled {\n      background: rgba(0, 0, 0, 0.2);\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n\n    .chat-send {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 2.5rem;\n      height: 2.5rem;\n      border: none;\n      border-radius: 0.375rem;\n      background: var(--primary-color);\n      color: white;\n      cursor: pointer;\n      transition: opacity 0.2s;\n    }\n\n    .chat-send:hover {\n      opacity: 0.9;\n    }\n\n    .chat-send:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .chat-send svg {\n      width: 1rem;\n      height: 1rem;\n    }\n\n    .chat-input--disabled {\n      opacity: 0.7;\n    }\n\n    .chat-input--disabled .chat-input {\n      background: rgba(0, 0, 0, 0.2);\n      cursor: not-allowed;\n    }\n\n    .chat-input--disabled .chat-send {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    /* ============================================\n       GAME FOOTER STYLES\n       ============================================ */\n    .game-footer {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding-top: 1rem;\n      border-top: 1px solid var(--border-color);\n      margin-top: 1rem;\n    }\n\n    .game-info {\n      font-size: 0.875rem;\n      color: var(--text-muted);\n    }\n\n    /* ============================================\n       LEGACY WAITING ROOM (hidden by default)\n       ============================================ */\n    .legacy-waiting-room {\n      display: none;\n    }\n  </style>\n\n  <div class=\"game-container\">\n    <header class=\"game-header\">\n      <div class=\"game-title\">\n        <span id=\"headerTitle\">Tic Tac Toe</span>\n        <span class=\"game-status game-status--waiting\" id=\"gameStatus\">Waiting</span>\n      </div>\n      <div class=\"connection-indicator\">\n        <span class=\"connection-dot\" id=\"connectionDot\"></span>\n        <span id=\"connectionText\">Disconnected</span>\n      </div>\n    </header>\n\n    <!-- Lobby Section -->\n    <section id=\"lobbySection\" class=\"lobby-section\">\n      <div class=\"lobby-controls\">\n        <h2 class=\"lobby-title\">Available Rooms</h2>\n        <button class=\"create-room-btn\" id=\"createRoomBtn\">\n          <span>+</span> Create Room\n        </button>\n      </div>\n\n      <div id=\"loadingState\" class=\"loading-state\">\n        <div class=\"spinner\"></div>\n        <p>Loading rooms...</p>\n      </div>\n\n      <div id=\"emptyState\" class=\"empty-state hidden\">\n        <div class=\"empty-state__icon\">üéÆ</div>\n        <h3 class=\"empty-state__title\">No Active Rooms</h3>\n        <p class=\"empty-state__message\">Create a new room to start playing!</p>\n        <button class=\"create-room-btn\" id=\"emptyCreateBtn\">Create Room</button>\n      </div>\n\n      <div id=\"roomsGrid\" class=\"rooms-grid hidden\"></div>\n    </section>\n\n    <!-- Game Section (contains all room-related views like BiggerDice) -->\n    <section id=\"gameSection\" class=\"game-section\">\n      <!-- Waiting state for non-admin players in lobby -->\n      <div id=\"waitingForAdmin\" class=\"waiting-for-admin hidden\">\n        <div class=\"waiting-for-admin__icon\">‚è≥</div>\n        <div class=\"waiting-for-admin__title\">Waiting in Lobby</div>\n        <p class=\"waiting-for-admin__message\">The room admin will select players. Please wait...</p>\n        <div id=\"waitingPlayersList\" class=\"waiting-players-list\"></div>\n      </div>\n\n      <!-- Admin lobby view - shows waiting players with select/kick/ban actions -->\n      <div id=\"adminLobby\" class=\"admin-lobby hidden\">\n        <div class=\"admin-lobby__header\">\n          <h3 class=\"admin-lobby__title\">Players in Lobby</h3>\n          <span class=\"admin-lobby__count\" id=\"lobbyCount\">0 waiting</span>\n        </div>\n        <div id=\"lobbyPlayersList\" class=\"lobby-players\">\n          <div class=\"lobby-empty\">\n            <div class=\"lobby-empty__icon\">üë•</div>\n            <p>No players waiting. Share the room link to invite players!</p>\n          </div>\n        </div>\n\n        <!-- Banned players section -->\n        <div id=\"bannedPlayersSection\" class=\"banned-players-section hidden\">\n          <div class=\"banned-players-header\">\n            <h4 class=\"banned-players-title\">üö´ Banned Players</h4>\n            <span class=\"banned-players-count\" id=\"bannedCount\">0 banned</span>\n          </div>\n          <div id=\"bannedPlayersList\" class=\"banned-players-list\"></div>\n        </div>\n      </div>\n\n      <!-- Simple waiting state (when selected, waiting for opponent) -->\n      <div id=\"waitingState\" class=\"waiting-message hidden\">\n        <div class=\"waiting-message__icon\">Waiting for opponent...</div>\n        <p>Share the room link to invite a friend!</p>\n      </div>\n\n      <!-- Not-in-room state (when user visits room URL but isn't a member) -->\n      <div id=\"notInRoomState\" class=\"not-in-room hidden\">\n        <div class=\"not-in-room__icon\">üö™</div>\n        <h3 class=\"not-in-room__title\">You are not in this room</h3>\n        <p class=\"not-in-room__text\">This room already has players. You can request to join the game.</p>\n        <div id=\"spectatorOptionContainer\" class=\"not-in-room__spectator-option hidden\">\n          <label class=\"form-checkbox\">\n            <input type=\"checkbox\" id=\"joinAsSpectatorCheckbox\">\n            <span class=\"form-checkbox__label\">Join as Spectator</span>\n          </label>\n          <span class=\"form-hint\">Watch the game without participating</span>\n        </div>\n        <div class=\"not-in-room__actions\">\n          <button id=\"enterRoomBtn\" class=\"game-btn game-btn--primary\">\n            <span id=\"enterRoomBtnText\">Enter Room</span>\n          </button>\n        </div>\n        <p class=\"not-in-room__hint\" id=\"notInRoomHint\"></p>\n      </div>\n\n      <!-- Game Board (contains actual game + spectator elements + chat) -->\n      <div id=\"gameBoard\" class=\"hidden\">\n        <!-- Spectator Mode Banner (shown when user is a spectator) -->\n        <div id=\"spectatorBanner\" class=\"spectator-banner hidden\">\n          <span class=\"spectator-banner__icon\">üëÅ</span>\n          <span class=\"spectator-banner__text\">You are watching as a spectator</span>\n          <button id=\"requestToPlayBtn\" class=\"spectator-banner__action hidden\">Request to Play</button>\n        </div>\n\n        <!-- Spectators Panel (shows who's watching) -->\n        <div id=\"spectatorsPanel\" class=\"spectators-panel hidden\">\n          <div class=\"spectators-panel__header\">\n            <span class=\"spectators-panel__title\">\n              üëÅ Watching\n              <span class=\"spectators-panel__count\" id=\"spectatorsCount\">0</span>\n            </span>\n          </div>\n          <div class=\"spectators-list\" id=\"spectatorsList\">\n            <span class=\"spectators-empty\">No spectators</span>\n          </div>\n        </div>\n\n        <div class=\"match-info\">\n          <div class=\"player-score player-score--player1\">\n            <span class=\"player-score__name\">Player 1</span>\n            <span class=\"player-score__mark player-score__mark--x\">X</span>\n            <span class=\"player-score__value\">0</span>\n          </div>\n          <div class=\"vs-divider\">VS</div>\n          <div class=\"player-score player-score--player2\">\n            <span class=\"player-score__name\">Player 2</span>\n            <span class=\"player-score__mark player-score__mark--o\">O</span>\n            <span class=\"player-score__value\">0</span>\n          </div>\n        </div>\n\n        <div class=\"game-number\">Game 1 of 9</div>\n\n        <div id=\"turnIndicator\" class=\"turn-indicator hidden\">\n          <span class=\"turn-indicator__text\">Waiting...</span>\n        </div>\n\n        <div class=\"turn-timer hidden\" id=\"turnTimer\">\n          <span class=\"turn-timer__icon\">‚è±Ô∏è</span>\n          <div class=\"turn-timer__content\">\n            <span class=\"turn-timer__label\">Time remaining</span>\n            <div class=\"turn-timer__bar\">\n              <div class=\"turn-timer__progress\" id=\"turnTimerProgress\"></div>\n            </div>\n          </div>\n          <span class=\"turn-timer__text\" id=\"turnTimerText\">60</span>\n        </div>\n\n        <div class=\"board-container\">\n          <div class=\"board\">\n            <div class=\"cell\" data-position=\"0\"></div>\n            <div class=\"cell\" data-position=\"1\"></div>\n            <div class=\"cell\" data-position=\"2\"></div>\n            <div class=\"cell\" data-position=\"3\"></div>\n            <div class=\"cell\" data-position=\"4\"></div>\n            <div class=\"cell\" data-position=\"5\"></div>\n            <div class=\"cell\" data-position=\"6\"></div>\n            <div class=\"cell\" data-position=\"7\"></div>\n            <div class=\"cell\" data-position=\"8\"></div>\n          </div>\n        </div>\n\n        <div class=\"action-buttons\" id=\"actionButtons\">\n          <button class=\"ready-btn hidden\" id=\"readyBtn\">Ready!</button>\n        </div>\n\n        <div class=\"paused-overlay hidden\">\n          <div class=\"paused-content\">\n            <div class=\"paused-title\">Game Paused</div>\n            <div class=\"paused-message\">Waiting for opponent to reconnect...</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Multi-Channel Chat Panel (outside gameBoard so visible in all room states) -->\n      <div id=\"chatPanel\" class=\"chat-panel\">\n        <div class=\"chat-header\">\n          <div class=\"chat-tabs\">\n            <button class=\"chat-tab active\" data-channel=\"lobby\" id=\"chatTabLobby\">\n              <span class=\"chat-tab__label\">Lobby</span>\n              <span class=\"chat-tab__badge hidden\" id=\"lobbyBadge\">0</span>\n            </button>\n            <button class=\"chat-tab\" data-channel=\"spectators\" id=\"chatTabSpectators\">\n              <span class=\"chat-tab__label\">Spectators</span>\n              <span class=\"chat-tab__badge hidden\" id=\"spectatorsBadge\">0</span>\n            </button>\n            <button class=\"chat-tab\" data-channel=\"players\" id=\"chatTabPlayers\">\n              <span class=\"chat-tab__label\">Players</span>\n              <span class=\"chat-tab__badge hidden\" id=\"playersBadge\">0</span>\n            </button>\n          </div>\n          <button class=\"chat-toggle\" id=\"chatToggle\" title=\"Toggle chat\">\n            <svg class=\"chat-toggle__icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n            </svg>\n          </button>\n        </div>\n        <div class=\"chat-body\" id=\"chatBody\">\n          <div class=\"chat-messages\" id=\"chatMessages\">\n            <div class=\"chat-empty\">No messages yet. Say hello!</div>\n          </div>\n          <form class=\"chat-form\" id=\"chatForm\">\n            <input type=\"text\" class=\"chat-input\" id=\"chatInput\" placeholder=\"Type a message...\" maxlength=\"500\" autocomplete=\"off\">\n            <button type=\"submit\" class=\"chat-send\" id=\"chatSend\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\n                <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\n              </svg>\n            </button>\n          </form>\n        </div>\n      </div>\n\n      <footer class=\"game-footer\" id=\"gameFooter\">\n        <span class=\"round-info\" id=\"roundInfo\">Best of 9 - First to 5 wins</span>\n        <button class=\"leave-btn\" id=\"leaveBtn\">Leave Game</button>\n      </footer>\n    </section>\n\n    <!-- Game Result Overlay -->\n    <div class=\"game-result\">\n      <div class=\"game-result__content\">\n        <h2 class=\"game-result__title\">Match Complete!</h2>\n        <p class=\"game-result__message\"></p>\n        <p class=\"game-result__prize\"></p>\n        <button class=\"game-result__btn\">Back to Lobby</button>\n      </div>\n    </div>\n\n    <!-- Create Room Modal -->\n    <div id=\"createRoomModal\" class=\"modal-overlay\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">Create Room</h3>\n          <button class=\"modal-close\" id=\"modalCloseBtn\">&times;</button>\n        </div>\n        <form id=\"createRoomForm\">\n          <div class=\"form-group\">\n            <label class=\"form-label\" for=\"roomNameInput\">Room Name</label>\n            <input type=\"text\" class=\"form-input\" id=\"roomNameInput\" placeholder=\"Enter room name...\" maxlength=\"50\" required>\n          </div>\n          <div class=\"form-group\">\n            <label class=\"form-label\" for=\"roomPasswordInput\">Password <span class=\"form-label__optional\">(optional)</span></label>\n            <input type=\"password\" class=\"form-input\" id=\"roomPasswordInput\" placeholder=\"Leave empty for public room\" maxlength=\"50\">\n            <span class=\"form-hint\">Protected rooms require a password to join</span>\n          </div>\n          <div class=\"form-group form-group--checkbox\">\n            <label class=\"form-checkbox\">\n              <input type=\"checkbox\" id=\"allowSpectatorsInput\" checked>\n              <span class=\"form-checkbox__label\">Allow Spectators</span>\n            </label>\n            <span class=\"form-hint\">Let others watch the game without participating</span>\n          </div>\n          <div class=\"modal-actions\">\n            <button type=\"button\" class=\"btn-secondary\" id=\"modalCancelBtn\">Cancel</button>\n            <button type=\"submit\" class=\"btn-primary\" id=\"modalCreateBtn\">Create</button>\n          </div>\n        </form>\n      </div>\n    </div>\n\n    <!-- Join Password Modal -->\n    <div id=\"joinPasswordModal\" class=\"modal-overlay\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">Enter Room Password</h3>\n          <button class=\"modal-close\" id=\"joinPasswordCloseBtn\">&times;</button>\n        </div>\n        <form id=\"joinPasswordForm\">\n          <div class=\"form-group\">\n            <label class=\"form-label\" for=\"joinPasswordInput\">Password</label>\n            <input type=\"password\" class=\"form-input\" id=\"joinPasswordInput\" placeholder=\"Enter room password...\" required>\n            <p class=\"form-error hidden\" id=\"joinPasswordError\">Incorrect password</p>\n          </div>\n          <div class=\"modal-actions\">\n            <button type=\"button\" class=\"btn-secondary\" id=\"joinPasswordCancelBtn\">Cancel</button>\n            <button type=\"submit\" class=\"btn-primary\">Join Room</button>\n          </div>\n        </form>\n      </div>\n    </div>\n\n    <!-- Create Room Confirmation Modal -->\n    <div id=\"createConfirmModal\" class=\"modal-overlay\">\n      <div class=\"modal-content modal-content--small\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">Create Game Room</h3>\n          <button class=\"modal-close\" id=\"createConfirmCloseBtn\">&times;</button>\n        </div>\n        <div class=\"modal-body\">\n          <div class=\"confirm-loader\" id=\"createConfirmLoader\">\n            <div class=\"loader-spinner\"></div>\n            <p class=\"loader-text\">Checking balance...</p>\n          </div>\n          <p class=\"confirm-message hidden\" id=\"createConfirmMessage\"></p>\n        </div>\n        <div class=\"modal-actions\">\n          <button type=\"button\" class=\"btn-secondary\" id=\"createConfirmCancelBtn\">Cancel</button>\n          <button type=\"button\" class=\"btn-primary hidden\" id=\"createConfirmBtn\">Create Room</button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Join Room Confirmation Modal -->\n    <div id=\"joinConfirmModal\" class=\"modal-overlay\">\n      <div class=\"modal-content modal-content--small\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">Join Game Room</h3>\n          <button class=\"modal-close\" id=\"joinConfirmCloseBtn\">&times;</button>\n        </div>\n        <div class=\"modal-body\">\n          <div class=\"confirm-loader\" id=\"joinConfirmLoader\">\n            <div class=\"loader-spinner\"></div>\n            <p class=\"loader-text\">Checking balance...</p>\n          </div>\n          <p class=\"confirm-message hidden\" id=\"joinConfirmMessage\"></p>\n        </div>\n        <div class=\"modal-actions\">\n          <button type=\"button\" class=\"btn-secondary\" id=\"joinConfirmCancelBtn\">Cancel</button>\n          <button type=\"button\" class=\"btn-primary hidden\" id=\"joinConfirmBtn\">Join Room</button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Toast Container -->\n    <div class=\"toast-container\" id=\"toastContainer\"></div>\n  </div>\n`;\n\nexport class TicTacToe extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({ mode: 'open' });\n        this.shadowRoot.appendChild(template.content.cloneNode(true));\n\n        // State\n        this.ws = null;\n        this.wsUrl = '';\n        this.userId = '';\n        this.username = '';\n        this.avatarId = '';\n        this.roomId = '';\n        this.roomName = '';\n        this.mode = 'lobby';\n        this.wsConnected = false;\n        this.isSpectator = false;\n\n        // Game state\n        this.board = Array(9).fill(null);\n        this.playerXId = null;\n        this.playerOId = null;\n        this.currentTurn = null;\n        this.scores = {};\n        this.gameNumber = 1;\n        this.moveDeadline = null;\n        this.isGamePaused = false;\n        this.winningLine = null;\n\n        // Timer\n        this.timerInterval = null;\n        this.timeRemaining = TURN_TIMER_SECONDS;\n\n        // Rooms list\n        this.rooms = [];\n\n        // Players in waiting room\n        this.players = [];\n        this.selectedPlayers = [];\n        this.isReady = false;\n        this.isHost = false;\n\n        // Room to join\n        this.roomToJoin = null;\n\n        // Lobby state (BiggerDice parity)\n        this.lobby = [];              // Players waiting in lobby\n        this.bannedPlayers = [];      // Banned players list\n        this.spectators = [];         // Spectators watching\n        this.hostId = null;           // Room admin user ID\n        this.isAdmin = false;         // Is current user admin\n        this.notInRoomInfo = null;    // Room info when not a member\n        this.wantsToSpectate = false; // Join as spectator flag\n        this.maxPlayers = 2;          // TicTacToe is always 2 players\n        this.allowSpectators = true;  // Whether spectators can join\n\n        // Multi-channel chat state (replaces simple chatMessages array)\n        this.chatChannel = 'lobby';\n        this.chatMessages = {\n            lobby: [],\n            players: [],\n            spectators: []\n        };\n        this.chatHistoryRequested = {\n            lobby: false,\n            players: false,\n            spectators: false\n        };\n        this.chatUnreadCounts = {\n            lobby: 0,\n            players: 0,\n            spectators: 0\n        };\n        this.mutedUsers = new Set();\n        this.isChatCollapsed = false;\n        this.isPlayer = false;        // Whether current user is a player\n\n        // Element references\n        this.els = {};\n\n        this._bindElements();\n        this._bindEvents();\n    }\n\n    connectedCallback() {\n        this.wsUrl = this.dataset.wsUrl || '';\n        this.userId = this.dataset.userId || '';\n        this.username = this.dataset.username || '';\n        this.avatarId = this.dataset.avatarId || '';\n        this.roomId = this.dataset.roomId || '';\n        this.roomName = this.dataset.roomName || '';\n        this.mode = this.dataset.mode || 'lobby';\n\n        this._connect();\n    }\n\n    disconnectedCallback() {\n        this._disconnect();\n    }\n\n    _bindElements() {\n        const s = this.shadowRoot;\n        this.els = {\n            // Header elements\n            headerTitle: s.querySelector('#headerTitle'),\n            gameStatus: s.querySelector('#gameStatus'),\n            connectionDot: s.querySelector('#connectionDot'),\n            connectionText: s.querySelector('#connectionText'),\n            // Main sections\n            lobbySection: s.querySelector('#lobbySection'),\n            gameSection: s.querySelector('#gameSection'),\n            gameBoard: s.querySelector('#gameBoard'),\n            roomsGrid: s.querySelector('#roomsGrid'),\n            loadingState: s.querySelector('#loadingState'),\n            emptyState: s.querySelector('#emptyState'),\n            createRoomBtn: s.querySelector('#createRoomBtn'),\n            emptyCreateBtn: s.querySelector('#emptyCreateBtn'),\n            createRoomBtns: s.querySelectorAll('.create-room-btn'),\n            // Create Room Modal\n            createRoomModal: s.querySelector('#createRoomModal'),\n            createRoomForm: s.querySelector('#createRoomForm'),\n            roomNameInput: s.querySelector('#roomNameInput'),\n            roomPasswordInput: s.querySelector('#roomPasswordInput'),\n            allowSpectatorsInput: s.querySelector('#allowSpectatorsInput'),\n            modalCloseBtn: s.querySelector('#modalCloseBtn'),\n            modalCancelBtn: s.querySelector('#modalCancelBtn'),\n            // Join Password Modal\n            joinPasswordModal: s.querySelector('#joinPasswordModal'),\n            joinPasswordForm: s.querySelector('#joinPasswordForm'),\n            joinPasswordInput: s.querySelector('#joinPasswordInput'),\n            joinPasswordError: s.querySelector('#joinPasswordError'),\n            joinPasswordCloseBtn: s.querySelector('#joinPasswordCloseBtn'),\n            joinPasswordCancelBtn: s.querySelector('#joinPasswordCancelBtn'),\n            // Create confirmation modal\n            createConfirmModal: s.querySelector('#createConfirmModal'),\n            createConfirmLoader: s.querySelector('#createConfirmLoader'),\n            createConfirmMessage: s.querySelector('#createConfirmMessage'),\n            createConfirmCloseBtn: s.querySelector('#createConfirmCloseBtn'),\n            createConfirmCancelBtn: s.querySelector('#createConfirmCancelBtn'),\n            createConfirmBtn: s.querySelector('#createConfirmBtn'),\n            // Join confirmation modal\n            joinConfirmModal: s.querySelector('#joinConfirmModal'),\n            joinConfirmLoader: s.querySelector('#joinConfirmLoader'),\n            joinConfirmMessage: s.querySelector('#joinConfirmMessage'),\n            joinConfirmCloseBtn: s.querySelector('#joinConfirmCloseBtn'),\n            joinConfirmCancelBtn: s.querySelector('#joinConfirmCancelBtn'),\n            joinConfirmBtn: s.querySelector('#joinConfirmBtn'),\n            // Action buttons\n            actionButtons: s.querySelector('#actionButtons'),\n            readyBtn: s.querySelector('#readyBtn'),\n            // Admin Lobby\n            waitingForAdmin: s.querySelector('#waitingForAdmin'),\n            waitingPlayersList: s.querySelector('#waitingPlayersList'),\n            adminLobby: s.querySelector('#adminLobby'),\n            lobbyCount: s.querySelector('#lobbyCount'),\n            lobbyPlayersList: s.querySelector('#lobbyPlayersList'),\n            bannedPlayersSection: s.querySelector('#bannedPlayersSection'),\n            bannedCount: s.querySelector('#bannedCount'),\n            bannedPlayersList: s.querySelector('#bannedPlayersList'),\n            waitingState: s.querySelector('#waitingState'),\n            // Not-in-room state\n            notInRoomState: s.querySelector('#notInRoomState'),\n            enterRoomBtn: s.querySelector('#enterRoomBtn'),\n            enterRoomBtnText: s.querySelector('#enterRoomBtnText'),\n            notInRoomHint: s.querySelector('#notInRoomHint'),\n            spectatorOptionContainer: s.querySelector('#spectatorOptionContainer'),\n            joinAsSpectatorCheckbox: s.querySelector('#joinAsSpectatorCheckbox'),\n            // Spectator elements\n            spectatorBanner: s.querySelector('#spectatorBanner'),\n            requestToPlayBtn: s.querySelector('#requestToPlayBtn'),\n            spectatorsPanel: s.querySelector('#spectatorsPanel'),\n            spectatorsCount: s.querySelector('#spectatorsCount'),\n            spectatorsList: s.querySelector('#spectatorsList'),\n            // Game footer\n            gameFooter: s.querySelector('#gameFooter'),\n            roundInfo: s.querySelector('#roundInfo'),\n            leaveBtn: s.querySelector('#leaveBtn'),\n            // Game board elements\n            board: s.querySelector('.board'),\n            cells: s.querySelectorAll('.cell'),\n            player1Score: s.querySelector('.player-score--player1'),\n            player2Score: s.querySelector('.player-score--player2'),\n            gameNumber: s.querySelector('.game-number'),\n            turnIndicator: s.querySelector('#turnIndicator'),\n            turnIndicatorText: s.querySelector('.turn-indicator__text'),\n            turnTimer: s.querySelector('#turnTimer'),\n            turnTimerProgress: s.querySelector('#turnTimerProgress'),\n            turnTimerText: s.querySelector('#turnTimerText'),\n            pausedOverlay: s.querySelector('.paused-overlay'),\n            // Game result\n            gameResult: s.querySelector('.game-result'),\n            gameResultTitle: s.querySelector('.game-result__title'),\n            gameResultMessage: s.querySelector('.game-result__message'),\n            gameResultPrize: s.querySelector('.game-result__prize'),\n            gameResultBtn: s.querySelector('.game-result__btn'),\n            // Multi-channel Chat\n            chatPanel: s.querySelector('#chatPanel'),\n            chatTabLobby: s.querySelector('#chatTabLobby'),\n            chatTabPlayers: s.querySelector('#chatTabPlayers'),\n            chatTabSpectators: s.querySelector('#chatTabSpectators'),\n            lobbyBadge: s.querySelector('#lobbyBadge'),\n            playersBadge: s.querySelector('#playersBadge'),\n            spectatorsBadge: s.querySelector('#spectatorsBadge'),\n            chatToggle: s.querySelector('#chatToggle'),\n            chatBody: s.querySelector('#chatBody'),\n            chatMessages: s.querySelector('#chatMessages'),\n            chatForm: s.querySelector('#chatForm'),\n            chatInput: s.querySelector('#chatInput'),\n            chatSend: s.querySelector('#chatSend'),\n            // Legacy chat (for backwards compatibility)\n            chatSendBtn: s.querySelector('.chat-send-btn'),\n            // Toast\n            toastContainer: s.querySelector('#toastContainer'),\n        };\n    }\n\n    _bindEvents() {\n        // Create room modal - bind all create room buttons\n        this.els.createRoomBtns.forEach(btn => {\n            btn.addEventListener('click', () => this._showCreateRoomModal());\n        });\n        this.els.modalCloseBtn.addEventListener('click', () => this._hideCreateRoomModal());\n        this.els.modalCancelBtn.addEventListener('click', () => this._hideCreateRoomModal());\n        this.els.createRoomForm.addEventListener('submit', (e) => {\n            e.preventDefault();\n            this._createRoom();\n        });\n\n        // Join password modal\n        this.els.joinPasswordCloseBtn.addEventListener('click', () => this._hideJoinRoomModal());\n        this.els.joinPasswordCancelBtn.addEventListener('click', () => this._hideJoinRoomModal());\n        this.els.joinPasswordForm.addEventListener('submit', (e) => {\n            e.preventDefault();\n            this._confirmJoinRoom();\n        });\n\n        // Close modals when clicking overlay\n        this.els.createRoomModal.addEventListener('click', (e) => {\n            if (e.target === this.els.createRoomModal) this._hideCreateRoomModal();\n        });\n        this.els.joinPasswordModal.addEventListener('click', (e) => {\n            if (e.target === this.els.joinPasswordModal) this._hideJoinRoomModal();\n        });\n\n        // Create confirmation modal\n        this.els.createConfirmCloseBtn.addEventListener('click', () => this._hideCreateConfirmModal());\n        this.els.createConfirmCancelBtn.addEventListener('click', () => this._hideCreateConfirmModal());\n        this.els.createConfirmBtn.addEventListener('click', () => {\n            this._hideCreateConfirmModal();\n            this._executeCreateRoom();\n        });\n        this.els.createConfirmModal.addEventListener('click', (e) => {\n            if (e.target === this.els.createConfirmModal) this._hideCreateConfirmModal();\n        });\n\n        // Join confirmation modal\n        this.els.joinConfirmCloseBtn.addEventListener('click', () => this._hideJoinConfirmModal());\n        this.els.joinConfirmCancelBtn.addEventListener('click', () => this._hideJoinConfirmModal());\n        this.els.joinConfirmBtn.addEventListener('click', () => {\n            this._hideJoinConfirmModal();\n            this._executeJoinRoom();\n        });\n        this.els.joinConfirmModal.addEventListener('click', (e) => {\n            if (e.target === this.els.joinConfirmModal) this._hideJoinConfirmModal();\n        });\n\n        // Waiting room\n        this.els.readyBtn.addEventListener('click', () => this._toggleReady());\n        this.els.leaveBtn.addEventListener('click', () => this._leaveRoom());\n\n        // Board clicks\n        this.els.cells.forEach(cell => {\n            cell.addEventListener('click', () => this._handleCellClick(cell));\n        });\n\n        // Game result\n        this.els.gameResultBtn.addEventListener('click', () => this._backToLobby());\n\n        // Multi-channel Chat\n        if (this.els.chatTabLobby) {\n            this.els.chatTabLobby.addEventListener('click', () => this._switchChatChannel('lobby'));\n        }\n        if (this.els.chatTabPlayers) {\n            this.els.chatTabPlayers.addEventListener('click', () => this._switchChatChannel('players'));\n        }\n        if (this.els.chatTabSpectators) {\n            this.els.chatTabSpectators.addEventListener('click', () => this._switchChatChannel('spectators'));\n        }\n        if (this.els.chatToggle) {\n            this.els.chatToggle.addEventListener('click', () => this._toggleChat());\n        }\n        if (this.els.chatForm) {\n            this.els.chatForm.addEventListener('submit', (e) => {\n                e.preventDefault();\n                this._sendChatMessage();\n            });\n        }\n        if (this.els.chatSend) {\n            this.els.chatSend.addEventListener('click', () => this._sendChatMessage());\n        }\n        if (this.els.chatInput) {\n            this.els.chatInput.addEventListener('keypress', (e) => {\n                if (e.key === 'Enter') this._sendChatMessage();\n            });\n        }\n\n        // Enter Room button (for not-in-room state)\n        if (this.els.enterRoomBtn) {\n            this.els.enterRoomBtn.addEventListener('click', () => this._handleEnterRoomClick());\n        }\n\n        // Join as Spectator checkbox (for not-in-room state)\n        if (this.els.joinAsSpectatorCheckbox) {\n            this.els.joinAsSpectatorCheckbox.addEventListener('change', (e) => {\n                this.wantsToSpectate = e.target.checked;\n                this._updateEnterRoomButton();\n            });\n        }\n\n        // Spectator \"Request to Play\" button\n        if (this.els.requestToPlayBtn) {\n            this.els.requestToPlayBtn.addEventListener('click', () => this._requestToPlay());\n        }\n\n        // Game footer leave button\n        if (this.els.leaveBtn) {\n            this.els.leaveBtn.addEventListener('click', () => this._leaveRoom());\n        }\n    }\n\n    _connect() {\n        if (!this.wsUrl) return;\n\n        this._updateConnectionStatus('connecting');\n        this.ws = new WebSocket(this.wsUrl);\n\n        this.ws.onopen = () => {\n            console.log('[TicTacToe] WebSocket connected');\n            this._updateConnectionStatus('connected');\n            this._authenticate();\n        };\n\n        this.ws.onmessage = (event) => {\n            try {\n                const msg = JSON.parse(event.data);\n                this._handleMessage(msg);\n            } catch (e) {\n                console.error('[TicTacToe] Failed to parse message:', e);\n            }\n        };\n\n        this.ws.onclose = () => {\n            console.log('[TicTacToe] WebSocket closed');\n            this._updateConnectionStatus('disconnected');\n            setTimeout(() => this._connect(), 3000);\n        };\n\n        this.ws.onerror = (err) => {\n            console.error('[TicTacToe] WebSocket error:', err);\n        };\n    }\n\n    _disconnect() {\n        if (this.ws) {\n            this.ws.close();\n            this.ws = null;\n        }\n        this._stopTimer();\n    }\n\n    _send(msg) {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            this.ws.send(JSON.stringify(msg));\n        }\n    }\n\n    _authenticate() {\n        this._send({\n            type: 'system.authenticate',\n            user_id: this.userId,\n            username: this.username,\n            avatar_id: this.avatarId || null,\n        });\n    }\n\n    _updateConnectionStatus(status) {\n        this.wsConnected = status === 'connected';\n        if (this.els.connectionDot) {\n            this.els.connectionDot.className = 'connection-dot';\n            if (status === 'connected') {\n                this.els.connectionDot.classList.add('connection-dot--connected');\n            } else if (status === 'connecting') {\n                this.els.connectionDot.classList.add('connection-dot--connecting');\n            }\n        }\n        if (this.els.connectionText) {\n            if (status === 'connected') {\n                this.els.connectionText.textContent = 'Connected';\n            } else if (status === 'connecting') {\n                this.els.connectionText.textContent = 'Connecting...';\n            } else {\n                this.els.connectionText.textContent = 'Disconnected';\n            }\n        }\n    }\n\n    _updateGameStatus(status) {\n        if (!this.els.gameStatus) return;\n\n        this.els.gameStatus.className = 'game-status';\n        switch (status) {\n            case 'waiting':\n                this.els.gameStatus.classList.add('game-status--waiting');\n                this.els.gameStatus.textContent = 'Waiting';\n                break;\n            case 'playing':\n                this.els.gameStatus.classList.add('game-status--playing');\n                this.els.gameStatus.textContent = 'Playing';\n                break;\n            case 'finished':\n                this.els.gameStatus.classList.add('game-status--finished');\n                this.els.gameStatus.textContent = 'Finished';\n                break;\n            default:\n                this.els.gameStatus.classList.add('game-status--waiting');\n                this.els.gameStatus.textContent = 'Waiting';\n        }\n    }\n\n    _updateHeaderTitle(title) {\n        if (this.els.headerTitle) {\n            this.els.headerTitle.textContent = title || 'Tic Tac Toe';\n        }\n    }\n\n    _handleMessage(msg) {\n        console.log('[TicTacToe] Message:', msg.type, msg);\n\n        switch (msg.type) {\n            case 'system.authenticated':\n                this._onAuthenticated(msg);\n                break;\n            case 'games.event.room_list':\n                this._onRoomList(msg);\n                break;\n            case 'games.event.room_created':\n                this._onRoomCreated(msg);\n                break;\n            case 'games.event.room_removed':\n                this._onRoomRemoved(msg);\n                break;\n            case 'games.event.room_state':\n                this._onRoomState(msg);\n                break;\n            case 'games.event.player_selected':\n            case 'games.event.lobby_joined':\n            case 'games.event.player_ready_changed':\n            case 'games.event.selected_players_updated':\n                this._onWaitingRoomUpdate(msg);\n                break;\n            case 'games.event.game_started':\n                this._onGameStarted(msg);\n                break;\n            case 'games.event.turn_changed':\n                this._onTurnChanged(msg);\n                break;\n            case 'games.event.tic_tac_toe.moved':\n                this._onMoveMade(msg);\n                break;\n            case 'games.event.tic_tac_toe.game_result':\n                this._onGameResult(msg);\n                break;\n            case 'games.event.tic_tac_toe.match_ended':\n                this._onMatchEnded(msg);\n                break;\n            case 'games.event.tic_tac_toe.state':\n                this._onStateSync(msg);\n                break;\n            case 'games.event.tic_tac_toe.turn_timeout':\n                this._onTurnTimeout(msg);\n                break;\n            case 'games.event.tic_tac_toe.game_paused':\n                this._onGamePaused(msg);\n                break;\n            case 'games.event.tic_tac_toe.game_resumed':\n                this._onGameResumed(msg);\n                break;\n            case 'games.event.chat_message':\n                this._handleChatMessage(msg);\n                break;\n            case 'games.event.chat_history':\n                this._handleChatHistory(msg);\n                break;\n            case 'games.event.player_left':\n                this._onPlayerLeft(msg);\n                break;\n            // Admin/Lobby events\n            case 'games.event.lobby_updated':\n                this._onLobbyUpdated(msg);\n                break;\n            case 'games.event.player_kicked':\n                this._onPlayerKicked(msg);\n                break;\n            case 'games.event.player_banned':\n                this._onPlayerBanned(msg);\n                break;\n            case 'games.event.player_unbanned':\n                this._onPlayerUnbanned(msg);\n                break;\n            case 'games.event.not_in_room':\n                this._onNotInRoom(msg);\n                break;\n            // Spectator events\n            case 'games.event.spectator_joined':\n                this._onSpectatorJoined(msg);\n                break;\n            case 'games.event.spectator_left':\n                this._onSpectatorLeft(msg);\n                break;\n            case 'games.event.request_to_play_accepted':\n                this._onRequestToPlayAccepted(msg);\n                break;\n            case 'system.error':\n                this._onError(msg);\n                break;\n        }\n    }\n\n    _onAuthenticated(msg) {\n        console.log('[TicTacToe] Authenticated as', msg.username);\n\n        if (this.mode === 'lobby') {\n            this._showLobby();\n            this._listRooms();\n        } else if (this.roomId) {\n            // Join/rejoin the room - roomId from URL is the UUID\n            this._send({\n                type: 'games.command.rejoin_room',\n                room_id: this.roomId,\n            });\n        }\n    }\n\n    _listRooms() {\n        this._send({\n            type: 'games.command.list_rooms',\n            game_type: 'tic_tac_toe',\n        });\n    }\n\n    _onRoomList(msg) {\n        console.log('[TicTacToe] Rooms list received:', msg.rooms);\n        this.rooms = msg.rooms || [];\n        this._renderRooms();\n    }\n\n    _escapeHtml(str) {\n        if (!str) return '';\n        return String(str)\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n\n    _formatStatus(status) {\n        if (status === 'waiting') return 'Waiting';\n        if (status === 'in_progress') return 'In Progress';\n        return status;\n    }\n\n    _renderRooms() {\n        // Filter for tic_tac_toe rooms, excluding rooms we're already in\n        const ticTacToeRooms = this.rooms.filter(r => {\n            if (r.game_type !== 'tic_tac_toe') return false;\n            // Don't show rooms we're currently in\n            if (this.roomId && r.room_id === this.roomId) return false;\n            return true;\n        });\n\n        // Hide loading state\n        this.els.loadingState.classList.add('hidden');\n\n        if (ticTacToeRooms.length === 0) {\n            this.els.roomsGrid.classList.add('hidden');\n            this.els.emptyState.classList.remove('hidden');\n            return;\n        }\n\n        this.els.emptyState.classList.add('hidden');\n        this.els.roomsGrid.classList.remove('hidden');\n\n        this.els.roomsGrid.innerHTML = ticTacToeRooms.map(room => {\n            const currentPlayers = room.players?.length || 0;\n            const maxPlayers = room.player_count || room.max_players || 2;\n            const spectatorCount = room.spectator_count || 0;\n            const allowSpectators = room.allow_spectators === true;\n            const isFull = currentPlayers >= maxPlayers;\n            const canRejoin = room.can_rejoin === true;\n\n            return `\n            <div class=\"room-card\" data-room-id=\"${room.room_id}\">\n                <div class=\"room-card__header\">\n                    <span class=\"room-card__name\">\n                        ${this._escapeHtml(room.room_name)}\n                        ${room.is_password_protected ? `\n                            <span class=\"room-card__lock\" title=\"Password protected\">\n                                <svg class=\"room-card__lock-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                                    <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect>\n                                    <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\n                                </svg>\n                            </span>\n                        ` : ''}\n                    </span>\n                    <span class=\"room-card__status room-card__status--${room.status}\">${this._formatStatus(room.status)}</span>\n                </div>\n                <div class=\"room-card__info\">\n                    <span class=\"room-card__info-item\" title=\"Players\">\n                        <svg class=\"room-card__info-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                            <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path>\n                            <circle cx=\"9\" cy=\"7\" r=\"4\"></circle>\n                            <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"></path>\n                            <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path>\n                        </svg>\n                        ${currentPlayers}/${maxPlayers}\n                    </span>\n                    ${allowSpectators ? `\n                        <span class=\"room-card__info-item\" title=\"Spectators\">\n                            <svg class=\"room-card__info-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                                <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"></path>\n                                <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n                            </svg>\n                            ${spectatorCount}\n                        </span>\n                    ` : `\n                        <span class=\"room-card__no-spectators\" title=\"Spectators not allowed\">No spectators</span>\n                    `}\n                </div>\n                <div class=\"room-card__players\">\n                    ${(room.players || []).map(p => `\n                        <span class=\"player-badge ${p.is_ready ? 'player-badge--ready' : ''}\">${this._escapeHtml(p.username || p.name)}</span>\n                    `).join('')}\n                    ${currentPlayers < maxPlayers ? '<span class=\"player-badge\">Waiting...</span>' : ''}\n                </div>\n                <div class=\"room-card__actions\">\n                    ${canRejoin ? `\n                        <button class=\"join-btn\" data-action=\"rejoin\" data-room-id=\"${room.room_id}\" data-room-name=\"${this._escapeHtml(room.room_name)}\" data-protected=\"${room.is_password_protected || false}\">Rejoin</button>\n                    ` : ''}\n                    ${!canRejoin && room.status === 'waiting' && !isFull ? `\n                        <button class=\"join-btn\" data-action=\"join\" data-room-id=\"${room.room_id}\" data-room-name=\"${this._escapeHtml(room.room_name)}\" data-protected=\"${room.is_password_protected || false}\">Join Game</button>\n                    ` : ''}\n                    ${!canRejoin && allowSpectators ? `\n                        <button class=\"spectate-btn\" data-action=\"spectate\" data-room-id=\"${room.room_id}\">\n                            ${room.status === 'waiting' ? 'Spectate' : 'Watch'}\n                        </button>\n                    ` : ''}\n                </div>\n            </div>\n        `}).join('');\n\n        // Bind room card action events\n        this.els.roomsGrid.querySelectorAll('[data-action]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                e.stopPropagation();\n                const roomId = e.target.dataset.roomId;\n                const roomName = e.target.dataset.roomName;\n                const action = e.target.dataset.action;\n                const isProtected = e.target.dataset.protected === 'true';\n\n                if (action === 'rejoin') {\n                    // Rejoin uses room_id directly, no balance check needed (already paid)\n                    this._rejoinRoom(roomId);\n                } else if (action === 'join') {\n                    if (isProtected) {\n                        this.roomToJoin = { roomId, roomName };\n                        this._showJoinRoomModal();\n                    } else {\n                        this._joinRoomByName(roomName);\n                    }\n                } else if (action === 'spectate') {\n                    this._spectateRoom(roomId);\n                }\n            });\n        });\n    }\n\n    _rejoinRoom(roomId) {\n        // Rejoin doesn't need balance check - user already paid\n        this._send({\n            type: 'games.command.rejoin_room',\n            room_id: roomId,\n        });\n    }\n\n    _joinRoomByName(roomName) {\n        // Check if we're already in this room\n        if (this.roomName === roomName && this.roomId) {\n            console.log('[TicTacToe] Already in this room, requesting room state instead');\n            this._send({\n                type: 'games.command.get_room_state',\n                room_name: roomName,\n            });\n            return;\n        }\n\n        // Store room data for confirmation\n        this._pendingJoinData = {\n            roomName: roomName,\n            password: null,\n        };\n        this._showJoinConfirmModal();\n    }\n\n    _spectateRoom(roomId) {\n        // Spectators can join for free - no balance check needed\n        this._send({\n            type: 'games.command.spectate',\n            room_id: roomId,\n        });\n    }\n\n    _showLobby() {\n        this.mode = 'lobby';\n        this.els.lobbySection.classList.add('active');\n        this.els.gameSection.classList.remove('active');\n        // Hide all game section sub-views\n        this._hideAllGameSubViews();\n        // Reset header\n        this._updateHeaderTitle('Tic Tac Toe');\n        this._updateGameStatus('waiting');\n        // Reset room state\n        this.roomId = null;\n        this.roomName = null;\n        this.isHost = false;\n        this.isAdmin = false;\n        this.hostId = null;\n        this.lobby = [];\n        this.players = [];\n        this.spectators = [];\n        this.bannedPlayers = [];\n        this.notInRoomInfo = null;\n        this.wantsToSpectate = false;\n    }\n\n    _showWaitingRoom() {\n        this.mode = 'room';\n        this.els.lobbySection.classList.remove('active');\n        this.els.gameSection.classList.add('active');\n        // Hide all sub-views first, then show appropriate one via _updateGameUI\n        this._hideAllGameSubViews();\n    }\n\n    _showGame() {\n        this.mode = 'game';\n        this.els.lobbySection.classList.remove('active');\n        this.els.gameSection.classList.add('active');\n        // Show game board, hide other sub-views\n        this._hideAllGameSubViews();\n        this.els.gameBoard.classList.remove('hidden');\n    }\n\n    _hideAllGameSubViews() {\n        // Hide all sub-views within gameSection\n        if (this.els.waitingForAdmin) this.els.waitingForAdmin.classList.add('hidden');\n        if (this.els.adminLobby) this.els.adminLobby.classList.add('hidden');\n        if (this.els.waitingState) this.els.waitingState.classList.add('hidden');\n        if (this.els.notInRoomState) this.els.notInRoomState.classList.add('hidden');\n        if (this.els.gameBoard) this.els.gameBoard.classList.add('hidden');\n    }\n\n    _showCreateRoomModal() {\n        this.els.createRoomModal.classList.add('active');\n        this.els.roomNameInput.value = '';\n        this.els.roomPasswordInput.value = '';\n        this.els.allowSpectatorsInput.checked = true;\n        this.els.roomNameInput.focus();\n    }\n\n    _hideCreateRoomModal() {\n        this.els.createRoomModal.classList.remove('active');\n    }\n\n    _createRoom() {\n        const roomName = this.els.roomNameInput.value.trim();\n        if (!roomName) {\n            this.els.roomNameInput.focus();\n            return;\n        }\n\n        // Store room data for later use\n        this._pendingRoomData = {\n            roomName: roomName,\n            password: this.els.roomPasswordInput.value || null,\n            allowSpectators: this.els.allowSpectatorsInput.checked,\n        };\n\n        // Hide create room modal and show confirmation\n        this._hideCreateRoomModal();\n        this._showCreateConfirmModal();\n    }\n\n    async _showCreateConfirmModal() {\n        console.log('[TicTacToe] showCreateConfirmModal called');\n\n        // Show modal with loader\n        this.els.createConfirmModal.classList.add('active');\n\n        // Show loader, hide message and button\n        this.els.createConfirmLoader.classList.remove('hidden');\n        this.els.createConfirmMessage.classList.add('hidden');\n        this.els.createConfirmBtn.classList.add('hidden');\n\n        try {\n            // Fetch user balance from API\n            const response = await fetch('/api/v1/user', {\n                method: 'GET',\n                credentials: 'include',\n                headers: { 'Content-Type': 'application/json' },\n            });\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch user data');\n            }\n\n            const data = await response.json();\n            const balance = data.user?.balance ?? 0;\n            const hasEnoughBalance = balance >= 1000;\n\n            console.log('[TicTacToe] User balance:', balance, 'Has enough:', hasEnoughBalance);\n\n            // Hide loader\n            this.els.createConfirmLoader.classList.add('hidden');\n\n            // Show message\n            if (hasEnoughBalance) {\n                this.els.createConfirmMessage.textContent = 'Creating this game will cost 1000 coins. Are you sure you want to proceed?';\n                this.els.createConfirmMessage.classList.remove('confirm-message--error');\n                this.els.createConfirmBtn.classList.remove('hidden');\n            } else {\n                this.els.createConfirmMessage.textContent = 'You do not have enough balance to create a game. You need at least 1000 coins.';\n                this.els.createConfirmMessage.classList.add('confirm-message--error');\n                this.els.createConfirmBtn.classList.add('hidden');\n            }\n            this.els.createConfirmMessage.classList.remove('hidden');\n\n        } catch (error) {\n            console.error('[TicTacToe] Error fetching balance:', error);\n\n            // Hide loader\n            this.els.createConfirmLoader.classList.add('hidden');\n\n            // Show error message\n            this.els.createConfirmMessage.textContent = 'Failed to check balance. Please try again.';\n            this.els.createConfirmMessage.classList.add('confirm-message--error');\n            this.els.createConfirmMessage.classList.remove('hidden');\n            this.els.createConfirmBtn.classList.add('hidden');\n        }\n    }\n\n    _hideCreateConfirmModal() {\n        console.log('[TicTacToe] hideCreateConfirmModal called');\n        this.els.createConfirmModal.classList.remove('active');\n    }\n\n    _executeCreateRoom() {\n        if (!this._pendingRoomData) return;\n\n        const { roomName, password, allowSpectators } = this._pendingRoomData;\n\n        this._send({\n            type: 'games.command.create_room',\n            game_type: 'tic_tac_toe',\n            room_name: roomName,\n            password: password,\n            max_players: 2,\n            allow_spectators: allowSpectators,\n        });\n\n        this._pendingRoomData = null;\n    }\n\n    _onRoomCreated(msg) {\n        console.log('[TicTacToe] Room created:', msg);\n\n        // Normalize to strings for comparison\n        const hostIdStr = String(msg.host_id);\n        const userIdStr = String(this.userId);\n\n        // If we created the room, navigate to it\n        if (hostIdStr === userIdStr) {\n            console.log('[TicTacToe] We are the host, entering room');\n            this.roomId = msg.room_id;\n            this.roomName = msg.room_name;\n            this.isHost = true;\n            this.isAdmin = true;\n            this.hostId = msg.host_id;\n            this.allowSpectators = msg.allow_spectators === true;\n            this.maxPlayers = msg.player_count || msg.max_players || 2;\n\n            // Initialize lobby with ourselves as the only player\n            this.lobby = [{\n                user_id: this.userId,\n                username: this.username,\n                is_ready: false,\n            }];\n            this.players = [];\n            this.spectators = [];\n            this.bannedPlayers = [];\n\n            // Update header and status\n            this._updateHeaderTitle(msg.room_name || `Room ${msg.room_id}`);\n            this._updateGameStatus('waiting');\n\n            // Show waiting room and render admin lobby\n            this._showWaitingRoom();\n            this._updateGameUI();\n        } else {\n            // Add the new room directly to the list for instant update (for other players)\n            console.log('[TicTacToe] Not the host, adding room to lobby list');\n            const newRoom = {\n                room_id: msg.room_id,\n                room_name: msg.room_name,\n                game_type: msg.game_type || 'tic_tac_toe',\n                host_name: msg.host_name || msg.host_username || 'Unknown',\n                status: 'waiting',\n                players: [{ user_id: msg.host_id, username: msg.host_username }],\n                player_count: msg.player_count || 2,\n                max_players: msg.player_count || msg.max_players || 2,\n                spectator_count: 0,\n                allow_spectators: msg.allow_spectators === true,\n                is_password_protected: msg.is_password_protected || false,\n            };\n\n            // Only add if we're in lobby mode and room doesn't already exist\n            if (this.mode === 'lobby') {\n                const exists = this.rooms.some(r => r.room_id === newRoom.room_id);\n                if (!exists) {\n                    this.rooms.unshift(newRoom); // Add at beginning (newest first)\n                    this._renderRooms();\n                }\n            }\n        }\n    }\n\n    _onRoomRemoved(msg) {\n        console.log('[TicTacToe] Room removed:', msg);\n        const roomId = msg.room_id;\n        const reason = msg.reason || 'unknown';\n\n        // Remove from rooms array\n        const initialLength = this.rooms.length;\n        this.rooms = this.rooms.filter(r => r.room_id !== roomId);\n\n        if (this.rooms.length < initialLength) {\n            console.log(`[TicTacToe] Room ${roomId} removed from list (reason: ${reason})`);\n            // Re-render the room list if we're in lobby mode\n            if (this.mode === 'lobby') {\n                this._renderRooms();\n            }\n        }\n\n        // If we're currently in this room and it's being removed, show message and return to lobby\n        if (this.roomId === roomId && this.mode !== 'lobby') {\n            this._showToast('Room has been closed', 'info');\n            this.mode = 'lobby';\n            this._showLobby();\n            this._listRooms();\n        }\n    }\n\n    _showJoinRoomModal() {\n        this.els.joinPasswordModal.classList.add('active');\n        this.els.joinPasswordInput.value = '';\n        this.els.joinPasswordError.classList.add('hidden');\n        this.els.joinPasswordInput.focus();\n    }\n\n    _hideJoinRoomModal() {\n        this.els.joinPasswordModal.classList.remove('active');\n        this.roomToJoin = null;\n    }\n\n    _confirmJoinRoom() {\n        const password = this.els.joinPasswordInput.value;\n        // Store room data for confirmation (roomToJoin is now { roomId, roomName })\n        this._pendingJoinData = {\n            roomName: this.roomToJoin.roomName,\n            password: password,\n        };\n        this._hideJoinRoomModal();\n        this._showJoinConfirmModal();\n    }\n\n    async _showJoinConfirmModal() {\n        console.log('[TicTacToe] showJoinConfirmModal called');\n\n        // Show modal with loader\n        this.els.joinConfirmModal.classList.add('active');\n\n        // Show loader, hide message and button\n        this.els.joinConfirmLoader.classList.remove('hidden');\n        this.els.joinConfirmMessage.classList.add('hidden');\n        this.els.joinConfirmBtn.classList.add('hidden');\n\n        try {\n            // Fetch user balance from API\n            const response = await fetch('/api/v1/user', {\n                method: 'GET',\n                credentials: 'include',\n                headers: { 'Content-Type': 'application/json' },\n            });\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch user data');\n            }\n\n            const data = await response.json();\n            const balance = data.user?.balance ?? 0;\n            const hasEnoughBalance = balance >= 1000;\n\n            console.log('[TicTacToe] User balance:', balance, 'Has enough:', hasEnoughBalance);\n\n            // Hide loader\n            this.els.joinConfirmLoader.classList.add('hidden');\n\n            // Show message\n            if (hasEnoughBalance) {\n                this.els.joinConfirmMessage.textContent = 'Joining this game will cost 1000 coins. Are you sure you want to proceed?';\n                this.els.joinConfirmMessage.classList.remove('confirm-message--error');\n                this.els.joinConfirmBtn.classList.remove('hidden');\n            } else {\n                this.els.joinConfirmMessage.textContent = 'You do not have enough balance to join this game. You need at least 1000 coins.';\n                this.els.joinConfirmMessage.classList.add('confirm-message--error');\n                this.els.joinConfirmBtn.classList.add('hidden');\n            }\n            this.els.joinConfirmMessage.classList.remove('hidden');\n\n        } catch (error) {\n            console.error('[TicTacToe] Error fetching balance:', error);\n\n            // Hide loader\n            this.els.joinConfirmLoader.classList.add('hidden');\n\n            // Show error message\n            this.els.joinConfirmMessage.textContent = 'Failed to check balance. Please try again.';\n            this.els.joinConfirmMessage.classList.add('confirm-message--error');\n            this.els.joinConfirmMessage.classList.remove('hidden');\n            this.els.joinConfirmBtn.classList.add('hidden');\n        }\n    }\n\n    _hideJoinConfirmModal() {\n        console.log('[TicTacToe] hideJoinConfirmModal called');\n        this.els.joinConfirmModal.classList.remove('active');\n    }\n\n    _executeJoinRoom() {\n        if (!this._pendingJoinData) return;\n\n        const { roomName, password, isPasswordProtected, asSpectator } = this._pendingJoinData;\n\n        // Check if we're already in this room\n        if (this.roomName === roomName && this.roomId) {\n            console.log('[TicTacToe] Already in this room, requesting room state instead');\n            this._send({\n                type: 'games.command.get_room_state',\n                room_name: roomName,\n            });\n            this._pendingJoinData = null;\n            return;\n        }\n\n        // If password protected and no password yet, show password modal\n        if (isPasswordProtected && !password) {\n            this.roomToJoin = { roomId: null, roomName: roomName };\n            this._showJoinRoomModal();\n            return;\n        }\n\n        // Send appropriate command based on spectator mode\n        if (asSpectator) {\n            this._send({\n                type: 'games.command.join_as_spectator',\n                room_name: roomName,\n                password: password,\n            });\n        } else {\n            this._send({\n                type: 'games.command.join_room',\n                room_name: roomName,\n                password: password,\n            });\n        }\n\n        this._pendingJoinData = null;\n    }\n\n    _joinRoom(roomName, password = null) {\n        // Check if we're already in this room\n        if (this.roomName === roomName && this.roomId) {\n            console.log('[TicTacToe] Already in this room, requesting room state instead');\n            this._send({\n                type: 'games.command.get_room_state',\n                room_name: roomName,\n            });\n            return;\n        }\n\n        this._send({\n            type: 'games.command.join_room',\n            room_name: roomName,\n            password: password,\n        });\n    }\n\n    _onRoomState(msg) {\n        const room = msg.room;\n        console.log('[TicTacToe] Room state received:', room);\n\n        // Clear \"not in room\" state since we're receiving room state\n        this.notInRoomInfo = null;\n        if (this.els.notInRoomState) {\n            this.els.notInRoomState.classList.add('hidden');\n        }\n\n        this.roomId = room.room_id;\n        this.roomName = room.room_name;\n        this.hostId = room.host_id;\n        this.isHost = room.host_id == this.userId;\n        this.isAdmin = this.isHost;\n        this.maxPlayers = room.player_count || room.max_players || 2;\n        this.allowSpectators = room.allow_spectators === true;\n\n        // Initialize lobby and players\n        this.lobby = room.lobby || [];\n        this.players = room.players || [];\n        this.selectedPlayers = room.selected_players || [];\n\n        // Initialize banned players from room state\n        if (room.banned_users && Array.isArray(room.banned_users)) {\n            this.bannedPlayers = room.banned_users.map(banned => {\n                if (typeof banned === 'object' && banned !== null) {\n                    return {\n                        user_id: banned.user_id,\n                        username: banned.username || `User #${banned.user_id}`\n                    };\n                }\n                return {\n                    user_id: banned,\n                    username: `User #${banned}`\n                };\n            });\n        } else {\n            this.bannedPlayers = [];\n        }\n\n        // Initialize spectators from room state\n        this.spectators = room.spectators_data || room.spectators || [];\n\n        // Determine if current user is a player or spectator\n        const userIdStr = String(this.userId);\n        const inPlayers = this.players.some(p => String(p.id || p.user_id) === userIdStr);\n        const inLobby = this.lobby.some(p => String(p.user_id) === userIdStr);\n        this.isPlayer = inPlayers || inLobby;\n        this.isSpectator = this.spectators.some(s => {\n            if (typeof s === 'object' && s !== null) {\n                return String(s.user_id || s.id) === userIdStr;\n            }\n            return String(s) === userIdStr;\n        });\n\n        console.log('[TicTacToe] Role check:', {\n            userId: this.userId,\n            isAdmin: this.isAdmin,\n            isPlayer: this.isPlayer,\n            isSpectator: this.isSpectator,\n            lobbyCount: this.lobby.length,\n            playersCount: this.players.length,\n            spectatorsCount: this.spectators.length\n        });\n\n        // Update chat tab access based on role\n        this._updateChatTabAccess();\n\n        // Update spectator UI\n        this._updateSpectatorUI();\n\n        // Request chat history for the lobby channel on initial room join\n        if (!this.chatHistoryRequested.lobby && this.chatMessages.lobby.length === 0) {\n            this.chatHistoryRequested.lobby = true;\n            this._requestChatHistory('lobby');\n        }\n\n        // Update header with room name and status\n        this._updateHeaderTitle(room.room_name || `Room ${room.room_id}`);\n\n        if (room.status === 'waiting') {\n            this._updateGameStatus('waiting');\n            this._updateGameUI();\n            this._showWaitingRoom();\n        } else if (room.status === 'in_progress') {\n            this._updateGameStatus('playing');\n            this._showGame();\n        }\n    }\n\n    _onWaitingRoomUpdate(msg) {\n        // Update local state based on message\n        if (msg.type === 'games.event.player_ready_changed') {\n            const player = this.lobby.find(p => p.user_id == msg.user_id);\n            if (player) {\n                player.is_ready = msg.is_ready;\n            }\n        }\n\n        this._updateGameUI();\n    }\n\n    _updateGameUI() {\n        // Decide which view to show based on admin status\n        if (this.isAdmin) {\n            // Admin sees the lobby management interface\n            this._renderAdminLobby();\n            if (this.els.adminLobby) {\n                this.els.adminLobby.classList.remove('hidden');\n            }\n            if (this.els.waitingForAdmin) {\n                this.els.waitingForAdmin.classList.add('hidden');\n            }\n        } else {\n            // Non-admin sees the \"waiting for admin\" view\n            this._renderWaitingPlayersList();\n            if (this.els.waitingForAdmin) {\n                this.els.waitingForAdmin.classList.remove('hidden');\n            }\n            if (this.els.adminLobby) {\n                this.els.adminLobby.classList.add('hidden');\n            }\n        }\n\n        // Update ready button state for legacy waiting room\n        const myPlayer = this.lobby.find(p => p.user_id == this.userId);\n        this.isReady = myPlayer?.is_ready || false;\n        if (this.els.readyBtn) {\n            this.els.readyBtn.textContent = this.isReady ? 'Not Ready' : 'Ready';\n        }\n    }\n\n    _renderAdminLobby() {\n        const lobbyList = this.els.lobbyPlayersList;\n        const countEl = this.els.lobbyCount;\n        if (!lobbyList) return;\n\n        // Update count\n        if (countEl) {\n            countEl.textContent = `${this.lobby.length} waiting`;\n        }\n\n        // If lobby is empty, show empty state\n        if (this.lobby.length === 0) {\n            lobbyList.innerHTML = `\n                <div class=\"lobby-empty\">\n                    <div class=\"lobby-empty__icon\">üë•</div>\n                    <p>No players waiting. Share the room link to invite players!</p>\n                </div>\n            `;\n        } else {\n            // Render players with select/kick/ban buttons\n            lobbyList.innerHTML = this.lobby.map(player => {\n                const isMe = String(player.user_id) === String(this.userId);\n                const isHost = String(player.user_id) === String(this.hostId);\n                const isSpectator = this.spectators.some(s =>\n                    String(s.user_id || s) === String(player.user_id)\n                );\n                const isReady = player.is_ready;\n                const initial = (player.username || 'U').charAt(0).toUpperCase();\n\n                let statusClass = '';\n                let avatarClass = 'lobby-player__avatar';\n                if (isHost) {\n                    statusClass = 'lobby-player--admin';\n                    avatarClass += ' lobby-player__avatar--admin';\n                } else if (isSpectator) {\n                    statusClass = 'lobby-player--spectator';\n                    avatarClass += ' lobby-player__avatar--spectator';\n                } else if (isReady) {\n                    statusClass = 'lobby-player--ready';\n                }\n\n                // Build badges (matching BiggerDice pattern)\n                let badges = '';\n                if (isHost) {\n                    badges += '<span class=\"admin-badge\">üëë Admin</span> ';\n                }\n                if (isReady) {\n                    badges += '<span class=\"ready-badge\">‚úì Ready</span>';\n                } else {\n                    badges += '<span class=\"waiting-badge\">Waiting...</span>';\n                }\n                if (isSpectator) {\n                    badges += ' <span class=\"spectator-badge\">üëÅ Spectator</span>';\n                }\n\n                // Build subtitle text\n                let subtitle = '';\n                if (isHost) {\n                    subtitle = 'Room host - select players to start';\n                } else if (isReady) {\n                    subtitle = 'Player is ready to start';\n                } else {\n                    subtitle = 'Waiting for admin selection';\n                }\n\n                // Action buttons - different for admin vs other players\n                let actionsHtml = '';\n                if (isMe && isHost) {\n                    // Admin's own entry - can select self or become spectator\n                    actionsHtml = `\n                        <button class=\"select-btn\" data-action=\"select\" data-user-id=\"${player.user_id}\">Select Myself</button>\n                        ${this.allowSpectators ? `<button class=\"kick-btn\" data-action=\"become-spectator\" data-user-id=\"${player.user_id}\">Become Spectator</button>` : ''}\n                    `;\n                } else if (!isMe) {\n                    // Other players - standard actions\n                    actionsHtml = `\n                        <button class=\"select-btn\" data-action=\"select\" data-user-id=\"${player.user_id}\">Select</button>\n                        <button class=\"kick-btn\" data-action=\"kick\" data-user-id=\"${player.user_id}\">Kick</button>\n                        <button class=\"ban-btn\" data-action=\"ban\" data-user-id=\"${player.user_id}\">Ban</button>\n                    `;\n                }\n\n                return `\n                    <div class=\"lobby-player ${statusClass}\" data-user-id=\"${player.user_id}\">\n                        <div class=\"lobby-player__info\">\n                            <div class=\"${avatarClass}\">${initial}</div>\n                            <div>\n                                <div class=\"lobby-player__name\">\n                                    ${this._escapeHtml(player.username)}${isMe ? ' (you)' : ''}\n                                    ${badges}\n                                </div>\n                                <div class=\"lobby-player__joined\">${subtitle}</div>\n                            </div>\n                        </div>\n                        <div class=\"lobby-player__actions\">\n                            ${actionsHtml}\n                        </div>\n                    </div>\n                `;\n            }).join('');\n\n            // Bind action buttons\n            this._bindAdminLobbyActions();\n        }\n\n        // Render banned players section\n        this._renderBannedPlayersList();\n    }\n\n    _renderWaitingPlayersList() {\n        const listEl = this.els.waitingPlayersList;\n        if (!listEl) return;\n\n        listEl.innerHTML = this.lobby.map(player => {\n            const isMe = String(player.user_id) === String(this.userId);\n            const isAdmin = String(player.user_id) === String(this.hostId);\n\n            let statusClass = '';\n            let statusText = '';\n            if (isAdmin) {\n                statusClass = 'waiting-player--admin';\n                statusText = '<span class=\"waiting-player__status\">Admin</span>';\n            } else if (player.is_ready) {\n                statusClass = 'waiting-player--ready';\n                statusText = '<span class=\"waiting-player__status waiting-player__status--ready\">Ready</span>';\n            } else {\n                statusText = '<span class=\"waiting-player__status waiting-player__status--waiting\">Waiting</span>';\n            }\n\n            return `\n                <div class=\"waiting-player ${statusClass}\">\n                    <span class=\"waiting-player__name\">${this._escapeHtml(player.username)}${isMe ? ' (you)' : ''}</span>\n                    ${statusText}\n                </div>\n            `;\n        }).join('');\n    }\n\n    _renderBannedPlayersList() {\n        const section = this.els.bannedPlayersSection;\n        const listEl = this.els.bannedPlayersList;\n        const countEl = this.els.bannedCount;\n        if (!section || !listEl) return;\n\n        if (this.bannedPlayers.length === 0) {\n            section.classList.add('hidden');\n            return;\n        }\n\n        section.classList.remove('hidden');\n\n        if (countEl) {\n            countEl.textContent = `${this.bannedPlayers.length} banned`;\n        }\n\n        listEl.innerHTML = this.bannedPlayers.map(player => {\n            const initial = (player.username || 'U').charAt(0).toUpperCase();\n            return `\n                <div class=\"banned-player\" data-user-id=\"${player.user_id}\">\n                    <div class=\"banned-player__info\">\n                        <div class=\"banned-player__avatar\">${initial}</div>\n                        <span class=\"banned-player__name\">${this._escapeHtml(player.username)}</span>\n                    </div>\n                    <button class=\"unban-btn\" data-user-id=\"${player.user_id}\">Unban</button>\n                </div>\n            `;\n        }).join('');\n\n        // Bind unban buttons\n        listEl.querySelectorAll('.unban-btn').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const userId = parseInt(e.target.dataset.userId, 10);\n                this._unbanPlayer(userId);\n            });\n        });\n    }\n\n    _bindAdminLobbyActions() {\n        const lobbyList = this.els.lobbyPlayersList;\n        if (!lobbyList) return;\n\n        // Handle all action buttons using data-action attribute (BiggerDice pattern)\n        lobbyList.querySelectorAll('button[data-action]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const action = e.target.dataset.action;\n                const userId = parseInt(e.target.dataset.userId, 10);\n\n                if (action === 'select') {\n                    this._selectPlayer(userId);\n                } else if (action === 'kick') {\n                    this._kickPlayer(userId);\n                } else if (action === 'ban') {\n                    this._banPlayer(userId);\n                } else if (action === 'become-spectator') {\n                    this._becomeSpectator();\n                }\n            });\n        });\n    }\n\n    // ============================================\n    // Admin Action Methods\n    // ============================================\n\n    _selectPlayer(userId) {\n        console.log('[TicTacToe] Selecting player:', userId);\n        this._send({\n            type: 'games.command.select_player',\n            room_id: this.roomId,\n            user_id: userId,\n        });\n    }\n\n    _kickPlayer(userId) {\n        console.log('[TicTacToe] Kicking player:', userId);\n        this._send({\n            type: 'games.command.kick_player',\n            room_id: this.roomId,\n            user_id: userId,\n        });\n    }\n\n    _banPlayer(userId) {\n        console.log('[TicTacToe] Banning player:', userId);\n        this._send({\n            type: 'games.command.ban_player',\n            room_id: this.roomId,\n            user_id: userId,\n        });\n    }\n\n    _unbanPlayer(userId) {\n        console.log('[TicTacToe] Unbanning player:', userId);\n        this._send({\n            type: 'games.command.unban_player',\n            room_id: this.roomId,\n            user_id: userId,\n        });\n    }\n\n    _becomeSpectator() {\n        console.log('[TicTacToe] Admin becoming spectator');\n        this._send({\n            type: 'games.command.become_spectator',\n            room_id: this.roomId,\n        });\n    }\n\n    // ============================================\n    // Admin Event Handlers\n    // ============================================\n\n    _onLobbyUpdated(msg) {\n        console.log('[TicTacToe] Lobby updated:', msg);\n        this.lobby = msg.lobby || [];\n        this._updateGameUI();\n    }\n\n    _onPlayerKicked(msg) {\n        console.log('[TicTacToe] Player kicked:', msg);\n        const kickedUserId = String(msg.user_id);\n\n        // If we were kicked, show a message and go back to lobby\n        if (kickedUserId === String(this.userId)) {\n            this._showToast('You have been kicked from the room', 'error');\n            this.mode = 'lobby';\n            this._showLobby();\n            this._listRooms();\n            return;\n        }\n\n        // Remove from lobby list\n        this.lobby = this.lobby.filter(p => String(p.user_id) !== kickedUserId);\n        this._updateGameUI();\n        this._addSystemMessage(`${msg.username || 'A player'} was kicked from the room`);\n    }\n\n    _onPlayerBanned(msg) {\n        console.log('[TicTacToe] Player banned:', msg);\n        const bannedUserId = String(msg.user_id);\n\n        // If we were banned, show a message and go back to lobby\n        if (bannedUserId === String(this.userId)) {\n            this._showToast('You have been banned from this room', 'error');\n            this.mode = 'lobby';\n            this._showLobby();\n            this._listRooms();\n            return;\n        }\n\n        // Remove from lobby list and add to banned list\n        this.lobby = this.lobby.filter(p => String(p.user_id) !== bannedUserId);\n        this.bannedPlayers.push({\n            user_id: msg.user_id,\n            username: msg.username || `User #${msg.user_id}`\n        });\n        this._updateGameUI();\n        this._addSystemMessage(`${msg.username || 'A player'} was banned from the room`);\n    }\n\n    _onPlayerUnbanned(msg) {\n        console.log('[TicTacToe] Player unbanned:', msg);\n        const unbannedUserId = String(msg.user_id);\n        this.bannedPlayers = this.bannedPlayers.filter(p => String(p.user_id) !== unbannedUserId);\n        this._updateGameUI();\n        this._addSystemMessage(`${msg.username || 'A player'} was unbanned`);\n    }\n\n    _onNotInRoom(msg) {\n        console.log('[TicTacToe] Not in room:', msg);\n\n        // Store the room info for the \"Enter Room\" button\n        this.notInRoomInfo = {\n            room_id: msg.room_id,\n            room_name: msg.room_name,\n            is_password_protected: msg.is_password_protected || false,\n            status: msg.status,\n            allow_spectators: msg.allow_spectators === true,\n            is_banned: msg.is_banned || false,\n            is_full: msg.is_full || false,\n        };\n\n        // Update header with room info\n        this._updateHeaderTitle(msg.room_name || 'Tic Tac Toe');\n        this._updateGameStatus(msg.status || 'waiting');\n\n        // Switch to game section but show not-in-room state\n        this.mode = 'not_in_room';\n        this.els.lobbySection.classList.remove('active');\n        this.els.gameSection.classList.add('active');\n\n        // Hide all sub-views first\n        this._hideAllGameSubViews();\n\n        // Show not-in-room state\n        if (this.els.notInRoomState) {\n            this.els.notInRoomState.classList.remove('hidden');\n\n            // Update text based on room info\n            const titleEl = this.els.notInRoomState.querySelector('.not-in-room__title');\n            const textEl = this.els.notInRoomState.querySelector('.not-in-room__text');\n            const hintEl = this.els.notInRoomHint;\n            const spectatorOption = this.els.spectatorOptionContainer;\n\n            if (titleEl) titleEl.textContent = 'You are not in this room';\n            if (textEl) textEl.textContent = msg.message || 'This room already has players.';\n\n            // Show spectator option if allowed\n            if (spectatorOption) {\n                if (this.notInRoomInfo.allow_spectators) {\n                    spectatorOption.classList.remove('hidden');\n                    // Reset checkbox state\n                    if (this.els.joinAsSpectatorCheckbox) {\n                        this.els.joinAsSpectatorCheckbox.checked = this.wantsToSpectate || false;\n                    }\n                } else {\n                    spectatorOption.classList.add('hidden');\n                    this.wantsToSpectate = false;\n                }\n            }\n\n            if (hintEl) {\n                if (this.notInRoomInfo.is_banned) {\n                    hintEl.textContent = 'You have been banned from this room.';\n                } else {\n                    hintEl.textContent = '';\n                }\n            }\n\n            this._updateEnterRoomButton();\n        }\n    }\n\n    _handleEnterRoomClick() {\n        if (!this.notInRoomInfo) return;\n\n        // Spectators don't need balance check - they can watch for free\n        if (this.wantsToSpectate) {\n            // But they still need password if room is protected\n            if (this.notInRoomInfo.is_password_protected) {\n                // Store data for password modal\n                this.roomToJoin = {\n                    roomId: this.notInRoomInfo.room_id,\n                    roomName: this.notInRoomInfo.room_name,\n                };\n                this._pendingJoinData = {\n                    roomName: this.notInRoomInfo.room_name,\n                    asSpectator: true,\n                };\n                this._showJoinRoomModal();\n            } else {\n                this._send({\n                    type: 'games.command.join_as_spectator',\n                    room_name: this.notInRoomInfo.room_name,\n                });\n            }\n            return;\n        }\n\n        // Players need balance check before joining - show confirmation modal\n        this._pendingJoinData = {\n            roomName: this.notInRoomInfo.room_name,\n            password: null,\n            isPasswordProtected: this.notInRoomInfo.is_password_protected,\n        };\n        this._showJoinConfirmModal();\n    }\n\n    _updateEnterRoomButton() {\n        if (!this.els.enterRoomBtnText || !this.notInRoomInfo) return;\n\n        if (this.wantsToSpectate) {\n            if (this.notInRoomInfo.is_password_protected) {\n                this.els.enterRoomBtnText.textContent = 'Watch as Spectator (Password Required)';\n                if (this.els.notInRoomHint) {\n                    this.els.notInRoomHint.textContent = 'This room is password protected. You will join as a spectator.';\n                }\n            } else {\n                this.els.enterRoomBtnText.textContent = 'Watch as Spectator';\n                if (this.els.notInRoomHint) {\n                    this.els.notInRoomHint.textContent = 'You will join as a spectator and watch the game.';\n                }\n            }\n        } else if (this.notInRoomInfo.is_password_protected) {\n            this.els.enterRoomBtnText.textContent = 'Enter Room (Password Required)';\n            if (this.els.notInRoomHint) {\n                this.els.notInRoomHint.textContent = 'This room is password protected.';\n            }\n        } else {\n            this.els.enterRoomBtnText.textContent = 'Enter Room';\n            if (this.els.notInRoomHint) {\n                this.els.notInRoomHint.textContent = '';\n            }\n        }\n    }\n\n    _toggleReady() {\n        this._send({\n            type: 'games.command.ready',\n            room_id: this.roomId,\n        });\n        // Disable button after clicking (like BiggerDice)\n        this.els.readyBtn.disabled = true;\n    }\n\n    _leaveRoom() {\n        // Store room info before resetting\n        const roomId = this.roomId;\n        const roomName = this.roomName;\n\n        // Send leave command\n        this._send({\n            type: 'games.command.leave_room',\n            room_id: roomId,\n        });\n\n        // Clear notInRoomInfo so we don't have stale data\n        this.notInRoomInfo = null;\n\n        // Reset chat state when leaving\n        this.chatMessages = { lobby: [], players: [], spectators: [] };\n        this.chatUnreadCounts = { lobby: 0, players: 0, spectators: 0 };\n\n        // Switch to lobby\n        this.mode = 'lobby';\n        this._showLobby();\n\n        // Refresh room list after a short delay to ensure server processes leave command\n        // The room we just left should appear in the list if it's still waiting\n        setTimeout(() => {\n            this._listRooms();\n        }, 300);\n\n        // Dispatch event with the room ID we left\n        this.dispatchEvent(new CustomEvent('game-leave', { detail: { roomId, roomName } }));\n    }\n\n    _onGameStarted(msg) {\n        console.log('[TicTacToe] Game started:', msg);\n        this._updateGameStatus('playing');\n        this._showGame();\n        this._resetBoard();\n    }\n\n    _onStateSync(msg) {\n        console.log('[TicTacToe] State sync:', msg);\n\n        // Update board\n        this.board = msg.board || Array(9).fill(null);\n        this.playerXId = msg.player_x_id;\n        this.playerOId = msg.player_o_id;\n        this.currentTurn = msg.current_turn;\n        this.gameNumber = msg.game_number || 1;\n        this.isGamePaused = msg.is_paused || false;\n\n        // Update scores\n        if (msg.scores) {\n            this.scores = {};\n            msg.scores.forEach(([playerId, score]) => {\n                this.scores[playerId] = score;\n            });\n        }\n\n        // Update timer\n        if (msg.move_deadline) {\n            this.moveDeadline = new Date(msg.move_deadline);\n            this._startTimer();\n        }\n\n        this._renderBoard();\n        this._updateMatchInfo();\n        this._updateTurnIndicator();\n\n        if (this.isGamePaused) {\n            this.els.pausedOverlay.classList.add('active');\n        }\n\n        this._showGame();\n    }\n\n    _onTurnChanged(msg) {\n        this.currentTurn = msg.current_turn;\n        this._startTimer();\n        this._updateTurnIndicator();\n    }\n\n    _onMoveMade(msg) {\n        console.log('[TicTacToe] Move made:', msg);\n\n        // Update board\n        this.board = msg.board || this.board;\n        this.board[msg.position] = msg.mark;\n\n        this._renderBoard();\n    }\n\n    _onGameResult(msg) {\n        console.log('[TicTacToe] Game result:', msg);\n\n        // Update scores\n        if (msg.scores) {\n            this.scores = {};\n            msg.scores.forEach(([playerId, score]) => {\n                this.scores[playerId] = score;\n            });\n        }\n\n        // Show winning line\n        if (msg.winning_line) {\n            this.winningLine = msg.winning_line;\n            this._highlightWinningLine();\n        }\n\n        // Update game number\n        this.gameNumber = msg.game_number + 1;\n\n        this._updateMatchInfo();\n\n        // Show result briefly then reset for next game\n        setTimeout(() => {\n            this.winningLine = null;\n            this._resetBoard();\n            this._updateMatchInfo();\n        }, 2000);\n    }\n\n    _onMatchEnded(msg) {\n        console.log('[TicTacToe] Match ended:', msg);\n\n        this._stopTimer();\n\n        const isWinner = msg.winner_id == this.userId;\n\n        this.els.gameResultTitle.textContent = isWinner ? 'You Won!' : 'You Lost';\n        this.els.gameResultTitle.className = 'game-result__title ' + (isWinner ? 'game-result__title--win' : 'game-result__title--lose');\n        this.els.gameResultMessage.textContent = `Final score: ${msg.final_scores.map(([id, name, score]) => `${name}: ${score}`).join(' - ')}`;\n        this.els.gameResultPrize.textContent = isWinner ? `Prize: ${(msg.prize_amount / 100).toFixed(0)} coins` : '';\n\n        this.els.gameResult.classList.add('active');\n    }\n\n    _onTurnTimeout(msg) {\n        console.log('[TicTacToe] Turn timeout:', msg);\n\n        // Update scores\n        if (msg.scores) {\n            this.scores = {};\n            msg.scores.forEach(([playerId, score]) => {\n                this.scores[playerId] = score;\n            });\n        }\n\n        this._updateMatchInfo();\n\n        // Add chat message about timeout\n        this._addSystemMessage(`${msg.player_username} timed out! ${msg.winner_username} wins this game.`);\n\n        // Reset for next game\n        setTimeout(() => {\n            this._resetBoard();\n        }, 2000);\n    }\n\n    _onGamePaused(msg) {\n        console.log('[TicTacToe] Game paused:', msg);\n        this.isGamePaused = true;\n        this.els.pausedOverlay.classList.add('active');\n        this._stopTimer();\n        this._addSystemMessage(`${msg.disconnected_player_username} disconnected. Waiting for reconnection...`);\n    }\n\n    _onGameResumed(msg) {\n        console.log('[TicTacToe] Game resumed:', msg);\n        this.isGamePaused = false;\n        this.els.pausedOverlay.classList.remove('active');\n        this._startTimer();\n        this._addSystemMessage(`${msg.reconnected_player_username} reconnected!`);\n    }\n\n    _onPlayerLeft(msg) {\n        console.log('[TicTacToe] Player left:', msg);\n        // Remove from players list\n        this.players = this.players.filter(p => p.user_id != msg.player_id);\n        this._renderWaitingRoom();\n    }\n\n    // ============================================\n    // Multi-Channel Chat Methods\n    // ============================================\n\n    _switchChatChannel(channel) {\n        // Determine if current user is a playing player\n        const amIAPlayer = this.players.some(p =>\n            String(p.user_id || p.id) === String(this.userId)\n        ) || this.lobby.some(p => String(p.user_id) === String(this.userId));\n\n        console.log('[Chat] switchChatChannel called:', {\n            channel,\n            isPlayer: this.isPlayer,\n            isSpectator: this.isSpectator,\n            amIAPlayer,\n            currentChannel: this.chatChannel\n        });\n\n        // Check if lobby chat is disabled (during game)\n        if (channel === 'lobby' && this._isLobbyChatDisabled()) {\n            console.log('[Chat] Lobby chat is disabled during game');\n            return;\n        }\n\n        // Check if user can access players channel\n        if (channel === 'players' && !this.isPlayer && !this.isSpectator && !amIAPlayer) {\n            console.log('[Chat] Cannot access players channel - not a player or spectator');\n            return;\n        }\n\n        // Check if user can access spectators channel\n        if (channel === 'spectators' && (amIAPlayer || !this.isSpectator)) {\n            console.log('[Chat] Cannot access spectators channel - players cannot see spectator chat');\n            return;\n        }\n\n        console.log('[Chat] Access granted, setting chatChannel to:', channel);\n        this.chatChannel = channel;\n\n        // Update tab styles\n        if (this.els.chatTabLobby) this.els.chatTabLobby.classList.toggle('active', channel === 'lobby');\n        if (this.els.chatTabPlayers) this.els.chatTabPlayers.classList.toggle('active', channel === 'players');\n        if (this.els.chatTabSpectators) this.els.chatTabSpectators.classList.toggle('active', channel === 'spectators');\n\n        // Clear unread count for this channel\n        this.chatUnreadCounts[channel] = 0;\n        this._updateChatBadges();\n\n        // Render messages for this channel\n        this._renderChatMessages();\n\n        // Update chat input visibility based on channel and role\n        this._updateChatInputAccess();\n\n        // Request chat history if we don't have messages for this channel\n        if (!this.chatHistoryRequested[channel] && this.chatMessages[channel].length === 0 && this.roomId) {\n            this.chatHistoryRequested[channel] = true;\n            this._requestChatHistory(channel);\n        }\n    }\n\n    _isLobbyChatDisabled() {\n        // Lobby chat is disabled during game\n        return this.mode !== 'lobby' && (this.players.length >= this.maxPlayers ||\n            this.selectedPlayers.length >= this.maxPlayers);\n    }\n\n    _updateChatInputAccess() {\n        const chatForm = this.els.chatForm;\n        const chatInput = this.els.chatInput;\n        const sendBtn = this.els.chatSend;\n\n        // Determine if current user is a playing player\n        const amIAPlayer = this.players.some(p =>\n            String(p.user_id || p.id) === String(this.userId)\n        );\n\n        // Spectators viewing players chat cannot send messages\n        const isSpectatorViewingPlayersChat = this.isSpectator && !amIAPlayer && this.chatChannel === 'players';\n\n        if (chatForm) {\n            if (isSpectatorViewingPlayersChat) {\n                chatForm.classList.add('chat-input--disabled');\n                if (chatInput) {\n                    chatInput.disabled = true;\n                    chatInput.placeholder = 'Spectators cannot send messages in players chat';\n                }\n                if (sendBtn) sendBtn.disabled = true;\n            } else {\n                chatForm.classList.remove('chat-input--disabled');\n                if (chatInput) {\n                    chatInput.disabled = false;\n                    chatInput.placeholder = 'Type a message...';\n                }\n                if (sendBtn) sendBtn.disabled = false;\n            }\n        }\n    }\n\n    _toggleChat() {\n        this.isChatCollapsed = !this.isChatCollapsed;\n        if (this.els.chatPanel) {\n            this.els.chatPanel.classList.toggle('collapsed', this.isChatCollapsed);\n        }\n    }\n\n    _sendChatMessage() {\n        const content = this.els.chatInput?.value.trim();\n        if (!content || !this.roomId) return;\n\n        this._send({\n            type: 'games.command.send_chat',\n            room_id: this.roomId,\n            channel: this.chatChannel,\n            content: content,\n            avatar_id: this.avatarId || null\n        });\n\n        // Clear input\n        if (this.els.chatInput) {\n            this.els.chatInput.value = '';\n        }\n    }\n\n    _requestChatHistory(channel) {\n        if (!this.roomId) return;\n\n        this._send({\n            type: 'games.command.get_chat_history',\n            room_id: this.roomId,\n            channel: channel,\n            limit: 50\n        });\n    }\n\n    _handleChatMessage(message) {\n        console.log('[Chat] handleChatMessage received:', {\n            channel: message.channel,\n            username: message.username,\n            content: message.content?.substring(0, 50)\n        });\n\n        const chatMsg = {\n            id: message.message_id || Date.now(),\n            userId: message.user_id,\n            username: message.username || 'Unknown',\n            avatarId: message.avatar_id,\n            content: message.content,\n            isSystem: message.is_system || false,\n            timestamp: message.created_at ? new Date(message.created_at) : new Date(),\n        };\n\n        const channel = message.channel || 'lobby';\n\n        // Add to messages array\n        if (!this.chatMessages[channel]) {\n            this.chatMessages[channel] = [];\n        }\n        this.chatMessages[channel].push(chatMsg);\n\n        // Keep only last 100 messages per channel\n        if (this.chatMessages[channel].length > 100) {\n            this.chatMessages[channel] = this.chatMessages[channel].slice(-100);\n        }\n\n        // If this is the active channel, render\n        if (channel === this.chatChannel) {\n            this._renderChatMessages();\n        } else {\n            // Increment unread count for other channels\n            this.chatUnreadCounts[channel]++;\n            this._updateChatBadges();\n        }\n    }\n\n    _handleChatHistory(message) {\n        const channel = message.channel || 'lobby';\n        const historyMessages = message.messages || [];\n        console.log('[Chat] handleChatHistory received for channel:', channel, 'messages count:', historyMessages.length);\n\n        // Convert history messages to our internal format\n        const historyMapped = historyMessages.map(m => ({\n            id: m.message_id || m._id || Date.now(),\n            userId: m.user_id,\n            username: m.username || 'Unknown',\n            avatarId: m.avatar_id,\n            content: m.content,\n            isSystem: m.is_system || false,\n            timestamp: m.created_at ? new Date(m.created_at) : new Date(),\n        }));\n\n        // Get existing messages\n        const existingMessages = this.chatMessages[channel] || [];\n        const existingIds = new Set(existingMessages.map(m => String(m.id)));\n\n        // Merge: history messages + any real-time messages not in history\n        const newMessagesFromHistory = historyMapped.filter(m => !existingIds.has(String(m.id)));\n        const merged = [...newMessagesFromHistory, ...existingMessages];\n\n        // Sort by timestamp (oldest first)\n        merged.sort((a, b) => a.timestamp - b.timestamp);\n\n        // Keep only last 100 messages\n        this.chatMessages[channel] = merged.slice(-100);\n\n        // Render if this is the active channel\n        if (channel === this.chatChannel) {\n            this._renderChatMessages();\n        }\n    }\n\n    _renderChatMessages() {\n        const container = this.els.chatMessages;\n        if (!container) return;\n\n        const messages = this.chatMessages[this.chatChannel] || [];\n\n        if (messages.length === 0) {\n            container.innerHTML = '<div class=\"chat-empty\">No messages yet. Say hello!</div>';\n            return;\n        }\n\n        container.innerHTML = messages.map(msg => {\n            const isMuted = this.mutedUsers.has(String(msg.userId));\n\n            if (msg.isSystem) {\n                return `<div class=\"chat-message chat-message--system\">${this._escapeHtml(msg.content)}</div>`;\n            }\n\n            const initials = (msg.username || 'U').substring(0, 2).toUpperCase();\n            const timeStr = msg.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n\n            return `\n                <div class=\"chat-message ${isMuted ? 'chat-message--muted' : ''}\" data-user-id=\"${msg.userId}\">\n                    <div class=\"chat-message__avatar\">${initials}</div>\n                    <div class=\"chat-message__content\">\n                        <div class=\"chat-message__header\">\n                            <span class=\"chat-message__username\">${this._escapeHtml(msg.username)}</span>\n                            <span class=\"chat-message__time\">${timeStr}</span>\n                        </div>\n                        <div class=\"chat-message__text\">${this._escapeHtml(msg.content)}</div>\n                    </div>\n                    ${String(msg.userId) !== String(this.userId) ? `\n                        <button class=\"chat-message__mute\" data-user-id=\"${msg.userId}\" title=\"${isMuted ? 'Unmute user' : 'Mute user'}\">\n                            ${isMuted ? 'üîä' : 'üîá'}\n                        </button>\n                    ` : ''}\n                </div>\n            `;\n        }).join('');\n\n        // Scroll to bottom\n        container.scrollTop = container.scrollHeight;\n\n        // Bind mute buttons\n        container.querySelectorAll('.chat-message__mute').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const userId = e.target.dataset.userId;\n                this._toggleMuteUser(userId);\n            });\n        });\n    }\n\n    _toggleMuteUser(userId) {\n        const userIdStr = String(userId);\n        if (this.mutedUsers.has(userIdStr)) {\n            this.mutedUsers.delete(userIdStr);\n        } else {\n            this.mutedUsers.add(userIdStr);\n        }\n        this._renderChatMessages();\n    }\n\n    _updateChatBadges() {\n        const updateBadge = (badge, count) => {\n            if (!badge) return;\n            if (count > 0) {\n                badge.textContent = count > 99 ? '99+' : String(count);\n                badge.classList.remove('hidden');\n            } else {\n                badge.classList.add('hidden');\n            }\n        };\n\n        updateBadge(this.els.lobbyBadge, this.chatUnreadCounts.lobby);\n        updateBadge(this.els.playersBadge, this.chatUnreadCounts.players);\n        updateBadge(this.els.spectatorsBadge, this.chatUnreadCounts.spectators);\n    }\n\n    _updateChatTabAccess() {\n        const lobbyTab = this.els.chatTabLobby;\n        const playersTab = this.els.chatTabPlayers;\n        const spectatorsTab = this.els.chatTabSpectators;\n\n        const lobbyChatDisabled = this._isLobbyChatDisabled();\n\n        // Determine if current user is a playing player\n        const amIAPlayer = this.players.some(p =>\n            String(p.user_id || p.id) === String(this.userId)\n        );\n\n        // Lobby tab - visible during lobby/selecting phase, hidden during game\n        if (lobbyTab) {\n            if (lobbyChatDisabled) {\n                lobbyTab.classList.add('hidden');\n                lobbyTab.disabled = true;\n            } else {\n                lobbyTab.classList.remove('hidden');\n                lobbyTab.disabled = false;\n            }\n        }\n\n        // Players tab - visible during game for both players and spectators\n        if (playersTab) {\n            if (lobbyChatDisabled) {\n                playersTab.classList.remove('hidden');\n                playersTab.classList.remove('disabled');\n                playersTab.disabled = false;\n\n                if (this.isSpectator && !amIAPlayer) {\n                    playersTab.setAttribute('title', 'View players chat (read-only)');\n                } else {\n                    playersTab.removeAttribute('title');\n                }\n            } else {\n                playersTab.classList.add('hidden');\n                playersTab.disabled = true;\n            }\n        }\n\n        // Spectators tab - visible to spectators only\n        if (spectatorsTab) {\n            if (this.isSpectator && !amIAPlayer) {\n                spectatorsTab.classList.remove('hidden');\n                spectatorsTab.classList.remove('disabled');\n                spectatorsTab.disabled = false;\n            } else {\n                spectatorsTab.classList.add('hidden');\n                spectatorsTab.disabled = true;\n            }\n        }\n\n        // If current channel is no longer accessible, switch to appropriate channel\n        if (this.chatChannel === 'lobby' && lobbyChatDisabled) {\n            if (this.isSpectator && !amIAPlayer) {\n                this._switchChatChannel('spectators');\n            } else {\n                this._switchChatChannel('players');\n            }\n        }\n\n        if (this.chatChannel === 'spectators' && (!this.isSpectator || amIAPlayer)) {\n            if (lobbyChatDisabled) {\n                this._switchChatChannel('players');\n            } else {\n                this._switchChatChannel('lobby');\n            }\n        }\n\n        // Update input access for current channel\n        this._updateChatInputAccess();\n    }\n\n    _addSystemMessage(text) {\n        // Add system message to the current active channel\n        const chatMsg = {\n            id: Date.now(),\n            userId: 0,\n            username: 'System',\n            content: text,\n            isSystem: true,\n            timestamp: new Date(),\n        };\n\n        // Add to the appropriate channel based on game state\n        const channel = this._isLobbyChatDisabled() ? 'players' : 'lobby';\n        if (!this.chatMessages[channel]) {\n            this.chatMessages[channel] = [];\n        }\n        this.chatMessages[channel].push(chatMsg);\n\n        // Render if this is the active channel\n        if (channel === this.chatChannel) {\n            this._renderChatMessages();\n        } else {\n            this.chatUnreadCounts[channel]++;\n            this._updateChatBadges();\n        }\n    }\n\n    // ============================================\n    // Spectator Methods\n    // ============================================\n\n    _updateSpectatorUI() {\n        // Update spectator banner (shown when user is a spectator)\n        const banner = this.els.spectatorBanner;\n        const requestBtn = this.els.requestToPlayBtn;\n\n        if (banner) {\n            if (this.isSpectator) {\n                banner.classList.remove('hidden');\n                // Show \"Request to Play\" button if room has space\n                if (requestBtn) {\n                    const roomHasSpace = this.lobby.length < this.maxPlayers;\n                    requestBtn.classList.toggle('hidden', !roomHasSpace);\n                }\n            } else {\n                banner.classList.add('hidden');\n            }\n        }\n\n        // Update spectators panel (shows who's watching)\n        this._renderSpectatorsList();\n    }\n\n    _renderSpectatorsList() {\n        const panel = this.els.spectatorsPanel;\n        const countEl = this.els.spectatorsCount;\n        const listEl = this.els.spectatorsList;\n\n        if (!panel || !listEl) return;\n\n        // Show/hide the panel based on whether spectators are allowed and there are spectators\n        if (!this.allowSpectators || this.spectators.length === 0) {\n            panel.classList.add('hidden');\n            return;\n        }\n\n        panel.classList.remove('hidden');\n\n        // Update count\n        if (countEl) {\n            countEl.textContent = this.spectators.length;\n        }\n\n        // Render spectator list\n        const myId = String(this.userId);\n        listEl.innerHTML = this.spectators.map(spectator => {\n            const initial = (spectator.username || 'U').charAt(0).toUpperCase();\n            const isMe = String(spectator.user_id) === myId;\n            return `\n                <div class=\"spectator-item ${isMe ? 'spectator-item--me' : ''}\" data-user-id=\"${spectator.user_id}\">\n                    <span class=\"spectator-item__avatar\">${initial}</span>\n                    <span class=\"spectator-item__name\">${this._escapeHtml(spectator.username)}${isMe ? ' (you)' : ''}</span>\n                </div>\n            `;\n        }).join('');\n    }\n\n    _requestToPlay() {\n        // Request to switch from spectator to player\n        console.log('[TicTacToe] Requesting to play');\n        this._send({\n            type: 'games.command.request_to_play',\n            room_id: this.roomId\n        });\n\n        // Disable the button while waiting for response\n        if (this.els.requestToPlayBtn) {\n            this.els.requestToPlayBtn.disabled = true;\n            this.els.requestToPlayBtn.textContent = 'Requested...';\n        }\n    }\n\n    _onSpectatorJoined(msg) {\n        console.log('[TicTacToe] Spectator joined:', msg);\n\n        // Handle both formats: direct fields or nested spectator object\n        const spectatorData = msg.spectator || msg;\n        const spectator = {\n            user_id: spectatorData.user_id,\n            username: spectatorData.username,\n            avatar_id: spectatorData.avatar_id,\n            joined_at: spectatorData.joined_at\n        };\n\n        // Add to spectators list if not already there\n        if (!this.spectators.find(s => String(s.user_id) === String(spectator.user_id))) {\n            this.spectators.push(spectator);\n        }\n\n        // If this is the current user, set isSpectator flag and update chat tabs\n        if (String(spectator.user_id) === String(this.userId)) {\n            this.isSpectator = true;\n            this.isPlayer = false;\n            console.log('[TicTacToe] Current user joined as spectator, updating chat tabs');\n            this._updateChatTabAccess();\n        }\n\n        // Update spectator UI and admin lobby (to show spectator with badge)\n        this._updateSpectatorUI();\n\n        // Re-render admin lobby if admin is viewing it\n        if (this.isAdmin && this.els.adminLobby && !this.els.adminLobby.classList.contains('hidden')) {\n            this._renderAdminLobby();\n        }\n    }\n\n    _onSpectatorLeft(msg) {\n        console.log('[TicTacToe] Spectator left:', msg);\n        const userId = String(msg.user_id);\n\n        // Remove from spectators list\n        this.spectators = this.spectators.filter(s => String(s.user_id) !== userId);\n\n        // Update spectator UI\n        this._updateSpectatorUI();\n    }\n\n    _onRequestToPlayAccepted(msg) {\n        console.log('[TicTacToe] Request to play accepted:', msg);\n\n        // If this is about me, update my state\n        if (String(msg.user_id) === String(this.userId)) {\n            this.isSpectator = false;\n            // Note: The player will be added to lobby, so we'll get a lobby_joined event too\n        }\n\n        // Remove from spectators\n        const userId = String(msg.user_id);\n        this.spectators = this.spectators.filter(s => String(s.user_id) !== userId);\n\n        // Update UI\n        this._updateSpectatorUI();\n        this._updateChatTabAccess();\n    }\n\n    // Legacy method to support old waiting room rendering\n    _renderWaitingRoom() {\n        // This is kept for compatibility but now delegates to the new system\n        this._updateGameUI();\n    }\n\n    _handleCellClick(cell) {\n        if (this.isSpectator) return;\n        if (this.currentTurn != this.userId) return;\n        if (this.isGamePaused) return;\n\n        const position = parseInt(cell.dataset.position);\n        if (this.board[position] !== null) return;\n\n        this._send({\n            type: 'games.command.tic_tac_toe.move',\n            room_id: this.roomId,\n            position: position,\n        });\n    }\n\n    _resetBoard() {\n        this.board = Array(9).fill(null);\n        this.winningLine = null;\n        this._renderBoard();\n    }\n\n    _renderBoard() {\n        this.els.cells.forEach((cell, i) => {\n            const mark = this.board[i];\n            cell.textContent = mark || '';\n            cell.className = 'cell';\n\n            if (mark === 'X') {\n                cell.classList.add('cell--x');\n            } else if (mark === 'O') {\n                cell.classList.add('cell--o');\n            }\n\n            if (this.currentTurn != this.userId || mark !== null || this.isGamePaused) {\n                cell.classList.add('cell--disabled');\n            }\n        });\n    }\n\n    _highlightWinningLine() {\n        if (!this.winningLine) return;\n        this.winningLine.forEach(pos => {\n            this.els.cells[pos].classList.add('cell--winning');\n        });\n    }\n\n    _updateMatchInfo() {\n        // Find players\n        const player1 = { id: this.playerXId, score: this.scores[this.playerXId] || 0 };\n        const player2 = { id: this.playerOId, score: this.scores[this.playerOId] || 0 };\n\n        // Get names (we might need to store these from game started event)\n        const player1Name = player1.id == this.userId ? this.username : 'Opponent';\n        const player2Name = player2.id == this.userId ? this.username : 'Opponent';\n\n        // Update player 1 (X)\n        this.els.player1Score.querySelector('.player-score__name').textContent = player1Name;\n        this.els.player1Score.querySelector('.player-score__value').textContent = player1.score;\n        this.els.player1Score.classList.toggle('player-score--active', this.currentTurn == player1.id);\n\n        // Update player 2 (O)\n        this.els.player2Score.querySelector('.player-score__name').textContent = player2Name;\n        this.els.player2Score.querySelector('.player-score__value').textContent = player2.score;\n        this.els.player2Score.classList.toggle('player-score--active', this.currentTurn == player2.id);\n\n        // Update game number\n        this.els.gameNumber.textContent = `Game ${this.gameNumber} of 9 (First to ${WIN_SCORE} wins)`;\n    }\n\n    _updateTurnIndicator() {\n        const isMyTurn = this.currentTurn == this.userId;\n        const myMark = this.playerXId == this.userId ? 'X' : 'O';\n\n        this.els.turnIndicator.classList.toggle('turn-indicator--your-turn', isMyTurn);\n        this.els.turnIndicatorText.textContent = isMyTurn\n            ? `Your turn (${myMark})`\n            : `Opponent's turn`;\n    }\n\n    _startTimer() {\n        this._stopTimer();\n        this.timeRemaining = TURN_TIMER_SECONDS;\n\n        if (this.moveDeadline) {\n            const now = new Date();\n            this.timeRemaining = Math.max(0, Math.floor((this.moveDeadline - now) / 1000));\n        }\n\n        this._updateTimerDisplay();\n\n        this.timerInterval = setInterval(() => {\n            this.timeRemaining = Math.max(0, this.timeRemaining - 1);\n            this._updateTimerDisplay();\n\n            if (this.timeRemaining <= 0) {\n                this._stopTimer();\n            }\n        }, 1000);\n    }\n\n    _stopTimer() {\n        if (this.timerInterval) {\n            clearInterval(this.timerInterval);\n            this.timerInterval = null;\n        }\n    }\n\n    _updateTimerDisplay() {\n        this.els.turnTimerValue.textContent = this.timeRemaining;\n        this.els.turnTimerValue.className = 'turn-timer__value';\n\n        if (this.timeRemaining <= 10) {\n            this.els.turnTimerValue.classList.add('turn-timer__value--danger');\n        } else if (this.timeRemaining <= 20) {\n            this.els.turnTimerValue.classList.add('turn-timer__value--warning');\n        }\n    }\n\n    _backToLobby() {\n        this.els.gameResult.classList.remove('active');\n        this.mode = 'lobby';\n        this._showLobby();\n        this._listRooms();\n        this.dispatchEvent(new CustomEvent('game-leave', { detail: { roomId: this.roomId } }));\n    }\n\n    _onError(msg) {\n        console.error('[TicTacToe] Error:', msg);\n\n        // Handle specific error cases\n        if (msg.code === 'already_in_room') {\n            // User is already in this room - request the room state to rejoin\n            console.log('[TicTacToe] Already in room, requesting room state...');\n            const roomName = this._pendingJoinData?.roomName || msg.room_name || this.roomName;\n            const roomId = msg.room_id || this.roomId;\n\n            if (roomName) {\n                this._send({\n                    type: 'games.command.get_room_state',\n                    room_name: roomName,\n                });\n                this._showToast('Rejoining room...', 'info');\n            } else if (roomId) {\n                // If we have room_id but not room_name, try to find it in our rooms list\n                const room = this.rooms.find(r => r.room_id === roomId);\n                if (room) {\n                    this._send({\n                        type: 'games.command.get_room_state',\n                        room_name: room.room_name,\n                    });\n                    this._showToast('Rejoining room...', 'info');\n                } else {\n                    this._showToast('Already in a room. Refreshing...', 'info');\n                    this._listRooms();\n                }\n            } else {\n                this._showToast('Already in a room', 'info');\n            }\n            return;\n        }\n\n        this._showToast(msg.message, 'error');\n\n        // Also dispatch event for parent page to handle\n        this.dispatchEvent(new CustomEvent('game-error', {\n            detail: { code: msg.code, message: msg.message }\n        }));\n    }\n\n    _showToast(message, type = 'error') {\n        const toast = document.createElement('div');\n        toast.className = `toast toast--${type}`;\n        toast.innerHTML = `<span class=\"toast__message\">${this._escapeHtml(message)}</span>`;\n\n        this.els.toastContainer.appendChild(toast);\n\n        // Auto-remove after 5 seconds\n        setTimeout(() => {\n            toast.style.animation = 'toastSlideOut 0.3s ease forwards';\n            setTimeout(() => {\n                toast.remove();\n            }, 300);\n        }, 5000);\n    }\n}\n","/**\n * TIC_TAC_TOE Game Entry Point\n *\n * This file bootstraps the TicTacToe web component.\n * The component is self-contained with its own WebSocket handling,\n * game state management, and UI.\n */\n\nimport './styles/main.scss';\nimport { TicTacToe } from './TicTacToe.js';\n\n// Register the web component if not already registered\nif (!customElements.get('tic-tac-toe')) {\n    customElements.define('tic-tac-toe', TicTacToe);\n}\n\n// Log registration for debugging\nconsole.log('[TIC_TAC_TOE] Web component registered');\n"],"names":[],"mappings":";;AAgCA,QAAM,qBAAqB;AAC3B,QAAM,YAAY;AAElB,QAAM,WAAW,SAAS,cAAc,UAAU;AAClD,WAAS,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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"}
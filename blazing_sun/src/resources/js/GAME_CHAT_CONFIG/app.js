(function(){"use strict";class a{constructor(e){this.baseUrl=e.baseUrl||"",this.configForm=e.configForm,this.loadingIndicator=e.loadingIndicator,this.showToast=e.showToast||console.log,this.config={rate_limit_messages:10,rate_limit_window_seconds:60,max_message_length:500,profanity_filter_enabled:!0,profanity_word_list:[],global_mute_enabled:!1},this.cacheElements(),this.bindEvents(),this.loadConfig()}cacheElements(){this.elements={rateLimitMessages:document.getElementById("rateLimitMessages"),rateLimitWindow:document.getElementById("rateLimitWindow"),previewMessages:document.getElementById("previewMessages"),previewWindow:document.getElementById("previewWindow"),maxMessageLength:document.getElementById("maxMessageLength"),profanityFilterEnabled:document.getElementById("profanityFilterEnabled"),profanitySection:document.getElementById("profanitySection"),addWordInput:document.getElementById("addWordInput"),addWordBtn:document.getElementById("addWordBtn"),wordList:document.getElementById("wordList"),wordListEmpty:document.getElementById("wordListEmpty"),wordCount:document.getElementById("wordCount"),globalMuteBtn:document.getElementById("globalMuteBtn"),globalMuteModal:document.getElementById("globalMuteModal"),closeGlobalMuteModal:document.getElementById("closeGlobalMuteModal"),cancelGlobalMute:document.getElementById("cancelGlobalMute"),confirmGlobalMute:document.getElementById("confirmGlobalMute"),globalMuteModalText:document.getElementById("globalMuteModalText"),confirmGlobalMuteText:document.getElementById("confirmGlobalMuteText"),saveBtn:document.getElementById("saveBtn")}}bindEvents(){this.configForm.addEventListener("submit",e=>this.handleSubmit(e)),this.elements.rateLimitMessages.addEventListener("input",()=>this.updateRateLimitPreview()),this.elements.rateLimitWindow.addEventListener("input",()=>this.updateRateLimitPreview()),this.elements.profanityFilterEnabled.addEventListener("change",()=>this.toggleProfanitySection()),this.elements.addWordBtn.addEventListener("click",()=>this.addWord()),this.elements.addWordInput.addEventListener("keypress",e=>{e.key==="Enter"&&(e.preventDefault(),this.addWord())}),this.elements.globalMuteBtn.addEventListener("click",()=>this.showGlobalMuteModal()),this.elements.closeGlobalMuteModal.addEventListener("click",()=>this.hideGlobalMuteModal()),this.elements.cancelGlobalMute.addEventListener("click",()=>this.hideGlobalMuteModal()),this.elements.confirmGlobalMute.addEventListener("click",()=>this.toggleGlobalMute()),this.elements.globalMuteModal.addEventListener("click",e=>{e.target===this.elements.globalMuteModal&&this.hideGlobalMuteModal()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&!this.elements.globalMuteModal.classList.contains("hidden")&&this.hideGlobalMuteModal()})}async loadConfig(){try{const e=await fetch(`${this.baseUrl}/api/v1/admin/game-chat/config`,{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();if(t.success&&t.config)this.config=t.config,this.populateForm();else throw new Error(t.message||"Failed to load configuration")}catch(e){console.error("Failed to load config:",e),this.showToast("Failed to load configuration","error")}finally{this.loadingIndicator.classList.add("hidden"),this.configForm.classList.remove("hidden")}}populateForm(){this.elements.rateLimitMessages.value=this.config.rate_limit_messages,this.elements.rateLimitWindow.value=this.config.rate_limit_window_seconds,this.updateRateLimitPreview(),this.elements.maxMessageLength.value=this.config.max_message_length,this.elements.profanityFilterEnabled.checked=this.config.profanity_filter_enabled,this.toggleProfanitySection(),this.renderWordList(),this.updateGlobalMuteButton()}updateRateLimitPreview(){const e=this.elements.rateLimitMessages.value||10,t=this.elements.rateLimitWindow.value||60;this.elements.previewMessages.textContent=e,this.elements.previewWindow.textContent=t}toggleProfanitySection(){const e=this.elements.profanityFilterEnabled.checked;this.elements.profanitySection.style.opacity=e?"1":"0.5",this.elements.profanitySection.style.pointerEvents=e?"auto":"none"}renderWordList(){const e=this.config.profanity_word_list||[],t=this.elements.wordList;t.querySelectorAll(".word-tag").forEach(s=>s.remove()),this.elements.wordListEmpty.classList.toggle("hidden",e.length>0),e.forEach(s=>{const r=this.createWordTag(s);t.appendChild(r)}),this.elements.wordCount.textContent=e.length}createWordTag(e){const t=document.createElement("span");return t.className="word-tag",t.innerHTML=`
      <span class="word-tag__text">${this.escapeHtml(e)}</span>
      <button type="button" class="word-tag__remove" aria-label="Remove ${this.escapeHtml(e)}" data-word="${this.escapeHtml(e)}">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    `,t.querySelector(".word-tag__remove").addEventListener("click",()=>this.removeWord(e)),t}async addWord(){const e=this.elements.addWordInput,t=e.value.trim().toLowerCase();if(t){if(this.config.profanity_word_list.includes(t)){this.showToast("Word already in filter list","warning"),e.value="";return}try{const o=await fetch(`${this.baseUrl}/api/v1/admin/game-chat/profanity/add`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({word:t})}),s=await o.json();if(o.ok&&s.success)this.config.profanity_word_list.push(t),this.renderWordList(),e.value="",this.showToast("Word added to filter","success");else throw new Error(s.message||"Failed to add word")}catch(o){console.error("Failed to add word:",o),this.showToast(o.message||"Failed to add word","error")}}}async removeWord(e){try{const t=await fetch(`${this.baseUrl}/api/v1/admin/game-chat/profanity/remove`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({word:e})}),o=await t.json();if(t.ok&&o.success){const s=this.config.profanity_word_list.indexOf(e);s>-1&&this.config.profanity_word_list.splice(s,1),this.renderWordList(),this.showToast("Word removed from filter","success")}else throw new Error(o.message||"Failed to remove word")}catch(t){console.error("Failed to remove word:",t),this.showToast(t.message||"Failed to remove word","error")}}async handleSubmit(e){e.preventDefault();const t={rate_limit_messages:parseInt(this.elements.rateLimitMessages.value,10),rate_limit_window_seconds:parseInt(this.elements.rateLimitWindow.value,10),max_message_length:parseInt(this.elements.maxMessageLength.value,10),profanity_filter_enabled:this.elements.profanityFilterEnabled.checked};if(t.rate_limit_messages<1||t.rate_limit_messages>1e3){this.showToast("Rate limit messages must be between 1 and 1000","error");return}if(t.rate_limit_window_seconds<1||t.rate_limit_window_seconds>3600){this.showToast("Rate limit window must be between 1 and 3600 seconds","error");return}if(t.max_message_length<1||t.max_message_length>1e4){this.showToast("Max message length must be between 1 and 10000","error");return}this.elements.saveBtn.disabled=!0,this.elements.saveBtn.textContent="Saving...";try{const o=await fetch(`${this.baseUrl}/api/v1/admin/game-chat/config`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}),s=await o.json();if(o.ok&&s.success)s.config?this.config=s.config:Object.assign(this.config,t),this.showToast("Configuration saved successfully","success");else throw new Error(s.message||"Failed to save configuration")}catch(o){console.error("Failed to save config:",o),this.showToast(o.message||"Failed to save configuration","error")}finally{this.elements.saveBtn.disabled=!1,this.elements.saveBtn.innerHTML=`
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        Save Changes
      `}}updateGlobalMuteButton(){const e=this.config.global_mute_enabled,t=this.elements.globalMuteBtn;t.classList.toggle("global-mute-btn--active",e),t.querySelector(".global-mute-btn__text").textContent=e?"Mute Active":"Global Mute"}showGlobalMuteModal(){!this.config.global_mute_enabled?(this.elements.globalMuteModalText.textContent="Are you sure you want to enable global mute? This will immediately disable chat in ALL game rooms.",this.elements.confirmGlobalMuteText.textContent="Enable Global Mute",this.elements.confirmGlobalMute.classList.remove("btn--success"),this.elements.confirmGlobalMute.classList.add("btn--danger")):(this.elements.globalMuteModalText.textContent="Are you sure you want to disable global mute? Chat will be re-enabled in all game rooms.",this.elements.confirmGlobalMuteText.textContent="Disable Global Mute",this.elements.confirmGlobalMute.classList.remove("btn--danger"),this.elements.confirmGlobalMute.classList.add("btn--success")),this.elements.globalMuteModal.classList.remove("hidden"),this.elements.confirmGlobalMute.focus()}hideGlobalMuteModal(){this.elements.globalMuteModal.classList.add("hidden"),this.elements.globalMuteBtn.focus()}async toggleGlobalMute(){const e=!this.config.global_mute_enabled;this.elements.confirmGlobalMute.disabled=!0,this.elements.confirmGlobalMuteText.textContent="Processing...";try{const t=await fetch(`${this.baseUrl}/api/v1/admin/game-chat/global-mute`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({enabled:e})}),o=await t.json();if(t.ok&&o.success){this.config.global_mute_enabled=e,this.updateGlobalMuteButton(),this.hideGlobalMuteModal();const s=e?"enabled":"disabled";this.showToast(`Global mute ${s}`,e?"warning":"success")}else throw new Error(o.message||"Failed to toggle global mute")}catch(t){console.error("Failed to toggle global mute:",t),this.showToast(t.message||"Failed to toggle global mute","error")}finally{this.elements.confirmGlobalMute.disabled=!1,this.elements.confirmGlobalMuteText.textContent=e?"Disable Global Mute":"Enable Global Mute"}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}function i(){const n=document.getElementById("configForm"),e=document.getElementById("loadingIndicator");if(!n||!e){console.error("GameChatConfigPage: Required DOM elements not found");return}const t=window.BASE_URL||"",o=l(),s=new a({baseUrl:t,configForm:n,loadingIndicator:e,showToast:o});typeof window<"u"&&(window.gameChatConfigController=s)}function l(){const n={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",info:"linear-gradient(to right, #667eea, #764ba2)",warning:"linear-gradient(to right, #f093fb, #f5576c)"};return function(t,o="success"){typeof Toastify<"u"?Toastify({text:t,duration:4e3,gravity:"top",position:"right",style:{background:n[o]||n.info}}).showToast():console.log(`[${o.toUpperCase()}] ${t}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()})();

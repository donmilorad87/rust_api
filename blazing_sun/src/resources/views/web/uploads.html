{% extends "base.html" %}

{% block title %}Uploads Management - Blazing Sun Admin{% endblock %}

{% block extra_styles_links %}
<link rel="stylesheet" href="/assets/css/UPLOADS/style.css?v={{ assets_version }}">
{% endblock %}

{% block content %}
<main class="admin-content">
    <div class="uploads-page">
        <header class="uploads-page__header">
            <h1 class="uploads-page__title">Uploads Management</h1>
            <div class="uploads-page__controls">
                <button id="uploadBtn" class="btn btn--primary" aria-label="Upload files">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span class="btn__text">Upload Files</span>
                </button>
                <div class="search-input">
                    <svg class="search-input__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="searchInput" class="search-input__field" placeholder="Search by name, title, description or *.ext" aria-label="Search uploads by name, title, description, or file extension (*.jpg, *.png, etc.)">
                </div>
                <select id="filterStorage" class="filter-select" aria-label="Filter by storage type">
                    <option value="">All Types</option>
                    <option value="public">Public</option>
                    <option value="private">Private</option>
                </select>
                <select id="viewToggle" class="filter-select" aria-label="View mode">
                    <option value="grid">Grid View</option>
                    <option value="table">Table View</option>
                </select>
                <div class="uploads-bulk">
                    <label class="uploads-bulk__select">
                        <input type="checkbox" id="selectAllUploads" class="uploads-bulk__checkbox">
                        <span class="uploads-bulk__label">Select all</span>
                    </label>
                    <span id="selectedUploadsCount" class="uploads-bulk__count">0 selected</span>
                    <button type="button" id="bulkDeleteUploadsBtn" class="btn btn--danger btn--hidden" disabled>
                        <span class="btn__text">Delete Selected</span>
                    </button>
                </div>
            </div>
        </header>

        {% if stats %}
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-card__label">Total Uploads</div>
                <div class="stat-card__value">{{ stats.total }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-card__label">Public Files</div>
                <div class="stat-card__value">{{ stats.public }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-card__label">Private Files</div>
                <div class="stat-card__value">{{ stats.private }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-card__label">Total Size</div>
                <div class="stat-card__value">{{ stats.total_size }}</div>
            </div>
        </div>
        {% endif %}

        {# Grid view container #}
        <div id="uploadsGrid" class="uploads-grid" style="display: grid;">
            {# Populated by JavaScript #}
        </div>

        {# Table view container #}
        <div class="table-container">
            <table class="uploads-table" role="grid" aria-label="Uploads table">
                <thead class="uploads-table__head">
                    <tr>
                        <th class="uploads-table__header uploads-table__header--select" scope="col">Select</th>
                        <th class="uploads-table__header" scope="col">Preview</th>
                        <th class="uploads-table__header" scope="col">UUID</th>
                        <th class="uploads-table__header" scope="col">File Name</th>
                        <th class="uploads-table__header" scope="col">Type</th>
                        <th class="uploads-table__header" scope="col">MIME Type</th>
                        <th class="uploads-table__header" scope="col">Size</th>
                        <th class="uploads-table__header" scope="col">Status</th>
                        <th class="uploads-table__header" scope="col">User</th>
                        <th class="uploads-table__header" scope="col">Created</th>
                        <th class="uploads-table__header uploads-table__header--center" scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="uploadsTable" class="uploads-table__body">
                    {# Populated by JavaScript #}
                    <tr>
                        <td colspan="11" class="uploads-table__empty">
                            <div class="empty-state">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                <p>Loading uploads...</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="pagination" class="pagination-container"></div>
    </div>
</main>

<div id="confirmUploadModal" class="confirm-modal" aria-hidden="true">
    <div class="confirm-modal__backdrop z-modal-backdrop" data-action="close-modal"></div>
    <div class="confirm-modal__dialog z-modal" role="dialog" aria-modal="true" aria-labelledby="confirmUploadModalTitle">
        <header class="confirm-modal__header">
            <h2 id="confirmUploadModalTitle" class="confirm-modal__title">Delete Upload</h2>
            <button type="button" class="confirm-modal__close" data-action="close-modal" aria-label="Close">
                x
            </button>
        </header>
        <div class="confirm-modal__body">
            <p id="confirmUploadModalMessage" class="confirm-modal__message">Delete this upload?</p>
        </div>
        <div class="confirm-modal__actions">
            <button type="button" class="btn btn--ghost" data-action="cancel-modal">Cancel</button>
            <button type="button" class="btn btn--danger" data-action="confirm-modal">Delete</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Set base URL for API requests
    window.BASE_URL = '{{ base_url | safe }}';
</script>
<script src="/assets/js/UPLOADS/app.js?v={{ assets_version }}" defer></script>
{% endblock %}

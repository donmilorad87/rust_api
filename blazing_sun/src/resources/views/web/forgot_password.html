{% extends "base.html" %}

{% block title %}Forgot Password - Blazing Sun{% endblock %}

{% block extra_styles_links %}
<link rel="stylesheet" href="/assets/css/FORGOT_PASSWORD/style.css?v={{ assets_version }}">
{% endblock %}

{% block content %}
<main class="container">
    <!-- Request Reset Form -->
    <article class="card" id="requestCard">
        <h1>Forgot Password</h1>
        <p class="text-center" style="color: #666; margin-bottom: 1.5rem;">
            Enter your email address and we'll send you a code to reset your password.
        </p>
        <form id="requestForm" aria-label="Request password reset form" novalidate>
            <div class="form-group">
                <label class="form-group__label" for="email">Email</label>
                <div class="input-wrapper">
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-group__input"
                        autocomplete="email"
                        aria-required="true"
                        aria-describedby="emailFeedback"
                        placeholder="Enter your email address"
                    >
                </div>
                <div id="emailFeedback" class="validation-feedback" aria-live="polite"></div>
            </div>
            <button type="submit" class="btn btn--primary btn--full" id="requestBtn">Send Reset Code</button>
        </form>
        <p class="text-center mt-1">
            Remember your password? <a href="/sign-in" class="link">Sign In</a>
        </p>
    </article>

    <!-- Verify Hash Form (hidden initially) -->
    <article class="card hidden" id="verifyCard">
        <h1>Verify Code</h1>
        <p class="text-center" style="color: #666; margin-bottom: 1.5rem;">
            We've sent a reset code to your email. Please enter it below to continue.
        </p>
        <form id="verifyForm" aria-label="Verify reset code form">
            <div class="form-group">
                <label for="reset_code">Reset Code</label>
                <input
                    type="text"
                    id="reset_code"
                    name="reset_code"
                    required
                    maxlength="20"
                    placeholder="Enter 20 character code"
                    autocomplete="one-time-code"
                    aria-required="true"
                >
            </div>
            <input type="hidden" id="verify_email" name="email">
            <button type="submit" class="btn" id="verifyBtn">Verify Code</button>
        </form>
    </article>

    <!-- Reset Password Form (hidden initially) -->
    <article class="card hidden" id="resetCard">
        <h1>Reset Password</h1>
        <p class="text-center" style="color: #666; margin-bottom: 1.5rem;">
            Code verified! Please enter your new password.
        </p>
        <form id="resetForm" aria-label="Reset password form" novalidate>
            <div class="form-group">
                <label class="form-group__label" for="new_password">New Password</label>
                <div class="input-wrapper input-wrapper--password">
                    <input
                        type="password"
                        id="new_password"
                        name="password"
                        class="form-group__input"
                        autocomplete="new-password"
                        aria-required="true"
                        aria-describedby="newPasswordFeedback"
                        placeholder="Enter your new password"
                    >
                    <button type="button" class="password-toggle" id="newPasswordToggle" aria-label="Show password">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
                <div id="newPasswordFeedback" class="validation-feedback" aria-live="polite"></div>
            </div>
            <div class="form-group">
                <label class="form-group__label" for="confirm_password">Confirm Password</label>
                <div class="input-wrapper input-wrapper--password">
                    <input
                        type="password"
                        id="confirm_password"
                        name="password_confirmation"
                        class="form-group__input"
                        autocomplete="new-password"
                        aria-required="true"
                        aria-describedby="confirmPasswordFeedback"
                        placeholder="Confirm your new password"
                    >
                    <button type="button" class="password-toggle" id="confirmPasswordToggle" aria-label="Show password">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
                <div id="confirmPasswordFeedback" class="validation-feedback" aria-live="polite"></div>
            </div>
            <input type="hidden" id="reset_token" name="token">
            <input type="hidden" id="reset_email" name="email">
            <button type="submit" class="btn btn--primary btn--full" id="resetBtn">Reset Password</button>
        </form>
    </article>
</main>
{% endblock %}

{% block scripts %}
<script>
    // Set base URL for API requests
    window.BASE_URL = '{{ base_url | safe }}';
</script>
<script src="/assets/js/FORGOT_PASSWORD/app.js?v={{ assets_version }}" defer></script>
{% endblock %}
